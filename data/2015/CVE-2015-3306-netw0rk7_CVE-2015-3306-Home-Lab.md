## CVE-2015-3306 - ProFTPD mod_copy 远程文件复制到RCE

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 远程代码执行

**影响应用:** ProFTPD

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 1.3.5

**利用条件:** 需要ProFTPD 1.3.5 开启 mod_copy 模块并允许 SITE CPFR/CPTO 命令，匿名FTP访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2015-3306 是 ProFTPD 1.3.5 版本中 mod_copy 模块的一个漏洞。该漏洞允许远程攻击者通过 SITE CPFR 和 SITE CPTO 命令读取和写入任意文件，从而导致远程代码执行。

**利用方式：**

1.  攻击者首先通过 FTP 连接到目标服务器。
2.  利用 `SITE CPFR` 命令指定源文件，例如 `/proc/self/cmdline` 以读取 ProFTPD 进程的命令行参数，或者创建一个临时 PHP 文件 `/tmp/<?php echo passthru($_GET['cmd']); ?>`用于执行命令。
3.  使用 `SITE CPTO` 命令将源文件复制到目标位置，例如 Web 目录 `/var/www/html/webshell.php`。
4.  通过 Web 浏览器访问复制到 Web 目录的恶意文件（webshell），并传递 `cmd` 参数来执行任意命令，例如 `http://<IP>/webshell.php?cmd=id`。

**有效性：**

提供的 Dockerfile 用于构建一个易受攻击的 ProFTPD 1.3.5 环境，并配置了必要的条件，例如启用 `mod_copy` 和允许匿名 FTP 访问。README.md 文件中详细描述了漏洞的利用步骤，以及如何通过上传 webshell 执行任意命令。 因此，提供的POC代码是有效的。

**投毒风险：**

Dockerfile 构建过程包含从官方 FTP 服务器下载 ProFTPD 1.3.5 的源代码并进行编译安装，理论上存在被中间人攻击替换源代码的可能性，但可能性较低。脚本生成 flag 写入 `/tmp/flag_RANDOM.txt`。`/entrypoint.sh` 脚本的功能是启动 ProFTPD 和 Apache2 服务，并且自动生成一个包含 flag 的文件。这些行为是与漏洞利用相关的，而不是恶意的。**投毒风险较低，大约为10%**。主要是对官方FTP服务器被入侵的担忧。

**项目地址:** [netw0rk7/CVE-2015-3306-Home-Lab](https://github.com/netw0rk7/CVE-2015-3306-Home-Lab)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)