## CVE-2024-12084-Rsync-堆缓冲区溢出

**漏洞编号:** CVE-2024-12084

**漏洞类型:** 堆缓冲区溢出

**影响应用:** Rsync

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 3.2.7, 3.3.0

**利用条件:** Rsync daemon 运行且允许未授权访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-12084 是 Rsync 中存在的一个堆缓冲区溢出漏洞。漏洞原因是程序在处理攻击者可控的校验和长度 (s2length) 时不当。当 MAX_DIGEST_LEN 超过固定的 SUM_LENGTH (16 字节) 时，攻击者可以溢出 sum2 缓冲区。\n\n**漏洞利用方式：**\n\n1.  **握手:** 客户端与 Rsync 服务器建立连接，进行协议版本协商。\n2.  **模块选择:** 客户端选择一个模块，如果服务器配置允许匿名访问，则无需身份验证。\n3.  **参数发送:** 客户端发送 Rsync 命令参数。\n4.  **兼容性标志读取:** 客户端读取服务器的兼容性标志，并可能进行校验和算法的协商。\n5.  **校验和种子读取:** 客户端读取服务器的校验和种子。\n6.  **Multiplexing:** 启用 Multiplexing 功能以便更高效地传输数据。\n7.  **文件列表处理:** 漏洞触发点在于服务器处理文件列表时，攻击者可以构造恶意的校验和长度，导致堆缓冲区溢出。POC 通过精心构造的文件列表数据，利用 `read_varint` 函数读取校验和长度时触发溢出。\n\n**投毒风险分析：**\n\n该 POC 代码主要用于验证漏洞的存在，提供了一个本地调试和远程利用的框架。代码中包含 GDB 调试功能，便于分析漏洞。投毒风险较低，主要风险在于如果直接将修改后的恶意代码部署到生产环境，可能会引入后门或不稳定因素。`pwncli` 是一个 CTF 工具，可能包含一些安全风险，但主要集中在利用阶段而非持久化的投毒行为。需要注意的是，该脚本依赖特定的环境配置（如 `rsync.conf` 和 `LD_LIBRARY_PATH`），确保环境安全非常重要。该利用程序相对复杂，需要对 Rsync 协议和内存布局有深入的理解，增加了投毒的难度，但也并非不可能。总的来说，该脚本主要用于漏洞验证和利用，而非恶意代码传播，因此判定投毒风险较低。

**项目地址:** [InkeyP/CVE-2024-12084](https://github.com/InkeyP/CVE-2024-12084)

**漏洞详情:** [CVE-2024-12084](https://nvd.nist.gov/vuln/detail/CVE-2024-12084)