## CVE-2024-3094 - XZ Utils供应链后门

**漏洞编号:** CVE-2024-3094

**漏洞类型:** 供应链攻击/嵌入恶意代码

**影响应用:** XZ Utils (liblzma)

**危害等级:** 极危，可导致未经授权的远程访问和完全系统入侵

**影响版本:** 5.6.0 和 5.6.1

**利用条件:** 目标系统必须使用受感染的XZ Utils版本，并且sshd等服务动态链接到liblzma

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-3094 描述了在 XZ Utils 5.6.0 和 5.6.1 版本中发现的供应链后门。该漏洞并非传统的代码缺陷，而是在构建过程中通过复杂的混淆手段，将预先构建的恶意对象文件注入到 liblzma 库中。

**有效性:**
提供的README.md文件并非直接的漏洞利用代码，而是一份关于CVE-2024-3094漏洞的详细分析报告，它描述了漏洞的发生方式、影响范围、检测方法和缓解步骤。该报告验证了漏洞的存在和影响。

**投毒风险:**
该README.md文件本身不太可能包含任何投毒代码。主要原因是：

1.  **信息呈现为主：**  该文件主要用于信息展示和分析，而非直接的可执行代码。
2.  **内容透明：**  文件内容以Markdown格式呈现，方便人工审查，隐藏恶意代码的难度较高。
3.  **来源可追溯：**  该存储库可以被追踪和审计，增加了投毒的风险和成本。但是依旧存在1%的风险因为如果被入侵账号上传投毒文件,依旧存在风险。

**利用方式:**
该漏洞的利用方式非常复杂，并非简单的代码执行。其核心在于:

1.  **构建时注入：**  恶意代码在liblzma的构建过程中被插入，而不是存在于源代码中。
2.  **IFUNC劫持：**  恶意代码通过IFUNC（Indirect Function Call）机制，劫持liblzma中的特定函数调用。
3.  **SSH认证绕过：**  被劫持的函数通常与SSH服务相关，攻击者可以通过发送特制的密钥，绕过SSH认证，从而获得远程访问权限。

**利用流程总结:**

1.  **攻击者获取XZ Utils项目的贡献权限（可能是通过长期渗透和伪装）。**
2.  **攻击者在发布tarball中插入恶意代码，但不在Git仓库中暴露。**
3.  **用户下载并构建受感染的XZ Utils版本。**
4.  **liblzma库被恶意代码修改。**
5.  **sshd等服务链接到被修改的liblzma库。**
6.  **攻击者使用特制密钥尝试SSH连接，成功绕过认证并获得访问权限。**

**项目地址:** [B1ack4sh/Blackash-CVE-2024-3094](https://github.com/B1ack4sh/Blackash-CVE-2024-3094)

**漏洞详情:** [CVE-2024-3094](https://nvd.nist.gov/vuln/detail/CVE-2024-3094)