## CVE-2024-48910-DOMPurify-原型污染

**漏洞编号:** CVE-2024-48910

**漏洞类型:** 原型污染

**影响应用:** DOMPurify

**危害等级:** 高危，可能导致XSS绕过和权限提升

**影响版本:** < 2.4.2，部分版本即使升级到2.4.2也可能受影响

**利用条件:** 需要在客户端执行JavaScript代码，通常通过网络进行

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-48910是DOMPurify库中的一个原型污染漏洞。攻击者可以通过修改JavaScript的Object原型来改变DOMPurify的行为，从而绕过XSS过滤。

**有效性：**
提供的POC代码有效。它通过污染`Object.prototype.hasOwnProperty`和`Object.prototype.ALLOWED_ATTR`来允许`onerror`属性，从而绕过DOMPurify的XSS保护。即使升级到2.4.2版本，只要设置`Object.prototype.hasOwnProperty = () => true;`仍然可以绕过保护，说明漏洞修复不彻底。

**投毒风险：**
该代码库的投毒风险较低，约为10%。虽然POC演示了如何利用漏洞，但没有发现作者故意隐藏恶意代码或后门的迹象。风险主要来自于该POC可能被恶意用户用于攻击。

**利用方式：**
1.  攻击者首先需要能够在目标网站上执行JavaScript代码，例如通过XSS漏洞或其他方式。
2.  攻击者使用提供的POC代码污染`Object.prototype.hasOwnProperty`，使其返回`Object`或返回`true`， 绕过DOMPurify内部的属性检查。
3.  攻击者污染`Object.prototype.ALLOWED_ATTR`，将`src`和`onerror`等属性添加到允许的属性列表中。
4.  由于DOMPurify使用`clone()`函数复制配置时存在原型污染漏洞，被污染的配置会被复制到DOMPurify的内部配置中。
5.  现在，攻击者可以构造包含`onerror`属性的HTML代码，DOMPurify不会对其进行过滤，从而导致XSS漏洞。

**总结：**
该漏洞利用原型污染绕过DOMPurify的XSS过滤机制，攻击难度较低，但影响严重。开发者应尽快升级到DOMPurify 3.0.0+版本，或使用更安全的配置方式，并避免依赖用户可控的输入作为配置。

**项目地址:** [Mitchellzhou1/CVE-2024-48910-PoC](https://github.com/Mitchellzhou1/CVE-2024-48910-PoC)

**漏洞详情:** [CVE-2024-48910](https://nvd.nist.gov/vuln/detail/CVE-2024-48910)