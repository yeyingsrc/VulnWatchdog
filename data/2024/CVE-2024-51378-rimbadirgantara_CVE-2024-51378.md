## CVE-2024-51378 - CyberPanel 远程代码执行

**漏洞编号:** CVE-2024-51378

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** CyberPanel

**危害等级:** 高危，可绕过身份验证并执行任意命令

**影响版本:** <= 2.3.6 and 2.3.7 (unpatched)

**利用条件:** 需要网络访问CyberPanel管理端口

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2024-51378 存在于 CyberPanel 的 `dns/views.py` 和 `ftp/views.py` 中。未经身份验证的远程攻击者可以通过 `/dns/getresetstatus` 或 `/ftp/getresetstatus` 路径，利用 `statusfile` 属性中的 shell 元字符，绕过 `secMiddleware`（仅适用于 POST 请求）并执行任意命令。PSAUX 在 2024 年 10 月已在野外利用此漏洞。该漏洞的利用方式如下：

1.  **漏洞位置**: `/dns/getresetstatus` 和 `/ftp/getresetstatus`。
2.  **绕过认证**:  漏洞利用的关键在于绕过 `secMiddleware`，因为它只针对 POST 请求进行安全检查，而 GET 请求不受保护。
3.  **命令注入**: 通过在 `statusfile` 参数中注入 shell 元字符来执行任意命令。例如，可以使用 `;` 来连接命令。
4.  **PoC 分析**: 提供的 PoC 代码 `run.py` 脚本通过 HTTP 请求发送包含恶意 `statusfile` 参数的 GET 请求，从而触发命令注入。该脚本允许指定目标 IP 地址列表和要执行的命令。如果不指定命令，默认会部署 SSH 公钥到目标服务器，实现持久访问。
5. **投毒风险**: 脚本中包含一个默认ssh key的变量,若未修改,所有使用此脚本的人都会植入相同的公钥,从而导致其他人可以利用此后门进行控制,所以有一定投毒风险.另外脚本编写存在不完整，tokenCSRF函数没有return,运行直接报错，利用存在风险.风险占比5%。
6.  **缓解措施**: 立即将 CyberPanel 更新到 >= 2.3.8 版本。如果无法立即更新，请通过防火墙或网络 ACL 限制对面板的访问，并应用 WAF/IPS 规则来阻止可疑请求。

**项目地址:** [rimbadirgantara/CVE-2024-51378](https://github.com/rimbadirgantara/CVE-2024-51378)

**漏洞详情:** [CVE-2024-51378](https://nvd.nist.gov/vuln/detail/CVE-2024-51378)