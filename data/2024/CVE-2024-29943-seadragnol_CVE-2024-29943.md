## CVE-2024-29943-Firefox-类型混淆

**漏洞编号:** CVE-2024-29943

**漏洞类型:** 类型混淆

**影响应用:** Firefox

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** < 124.0.1

**利用条件:** 需要在受影响的Firefox版本中执行恶意JavaScript代码

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-29943 是一个存在于 Firefox 124.0.1 之前的版本中的漏洞。该漏洞允许攻击者通过欺骗基于范围的边界检查消除，在 JavaScript 对象上执行越界读取或写入操作。 

**有效性分析：**
根据提供的漏洞利用代码，该PoC利用了 Firefox 的 JavaScript 引擎中的类型混淆漏洞。代码首先通过堆喷射（Heap spraying）在内存中布置一些对象，然后利用漏洞进行越界访问（Out-of-bounds access），最终实现任意地址读写。PoC 中包含 addrof 和 fakeobj 函数，表明其目标是实现地址泄露和伪造对象，从而获得对内存的控制。因此，从代码逻辑上看，提供的PoC代码是有效的。

**投毒风险分析：**
分析提供的 JavaScript 代码，存在潜在的投毒风险。代码中包含大量的堆喷射和内存操作，这些操作本身就比较复杂，可能会被用于隐藏恶意行为。此外，代码中存在一些硬编码的地址和偏移量，这些值可能会被用于特定环境下的利用，也可能包含后门或者其他恶意负载。
虽然没有明显的恶意代码，例如直接执行 shell 命令，但利用越界读写操作可以实现很多恶意目的，例如篡改函数指针、劫持控制流等。此外，代码中存在一些看似无害但可能被利用的函数，例如`addrof`和`fakeobj`，这些函数可以被用于读取内存地址和伪造对象，从而实现任意代码执行。
综合来看，此仓库中存在作者隐藏的投毒代码的风险约为 10%。

**漏洞利用方式分析：**
1.  **堆喷射 (Heap Spraying):** 代码首先进行堆喷射，在内存中分配大量的 BigUint64Array 对象，以便在后续的利用过程中更容易找到目标对象。
2.  **触发越界访问:** 通过`opt`函数中的类型混淆漏洞，触发越界读写。
3.  **地址泄露 (Address Leak):** 利用越界读取，泄露目标对象的地址。PoC中的 `addrof` 函数用于获取对象的地址。
4.  **伪造对象 (Fake Object):** 利用越界写入，伪造对象。PoC中的 `fakeobj` 函数用于在指定地址处伪造对象。
5.  **任意代码执行:** 在获取了对象地址和伪造对象的能力之后，攻击者可以利用这些能力实现任意代码执行，例如，可以伪造一个包含恶意代码的函数对象，然后调用该函数。

总体来说，该漏洞利用方式比较典型，利用了类型混淆漏洞实现越界读写，进而实现地址泄露和任意代码执行。

**项目地址:** [seadragnol/CVE-2024-29943](https://github.com/seadragnol/CVE-2024-29943)

**漏洞详情:** [CVE-2024-29943](https://nvd.nist.gov/vuln/detail/CVE-2024-29943)