## CVE-2024-0044 Android 权限提升漏洞

**漏洞编号:** CVE-2024-0044

**漏洞类型:** 权限提升

**影响应用:** Android

**危害等级:** 高危，可导致本地权限提升

**影响版本:** Android 12, 12L, 13, 14, 15

**利用条件:** 需要设备开启开发者模式，并且已经通过ADB 连接

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-0044 允许攻击者在 Android 设备上进行权限提升。该漏洞位于 PackageInstallerService.java 的 createSessionInternal 函数中，由于不正确的输入验证，可能导致以任何应用程序的身份运行代码。利用该漏洞无需额外的执行权限，也无需用户交互。提供的POC脚本通过以下步骤利用该漏洞：

1.  **准备环境：** 创建临时目录 `/data/local/tmp/tempqazmkp/` 并设置权限，推送一个任意 APK 文件到该目录。
2.  **获取目标应用 UID：** 使用 `pm list packages -U` 命令获取目标应用（即想要窃取沙箱数据的应用）的 UID。
3.  **构造 Payload：** 构造一个特殊的 payload 字符串，其中包含目标应用的 UID 和沙箱路径。
4.  **安装 APK 并执行 run-as：** 使用 `pm install -i` 命令和一个包含换行符的 payload 来欺骗包管理器，使其相信安装是由目标应用程序发起的。安装后，使用 `run-as` 命令以目标应用的身份运行 `tar` 命令，将目标应用的沙箱目录打包成一个 tar 文件。
5.  **下载沙箱文件：** 将打包好的 tar 文件从设备下载到本地。
6.  **清理：** 删除设备上的临时文件和目录。

**有效性：**
该POC代码基于CVE描述和参考文章（Bypassing the "run-as" debuggability check on Android via newline injection），利用`pm install`和`run-as`命令组合来达到权限提升的目的。根据描述，该POC在Android 12/13上有效，且利用方式合理，因此判断该POC代码是有效的。

**投毒风险：**
分析POC代码后，未发现任何明显的恶意代码或隐藏的后门。脚本的主要功能是利用漏洞提取目标应用的沙箱数据，所有操作都集中在这个目标上。脚本中没有执行任何与此目标不相关的操作。因此，投毒风险较低，评估为0%。

**利用方式总结：**
攻击者利用 CVE-2024-0044 首先需要通过 adb 连接设备。然后，利用 `pm install -i` 命令注入换行符绕过 `run-as` 的调试检查，获取目标应用权限执行任意代码。最终，攻击者可以访问目标应用沙箱中的数据。

**项目地址:** [Re13orn/CVE-2024-0044-EXP](https://github.com/Re13orn/CVE-2024-0044-EXP)

**漏洞详情:** [CVE-2024-0044](https://nvd.nist.gov/vuln/detail/CVE-2024-0044)