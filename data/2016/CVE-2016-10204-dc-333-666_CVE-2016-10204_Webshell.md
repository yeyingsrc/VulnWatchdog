## CVE-2016-10204-ZoneMinder-SQL注入

**漏洞编号:** CVE-2016-10204

**漏洞类型:** SQL注入

**影响应用:** ZoneMinder

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** <= 1.30

**利用条件:** 需要能够访问ZoneMinder的web界面，以及数据库权限允许写入文件到指定目录（/var/www/html/）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2016-10204是ZoneMinder 1.30及更早版本中存在的一个SQL注入漏洞。该漏洞允许远程攻击者通过向index.php发送log query请求时，在limit参数中注入恶意的SQL命令，从而执行任意SQL代码。漏洞利用代码通过构造恶意的SQL注入payload，向目标服务器写入一个PHP webshell到/var/www/html/目录。攻击者随后可以通过访问该webshell，执行任意系统命令。\n\n**有效性：** 提供的POC代码通过构造SQL注入，写入webshell，然后执行命令，验证漏洞存在，所以有效。\n\n**投毒风险：** POC代码本身主要用于演示如何利用该漏洞，但在实际使用中存在投毒风险。以下是分析：\n- 该脚本尝试在目标服务器上写入PHP webshell。如果该脚本被恶意修改，例如webshell的内容被替换为具有更隐蔽或更恶意功能的代码，则可能会造成更大的危害。\n- 脚本中的URL和参数可能会被修改为指向不同的目标或者使用不同的注入payload，从而实现对其他系统的攻击或者进行更高级的攻击。\n- 虽然脚本的主要目的是写入webshell，但它也可能包含一些额外的代码，例如用于收集目标系统信息的代码或者用于传播恶意软件的代码。\n\n尽管代码的主要目的是利用漏洞，但存在一定的被篡改用于恶意目的的可能性，因此存在一定的投毒风险。比例估计为10%。主要是因为webshell的行为本身就很明显，容易被发现。\n\n**利用方式：**\n1.  攻击者首先需要确定目标ZoneMinder服务器的版本是否在受影响范围内（<= 1.30）。\n2.  攻击者构造包含恶意SQL代码的payload，该payload旨在将一个PHP webshell写入服务器的文件系统中。该payload会插入到index.php的log query请求的limit参数中。\n3.  攻击者发送包含恶意payload的HTTP请求到目标服务器。\n4.  如果SQL注入成功，webshell文件将被写入到服务器的/var/www/html/目录下。\n5.  攻击者可以通过访问该webshell文件的URL，并使用cmd参数执行任意系统命令。

**项目地址:** [dc-333-666/CVE-2016-10204_Webshell](https://github.com/dc-333-666/CVE-2016-10204_Webshell)

**漏洞详情:** [CVE-2016-10204](https://nvd.nist.gov/vuln/detail/CVE-2016-10204)