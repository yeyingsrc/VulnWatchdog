## CVE-2013-0156-Ruby on Rails-对象注入

**漏洞编号:** CVE-2013-0156

**漏洞类型:** 对象注入/反序列化

**影响应用:** Ruby on Rails

**危害等级:** 高危，可能导致远程代码执行或拒绝服务

**影响版本:** Rails < 2.3.15, 3.0.x < 3.0.19, 3.1.x < 3.1.10, 3.2.x < 3.2.11

**利用条件:** 需要服务器接受YAML或Symbol类型转换的数据

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2013-0156是Ruby on Rails框架中Action Pack组件的一个漏洞，攻击者可以通过发送恶意构造的YAML或Symbol数据，利用Rails的参数解析过程中的类型转换缺陷，进行对象注入攻击，从而执行任意代码或者导致拒绝服务。漏洞存在于 `active_support/core_ext/hash/conversions.rb` 文件中。提供的漏洞利用代码（Gemfile和Gemfile.lock）是用于搭建一个存在漏洞的Rails环境的，本身不是PoC。要验证此漏洞需要构造恶意的请求参数，例如利用YAML反序列化漏洞，或者利用Symbol类型转换漏洞。 Gemfile和Gemfile.lock文件定义了Rails 3.2.9的依赖，属于受影响的版本。

**有效性：** 根据漏洞库信息，该漏洞影响Rails 2.3.15, 3.0.x, 3.1.x, 3.2.x等版本。提供的代码Gemfile指定了Rails 3.2.9，因此存在漏洞。搭建此环境之后可以通过发送恶意请求进行验证。

**投毒风险：** 提供的代码文件（Gemfile、Gemfile.lock、README.rdoc）都是标准的Rails项目文件，看起来没有明显的恶意代码。 README.rdoc 只是Rails的欢迎文档。Gemfile 和 Gemfile.lock 定义了项目的依赖，没有发现隐藏的恶意依赖。尽管存在通过依赖引入间接风险的可能性，但是直接投毒的可能性较低。因此，投毒风险较低，估计为1%。

**利用方式：** 攻击者可以发送包含恶意YAML或Symbol数据的HTTP请求，例如，在POST请求中包含一个精心构造的YAML字符串作为参数。Rails在解析参数时会尝试将字符串转换为相应的对象，如果攻击者能够控制转换过程，就可以创建任意对象，并执行该对象的代码。或者通过Symbol类型转换，利用某些内部类的特性达到执行任意代码的目的。攻击通常利用可序列化的类，并利用这些类中的`initialize`或者其他方法执行系统命令。


**项目地址:** [terracatta/name_reverser](https://github.com/terracatta/name_reverser)

**漏洞详情:** [CVE-2013-0156](https://nvd.nist.gov/vuln/detail/CVE-2013-0156)