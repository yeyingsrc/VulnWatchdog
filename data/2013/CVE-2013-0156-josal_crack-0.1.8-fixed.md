## CVE-2013-0156

**漏洞编号:** CVE-2013-0156

**漏洞类型:** 对象注入/代码执行/拒绝服务

**影响应用:** Ruby on Rails

**危害等级:** 高危

**影响版本:** before 2.3.15, 3.0.x before 3.0.19, 3.1.x before 3.1.10, and 3.2.x before 3.2.11

**利用条件:** 目标应用使用了存在漏洞的Ruby on Rails版本，并且允许解析YAML或Symbol类型转换的请求参数。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2013-0156是Ruby on Rails框架中的一个严重漏洞，存在于`active_support/core_ext/hash/conversions.rb`文件中。该漏洞源于Rails未能正确限制字符串值的类型转换，允许攻击者通过利用Action Pack对YAML或Symbol类型转换的支持，进行对象注入攻击并执行任意代码，或者导致拒绝服务（内存和CPU消耗）。

**有效性：**
虽然提供的代码片段不是完整的POC，但漏洞库信息和搜索引擎结果（虽然未提供）表明该漏洞存在公开的POC利用代码。

**投毒风险：**
提供的代码片段是`crack` gem 的部分文件，看起来是一个XML/JSON解析库。这些文件主要包含许可证、历史记录、README、Rakefile和gemspec。检查这些文件没有发现明显的恶意代码。历史记录中提到的修复与YAML解析相关，这与漏洞描述相符。Rakefile和gemspec文件定义了gem的构建和依赖关系，没有发现可疑之处。但是依然存在极低的投毒风险，恶意攻击者可能通过其他方式篡改代码，因此投毒风险为10%。

**利用方式：**
1.  **利用YAML类型转换:** 攻击者可以构造包含恶意YAML数据的HTTP请求参数。Rails在解析这些参数时，会将YAML数据反序列化为Ruby对象。通过构造特定的YAML payload，攻击者可以实例化任意Ruby对象，并执行该对象的代码。这通常涉及到利用Rails内置的一些危险类（如`ActiveSupport::Deprecation::DeprecationProxy`）来执行系统命令。
2.  **利用Symbol类型转换:** 类似于YAML利用，攻击者可以构造包含恶意Symbol数据的HTTP请求参数。Rails在处理这些参数时，会将字符串转换为Symbol。通过精心构造字符串，攻击者可以创建任意Symbol，并利用Symbol的特性来执行代码。这种利用方式通常比较复杂，需要对Rails的内部机制有深入的了解。
3.  **拒绝服务:** 如果无法执行代码，攻击者仍然可以利用此漏洞进行拒绝服务攻击。通过发送包含大量嵌套XML实体引用的请求，可以消耗大量的内存和CPU资源，导致服务器崩溃。

**项目地址:** [josal/crack-0.1.8-fixed](https://github.com/josal/crack-0.1.8-fixed)

**漏洞详情:** [CVE-2013-0156](https://nvd.nist.gov/vuln/detail/CVE-2013-0156)