## CVE-2013-0156-Ruby on Rails-对象注入

**漏洞编号:** CVE-2013-0156

**漏洞类型:** 对象注入/反序列化漏洞

**影响应用:** Ruby on Rails

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Rails before 2.3.15, 3.0.x before 3.0.19, 3.1.x before 3.1.10, and 3.2.x before 3.2.11

**利用条件:** 目标服务器运行存在漏洞的Ruby on Rails版本，并且开启了Action Pack对YAML/XML请求的支持。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2013-0156是一个Ruby on Rails框架中的对象注入漏洞，存在于`active_support/core_ext/hash/conversions.rb`文件中。漏洞原因是Rails在处理XML或YAML格式的请求参数时，由于类型转换限制不足，允许攻击者通过构造恶意的YAML或XML payload注入任意对象，最终导致远程代码执行。 

**利用方式：**

1.  **构造恶意Payload:**  攻击者构造包含恶意Ruby代码的YAML或XML payload。该payload利用了Ruby对象反序列化的特性，可以执行任意系统命令。
2.  **发送Payload:** 攻击者将构造好的payload作为请求参数（通常是XML格式）发送到目标Rails应用程序。
3.  **触发漏洞:**  Rails应用程序在解析XML或YAML参数时，会触发对象注入漏洞，执行payload中的恶意代码。

提供的POC代码（`cve-2013-0156.py`）主要包含以下几个部分：

*   **Payload生成:**  根据目标Rails版本（2.x或3.x）生成相应的YAML payload，利用`yaml.dump()`函数将payload序列化成YAML格式。  为了防止Payload被多次执行，Payload会被 `wrap_payload` 函数包裹。`escape_payload` 函数用来调整适应 rails2 和 rails3 的格式
*   **XML封装:**  将YAML payload封装在XML结构中，作为HTTP请求的内容发送。
*   **HTTP请求:**  使用`requests`库发送HTTP POST请求，将XML payload发送到目标URL。
*   **结果显示:**  脚本会显示发送的HTTP请求和接收到的HTTP响应，方便用户判断漏洞是否成功利用。

**有效性评估：**

根据漏洞描述和POC代码，可以判断此POC代码是有效的。 它针对的是 Rails 在处理 XML 格式数据时存在缺陷，允许攻击者注入恶意的 YAML payload 以达到执行任意代码的目的。 该POC代码针对Rails 2.x和3.x版本，能较大概率复现漏洞。

**投毒风险分析：**

代码中存在一定的投毒风险，但风险较低。风险点在于 `payload` 变量的内容。如果用户不了解 YAML 反序列化的风险，直接使用脚本可能执行恶意代码。`wrap_payload` 函数可能存在被绕过的风险，具体取决于目标环境的配置和补丁情况。因此，投毒风险估计为10%。

**综上所述：**，该漏洞利用代码的有效性较高，但在使用时需要谨慎，确保payload的安全性，并在授权环境下进行测试。

**项目地址:** [oxben10/CVE-2013-0156](https://github.com/oxben10/CVE-2013-0156)

**漏洞详情:** [CVE-2013-0156](https://nvd.nist.gov/vuln/detail/CVE-2013-0156)