## CVE-2017-0144 (EternalBlue) Windows SMB 远程代码执行漏洞

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统启用 SMBv1 协议，攻击者与目标系统网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144，又名 EternalBlue，是一个存在于 Microsoft Windows SMBv1 服务器中的远程代码执行漏洞。攻击者可以构造特制的 SMB 数据包发送到目标服务器，利用此漏洞在目标系统上执行任意代码。

**有效性分析：**
提供的漏洞利用代码（来源于BlueDoor CTF挑战）实际上是一个如何利用 Metasploit 或其他工具来攻击存在 EternalBlue 漏洞的 Windows 7 系统的指南。它验证了漏洞的可利用性，提供了一步步的指导，从扫描漏洞到获得目标系统的 shell，再到权限提升和最终获取 flag。

**投毒风险分析：**
该代码主要提供的是一个 CTF 挑战的指南，其目的是帮助学习者复现漏洞利用过程。虽然直接提供的代码片段本身没有明显的恶意代码，但考虑到以下几点，仍存在一定的投毒风险：

*   **payload生成：** 指南中涉及使用`msfvenom`生成payload，如果用户使用错误的参数或者从不可信的源下载payload，可能导致恶意代码被注入到目标系统。
*   **Metasploit模块的信任问题：** 虽然 Metasploit 框架本身是一个合法的渗透测试工具，但用户需要确保使用的 Metasploit 模块来源可靠，避免使用被篡改的版本。
*   **依赖第三方链接：** 该文档依赖于外部链接,如google drive下载OVA文件和netlify ctf提交网站, 存在被替换为恶意链接的风险.

综合评估，该仓库中存在投毒代码的可能性较低，约为10%。风险主要来自于payload的生成、Metasploit模块的使用以及潜在的第三方链接被替换风险。

**利用方式：**
1.  **扫描漏洞：** 使用 `nmap` 等工具扫描目标系统，确认其是否开启了 SMBv1，以及是否存在 MS17-010 漏洞（EternalBlue）。
2.  **生成 Payload：** 使用 `msfvenom` 或类似工具生成一个反向 shell payload。Payload 的作用是在成功利用漏洞后，让目标系统连接到攻击者的机器，从而让攻击者获得一个 shell。
3.  **漏洞利用：** 使用 Metasploit 框架中的 `exploit/windows/smb/ms17_010_eternalblue` 模块或者其他 Python 编写的 EternalBlue 漏洞利用脚本，将 payload 发送到目标系统。
4.  **权限提升：** 在获得目标系统的 shell 之后，可能需要进行权限提升，才能执行一些需要管理员权限的操作，例如读取 flag 文件。
5.  **获取 Flag：** 导航到 flag 所在的目录（例如 `C:\Windows\System32`），读取 flag 文件。

**项目地址:** [sethwhy/BlueDoor](https://github.com/sethwhy/BlueDoor)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)