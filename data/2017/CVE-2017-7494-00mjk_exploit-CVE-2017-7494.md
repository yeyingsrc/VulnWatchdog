## CVE-2017-7494 SambaCry 远程代码执行漏洞

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致完全控制受影响的服务器

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.x < 4.5.10, 4.4.x < 4.4.14

**利用条件:** 需要目标服务器存在可写共享目录，并且攻击者能够进行身份验证以访问该共享。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494（SambaCry）是一个存在于Samba中的远程代码执行漏洞。攻击者可以通过上传恶意共享库到可写共享目录，然后通过特制的命名管道触发服务器加载和执行该恶意库，从而实现远程代码执行。

**有效性：**

提供的PoC代码看起来是有效的。漏洞库信息和漏洞利用代码中的描述一致，表明这是一个已知的且可利用的漏洞。PoC代码中包含了利用步骤，包括上传恶意共享库和触发执行的过程。代码中给出了明确的利用示例，这表明该漏洞已经得到了充分的研究。

**投毒风险：**

PoC代码中包含一个C文件 (`bindshell-samba.c`)，该文件编译成共享库后会被上传到目标服务器，并在目标服务器上执行反弹shell。主要风险在于，该C文件中的反弹shell端口 (`6699`) 是硬编码的。如果攻击者修改了端口，或者植入了其他恶意代码，则可能存在投毒风险。虽然提供的代码本身看起来实现了描述中的功能，但总是存在被修改和用于恶意目的的可能性。因此，投毒风险估计为10%。

**利用方式：**

1.  **身份验证：** 攻击者需要能够通过某种方式对目标Samba服务器进行身份验证，以访问可写共享目录。
2.  **恶意共享库上传：** 攻击者将包含恶意代码的共享库（`libbindshell-samba.so`）上传到可写共享目录。
3.  **触发执行：** 攻击者利用命名管道的漏洞，构造特殊的请求，强制Samba服务器加载并执行上传的恶意共享库。
4.  **远程代码执行：** 恶意共享库在Samba服务器的上下文中执行，从而允许攻击者执行任意代码。通常，恶意库会创建一个反弹shell，允许攻击者远程控制受感染的服务器。

**项目地址:** [00mjk/exploit-CVE-2017-7494](https://github.com/00mjk/exploit-CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)