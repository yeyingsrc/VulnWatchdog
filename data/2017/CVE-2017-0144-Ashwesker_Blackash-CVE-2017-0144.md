## CVE-2017-0144 - EternalBlue: Microsoft Windows SMBv1 远程代码执行漏洞

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Microsoft Windows SMBv1

**危害等级:** 高危，可导致完全控制受影响系统。

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 和 R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold 和 R2, Windows RT 8.1, Windows 10 Gold, 1511, 和 1607 以及 Windows Server 2016

**利用条件:** 目标系统启用 SMBv1 且未安装 MS17-010 补丁，开放445/TCP端口。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144（EternalBlue）是一个存在于 Microsoft Windows SMBv1 服务器中的远程代码执行漏洞。攻击者可以通过发送特制的 SMBv1 数据包来利用此漏洞，从而在目标系统上执行任意代码。漏洞利用通常涉及以下步骤：

1.  **协议协商：** 客户端和服务器协商 SMB 协议，确认 SMBv1 可用。
2.  **连接到 IPC$：** 攻击者连接到目标系统的 IPC$ 共享，这是一个用于 SMB 管道的匿名共享。
3.  **Trans2 会话设置：** 攻击者使用 `SMB_COM_TRANSACTION2` (0x32) 发送一个会话设置请求，其中包含一个格式错误的 FEALIST 结构，该结构的 `SizeOfListInBytes` 字段被设置为一个很大的值 (例如 0xFFFF)。
4.  **Trans2 请求溢出：** 攻击者发送多个辅助数据包，每个数据包包含一个超大的 FEALIST 和 FEA (文件扩展属性)。FEA 包含一个 `AttributeName`，其长度超过了预期，导致堆溢出。
5.  **覆盖函数指针：** 溢出覆盖内核中的函数指针。
6.  **执行 shellcode：**  被覆盖的函数指针被shellcode替换，执行shellcode后往往会安装DoublePulsar后门。
7.  **DoublePulsar 后门 (可选)：**  EternalBlue 通常与 DoublePulsar 后门一起使用，DoublePulsar 允许攻击者在 Ring-0 级别执行任意代码。

**有效性：**

提供的描述文件表明，EternalBlue 漏洞的利用已经非常成熟，存在多个可用的 PoC 和 Metasploit 模块。所以提供的POC有效。

**投毒风险：**

该markdown描述文件本身不包含可执行代码。投毒风险较低，但存在一些潜在风险：

*   **依赖外部资源：** 如果该 markdown 文件引用了外部脚本或程序，则存在这些外部资源被篡改的风险。
*   **社会工程学：** 该 markdown 文件可能包含误导性信息或链接，诱骗用户执行恶意操作。
*   **DoublePulsar 后门：** 通过EternalBlue安装的DoublePulsar是一种后门程序，可能会被攻击者用来植入恶意代码。

 综合考虑，投毒风险大概为10%。

**利用方式：**

如上所述，利用方式主要是通过构造恶意的 SMBv1 数据包，触发堆溢出，覆盖内核函数指针，并最终执行 shellcode。

**项目地址:** [Ashwesker/Blackash-CVE-2017-0144](https://github.com/Ashwesker/Blackash-CVE-2017-0144)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)