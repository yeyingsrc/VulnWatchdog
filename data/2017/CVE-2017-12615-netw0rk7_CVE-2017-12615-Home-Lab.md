## CVE-2017-12615-Apache Tomcat-远程代码执行

**漏洞编号:** CVE-2017-12615

**漏洞类型:** 远程代码执行

**影响应用:** Apache Tomcat

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 7.0.0 to 7.0.79

**利用条件:** 运行在Windows上，启用HTTP PUT，readonly初始化参数设置为false

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-12615漏洞存在于Apache Tomcat 7.0.0到7.0.79版本中。当Tomcat运行在Windows系统，且启用了HTTP PUT方法（例如，通过设置DefaultServlet的readonly初始化参数为false），攻击者可以通过构造特殊的请求上传JSP文件到服务器。上传的JSP文件随后可以被访问，并执行其中包含的任意代码，从而实现远程代码执行。

**漏洞利用方式：**

1.  **环境准备：** Tomcat版本在7.0.0到7.0.79之间，运行在Windows系统上，并且DefaultServlet的`readonly`参数设置为`false`，允许HTTP PUT请求。
2.  **构造JSP Payload：** 创建一个包含恶意代码的JSP文件，例如webshell，用于执行系统命令。
3.  **上传JSP文件：** 使用HTTP PUT方法将JSP文件上传到Tomcat服务器。关键在于文件名后添加`/`，绕过某些安全检查。例如：`curl -v -X PUT "http://localhost:8080/shell.jsp/" -H "Content-Type: text/plain" --data-binary @shell.jsp`。
4.  **执行Payload：** 通过访问上传的JSP文件，传递参数执行恶意代码。例如：`http://localhost:8080/shell.jsp?cmd=id`，执行`id`命令。

**投毒风险分析：**

提供的Dockerfile构建了一个存在CVE-2017-12615漏洞的Tomcat环境，并生成一个包含flag的txt文件。代码本身是漏洞的验证和演示，没有明显的恶意投毒行为。docker-entrypoint.sh 脚本主要功能是生成flag文件，验证Tomcat和Java环境是否正确启动。`webapps/ROOT` 目录被拷贝到容器中，可能包含一些提示信息，引导使用者进行漏洞利用。整体风险较低，主要是为了演示漏洞，而非进行恶意攻击。其中`docker-entrypoint.sh` 脚本的随机值生成可能存在一定的预测性，但并不能完全控制目标系统。

尽管主要目的是漏洞演示，但存在极小的（5%）投毒风险。例如：

*   在`webapps/ROOT`目录下放置看似无害但实际会影响目标系统的JSP文件。
*   虽然`docker-entrypoint.sh`的主要目的是生成flag，但理论上也可以添加一些命令来修改系统配置，虽然目前的代码并没有这么做。生成flag的部分代码可以算作良性的'后门'，方便验证漏洞。


**项目地址:** [netw0rk7/CVE-2017-12615-Home-Lab](https://github.com/netw0rk7/CVE-2017-12615-Home-Lab)

**漏洞详情:** [CVE-2017-12615](https://nvd.nist.gov/vuln/detail/CVE-2017-12615)