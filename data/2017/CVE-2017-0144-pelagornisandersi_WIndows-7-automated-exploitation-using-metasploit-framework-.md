## CVE-2017-0144-Windows SMB 远程代码执行

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行

**影响应用:** Windows SMBv1

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607, Windows Server 2016

**利用条件:** 需要目标系统开启SMBv1服务（默认开启），且攻击者能够访问445端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Windows SMBv1服务器中，攻击者通过发送特制的SMB数据包可以触发漏洞，实现远程代码执行。该脚本首先使用nmap扫描目标IP的445端口，如果端口开放则检查运行的服务。然后，使用nmap脚本 `smb-vuln-ms17-010` 扫描是否存在MS17-010漏洞。如果确认存在漏洞，脚本会提示用户输入攻击者的IP地址和端口，然后生成一个Metasploit的资源配置文件，并使用Metasploit框架利用该漏洞获得目标系统的反向shell。

**有效性：**
该PoC脚本通过调用Metasploit的`exploit/windows/smb/ms17_010_eternalblue`模块来实现漏洞利用，该模块是公开且经过验证的，因此该PoC代码的有效性较高。

**投毒风险：**
该脚本主要是通过shell脚本封装了nmap扫描和Metasploit利用，没有发现任何隐藏的恶意代码，例如下载并执行其他程序等。因此，投毒风险较低，可以判断投毒风险为0%。该脚本的目的是自动化MS17-010漏洞的检测和利用。

**利用方式：**
1.  **端口扫描：** 使用nmap扫描目标IP的445端口是否开放。
2.  **漏洞检测：** 如果445端口开放，则使用nmap的`smb-vuln-ms17-010`脚本检测目标系统是否存在MS17-010漏洞。
3.  **配置生成：** 如果确认目标系统存在漏洞，脚本会提示用户输入攻击者的IP地址和端口，然后生成一个Metasploit的资源配置文件（.rc文件）。
4.  **漏洞利用：** 脚本调用Metasploit的`msfconsole`，并加载生成的资源配置文件，Metasploit会自动运行Eternalblue漏洞利用模块，尝试获取目标系统的控制权。如果成功，攻击者可以获得目标系统的反向shell。

**项目地址:** [pelagornisandersi/WIndows-7-automated-exploitation-using-metasploit-framework-](https://github.com/pelagornisandersi/WIndows-7-automated-exploitation-using-metasploit-framework-)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)