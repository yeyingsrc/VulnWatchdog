## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致远程代码执行和完全控制服务器

**影响版本:** 3.5.0 <= Samba < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要对Samba共享目录具有写入权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Samba服务器中，允许恶意客户端上传共享库到可写共享目录，然后使服务器加载并执行它。

**有效性评估：**

根据漏洞信息和提供的POC代码，该POC的有效性较高。漏洞库信息明确指出该漏洞允许远程代码执行，并且有可用的Exploit-DB链接（42084和42060）。提供的POC代码包含了利用此漏洞的脚本 (exploit.py)，以及构建恶意共享库 (libpoc.so) 的方法。该脚本尝试通过NetBIOS over TCP协议 (ncacn_np) 连接到目标服务器的指定管道，从而触发恶意代码的执行。

**投毒风险评估：**

分析提供的POC代码，各个组件的功能如下：

*   `README.md`:  提供了漏洞利用的说明，包括Samba版本要求、Impacket依赖以及使用方法。
*   `exploit.py`:  利用脚本，用于连接到目标Samba服务器并触发漏洞。
*   `requirements.txt`:  定义了所需的Python依赖，即Impacket的特定版本。
*   `payload/build.sh`:  用于编译恶意共享库 `libpoc.so`。
*   `payload/poc.c`:  恶意共享库的源代码，其中包含`samba_init_module`函数，该函数在加载时会被执行。
*   `payload/poc.h`:  恶意共享库的头文件。

仔细检查上述文件后，没有发现任何明显的恶意或隐藏代码，旨在进行非预期的操作。`poc.c` 中的代码只是打印一条消息，用于验证漏洞是否成功利用。因此，可以认为该仓库中存在作者隐藏的投毒代码的风险较低。

**利用方式：**

1.  **环境准备：**搭建存在漏洞的Samba服务器（3.5.0 <= 版本 < 4.6.4, 4.5.10, 4.4.14）并配置可写的共享目录。
2.  **编译恶意共享库：**使用`payload/build.sh`脚本编译`payload/poc.c`，生成`libpoc.so`。
3.  **上传恶意共享库：**将`libpoc.so`上传到目标Samba服务器的可写共享目录。
4.  **执行漏洞利用：**运行`exploit.py`脚本，指定目标IP地址和上传的共享库路径，例如：`exploit.py -t <target_ip> -m /path/to/libpoc.so`。
5.  **触发漏洞：**`exploit.py` 将尝试建立一个指向恶意库路径的RPC连接，这将导致Samba服务器加载并执行该共享库，从而实现远程代码执行。

由于没有可信的搜索引擎结果，本次分析重点依赖漏洞库信息和提供的POC代码。

**项目地址:** [betab0t/cve-2017-7494](https://github.com/betab0t/cve-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)