## CVE-2017-0144 - Windows SMB 远程代码执行漏洞 (EternalBlue)

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows SMBv1 Server

**危害等级:** 高危，可能导致系统完全控制

**影响版本:** Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，且存在网络可达性。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-0144（EternalBlue）是一个针对Windows SMBv1服务器的远程代码执行漏洞。该漏洞允许未经身份验证的远程攻击者通过发送特制的SMB数据包在目标系统上执行任意代码。漏洞存在于SMBv1协议处理数据包的方式中，攻击者可以利用此缺陷来覆盖内存并最终获得系统控制权。提供的Python脚本 `eternalblue_scanner.py` 旨在检测目标系统是否存在此漏洞，它通过发送特定的SMB请求来检查目标系统是否易受攻击。

**有效性：**
提供的POC代码是一个扫描器，用于检测目标是否存在漏洞。漏洞利用本身需要额外的组件，例如EternalBlue的利用模块，以及DOUBLEPULSAR后门，该脚本只是检测是否存在漏洞。

**投毒风险：**
分析了提供的脚本`eternalblue_scanner.py`。该脚本主要功能是发送SMB协议数据包，根据返回结果判断目标主机是否存在MS17-010漏洞。脚本本身未发现明显的恶意代码。由于该脚本只是一个漏洞扫描工具，不包含漏洞利用代码，因此植入恶意后门的可能性较低。

**利用方式：**
1.  攻击者通过网络向目标系统发送特制的SMBv1数据包。
2.  这些数据包利用SMBv1协议中的漏洞，例如缓冲区溢出，来覆盖内存。
3.  攻击者可以将恶意代码注入到被覆盖的内存区域。
4.  当系统执行到被覆盖的内存区域时，恶意代码将被执行，从而导致远程代码执行。
5.  通常EternalBlue会配合DOUBLEPULSAR后门使用，攻击者先使用EternalBlue植入DOUBLEPULSAR后门，然后再通过DOUBLEPULSAR执行任意payload。 

**投毒风险说明：** 脚本本身扫描功能是正常的。但是，不排除作者在代码中隐藏其他不明显的功能，例如，将扫描结果发送到特定服务器。考虑到此类风险，将投毒风险评定为10%。

**项目地址:** [kimocoder/eternalblue](https://github.com/kimocoder/eternalblue)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)