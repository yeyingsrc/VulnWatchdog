## CVE-2017-7494 Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要Samba服务器开启可写共享，并且允许客户端上传文件

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2017-7494 漏洞允许恶意客户端通过上传包含恶意代码的共享库到可写共享，然后通过精心构造的SMB请求触发服务器加载并执行该恶意代码，从而实现远程代码执行。漏洞利用方式主要分为以下几个步骤：

1.  **发现目标：** 扫描网络，识别运行存在漏洞的Samba版本的服务器，重点关注开启了可写共享的服务器。
2.  **上传恶意共享库：** 攻击者将包含恶意代码的共享库（例如`.so`文件）上传到目标服务器的可写共享目录中。
3.  **构造恶意的SMB请求：** 攻击者向Samba服务器发送一个特制的SMB请求，该请求指定加载上传的恶意共享库。
4.  **触发代码执行：** Samba服务器在处理恶意SMB请求时，会加载并执行上传的共享库中的代码，从而导致远程代码执行。

**有效性评估：** 根据漏洞库信息和Exploit-DB中的expolit，该漏洞的POC代码应该是有效的，因为漏洞的描述清晰地说明了利用方式，并且存在公开的expolit。

**投毒风险评估：** 提供的代码片段 `CVE-2017-7494.nse` 是一个Nmap NSE脚本，用于检测目标Samba服务器是否运行着受CVE-2017-7494影响的版本。该脚本通过检查Samba的版本信息来判断是否存在潜在的漏洞。此脚本主要功能是做版本检测，不会进行漏洞利用。因此，投毒风险较低，但也不能完全排除作者在输出信息中加入恶意链接或其他隐蔽行为的可能性。给出的投毒风险评分为1%。

**项目地址:** [Waffles-2/SambaCry](https://github.com/Waffles-2/SambaCry)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)