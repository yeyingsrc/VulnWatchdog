## CVE-2017-0144 (EternalBlue)

**漏洞编号:** CVE-2017-0144

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Windows SMBv1

**危害等级:** 高危，可导致系统完全控制

**影响版本:** Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016

**利用条件:** 目标系统开启SMBv1服务，且攻击者可访问445端口。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-0144，又名EternalBlue，是一个严重的Windows SMBv1服务器漏洞，允许未经身份验证的远程攻击者通过精心构造的SMB数据包执行任意代码。该漏洞存在于处理SMBv1协议的方式中，攻击者可以利用此漏洞覆盖内存并最终控制系统。 

**有效性分析:**
根据漏洞库信息和提供的利用代码，该漏洞是真实存在的，并且已经存在公开的PoC。提供的Python脚本 `detectcve20170144.py` 旨在检测网络流量中是否存在CVE-2017-0144攻击的特征，而不是直接利用该漏洞。它通过捕获网络数据包，并检测SMB协议中是否存在特定的NT状态代码 `0xc000000d` 来判断是否可能存在EternalBlue攻击。

**投毒风险分析:**
提供的Python脚本主要功能是网络流量监控和检测，它会捕获网络数据包，特别是SMB协议的数据包，然后分析其中的`smb.nt_status`字段。如果该字段包含`0xc000000d`，则认为存在EternalBlue攻击的可能。脚本会将检测到的攻击信息输出到控制台，并记录到 `log.txt` 文件中。`bcd.csv` 文件记录了所有SMB数据包的信息，可能包含敏感信息。
脚本中存在投毒的风险较低，主要风险点在于记录流量到 `bcd.csv`可能泄漏敏感信息。
经过分析，我评估此代码的投毒风险为 5%。

**利用方式分析:**
1.  **漏洞触发:**  攻击者发送特制的SMBv1数据包到目标服务器的445端口。
2.  **内存覆盖:**  该数据包会利用漏洞覆盖SMBv1服务器进程的内存。
3.  **代码执行:**  攻击者可以在被覆盖的内存中注入并执行恶意代码，从而完全控制目标系统。

**利用步骤 (基于 Metasploit):**
1.  启动Metasploit (`msfconsole`).
2.  搜索EternalBlue相关的exploit (`search eternalblue`).
3.  使用 `exploit/windows/smb/ms17_010_eternalblue` 模块 (`use exploit/windows/smb/ms17_010_eternalblue`).
4.  设置目标IP地址 (`set RHOST <target_ip>`).
5.  运行exploit (`exploit`).

**修复建议:**
1.  禁用SMBv1协议（如果可能）。
2.  安装Microsoft发布的MS17-010安全补丁。
3.  使用防火墙阻止对445端口的未经授权的访问。

**项目地址:** [quynhold/Detect-CVE-2017-0144-attack](https://github.com/quynhold/Detect-CVE-2017-0144-attack)

**漏洞详情:** [CVE-2017-0144](https://nvd.nist.gov/vuln/detail/CVE-2017-0144)