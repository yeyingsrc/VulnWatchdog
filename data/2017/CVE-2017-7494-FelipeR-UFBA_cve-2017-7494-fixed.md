## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** since 3.5.0 and before 4.6.4, 4.5.10 and 4.4.14

**利用条件:** 需要Samba服务器开启可写共享，并且客户端能够访问该共享。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494，也被称为“SambaCry”，是一个存在于Samba服务器中的远程代码执行漏洞。该漏洞允许恶意客户端上传共享库到可写的共享目录，并诱使服务器加载并执行它。攻击者可以通过构造特定的请求，利用Samba服务器的漏洞，执行任意代码，从而完全控制受影响的服务器。提供的Dockerfile和相关配置文件构建了一个易受攻击的Samba服务器环境，方便漏洞的复现和测试。

**有效性：**

从漏洞库信息和提供的POC代码来看，该漏洞的利用是可行的。漏洞描述明确指出攻击者可以上传恶意共享库并执行，POC代码创建了一个具有可写权限的共享目录，并配置了Samba服务器允许guest访问，使得攻击者可以方便地上传和触发恶意代码执行。

**利用方式：**

1.  配置易受攻击的Samba服务器：使用提供的Dockerfile构建Samba服务器镜像。
2.  访问可写共享：使用Samba客户端（例如`smbclient`）连接到服务器的可写共享（例如`vuln`）。
3.  上传恶意共享库：将包含恶意代码的共享库（`.so`文件）上传到可写共享目录。
4.  触发漏洞：构造一个特殊的Samba请求，迫使服务器加载并执行上传的共享库。

**投毒风险：**

代码库中存在潜在的投毒风险，但风险较低。

*   Dockerfile中的`apt-get install -y`命令可能安装额外的恶意软件包，但是没有发现可疑软件。
*   `entrypoint.sh`脚本启动Samba服务并进入bash shell，这本身不是恶意行为，但如果攻击者获取了容器的控制权，他们就可以在容器内部执行任意命令。
*   `smb.conf`配置文件中的`guest ok = yes`和`public = yes`允许未经身份验证的访问，这是漏洞利用的必要条件，但同时会增加攻击面，如果攻击者能篡改这个配置文件，可能会添加后门账户。

总体来说，投毒的风险较低，约为10%。主要的风险在于攻击者控制了容器后的潜在恶意行为，以及配置文件的潜在篡改。


**项目地址:** [FelipeR-UFBA/cve-2017-7494-fixed](https://github.com/FelipeR-UFBA/cve-2017-7494-fixed)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)