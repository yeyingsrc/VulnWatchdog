## CVE-2021-43008-Adminer-任意文件读取

**漏洞编号:** CVE-2021-43008

**漏洞类型:** 任意文件读取

**影响应用:** Adminer

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** 1.12.0 to 4.6.2

**利用条件:** 目标系统运行存在漏洞的Adminer实例，攻击者可以访问该实例。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

该漏洞存在于Adminer 1.12.0到4.6.2版本中。攻击者可以通过控制Adminer连接的MySQL服务器，利用`LOAD DATA LOCAL INFILE`特性读取服务器上的任意文件。 

**利用方式：**

1.  **连接到恶意的MySQL服务器：** 攻击者搭建一个恶意的MySQL服务器，当Adminer尝试连接该服务器时，攻击者可以控制服务器的行为。
2.  **利用`LOAD DATA LOCAL INFILE`读取文件：**  恶意的MySQL服务器向Adminer发送`LOAD DATA LOCAL INFILE`命令，指定要读取的本地文件路径。由于Adminer存在漏洞，它会尝试读取该文件并将内容返回给恶意服务器。

**漏洞利用代码分析：**

提供的Python脚本尝试利用Adminer的SQL执行功能，虽然脚本中没有直接利用`LOAD DATA LOCAL INFILE`，但脚本展示了如何通过Adminer执行SQL命令，攻击者可以在这里注入恶意的`LOAD DATA LOCAL INFILE`命令。 

脚本首先尝试通过POST请求登录Adminer，然后执行一些SQL命令，例如清空表和加载数据。

**投毒风险分析：**

脚本本身主要功能是连接到Adminer并执行SQL，但存在一定的投毒风险，体现在以下几个方面：

1.  **`script.sh`：**  脚本通过subprocess调用了`script.sh`,  虽然根据上下文判断此脚本大概率为mysql服务的初始化脚本, 但不排除该脚本存在恶意代码的可能性。这是一个潜在的投毒点。
2.  **依赖风险：**  脚本依赖requests和BeautifulSoup4等库，如果这些库被恶意篡改，可能导致代码执行漏洞。
3.  **SQL注入风险：** 虽然脚本对SQL语句进行了URL编码，但如果目标Adminer存在其他SQL注入漏洞，攻击者可能利用脚本执行任意SQL代码。
4. **LOAD DATA LOCAL INFILE**: 代码中存在 `LOAD DATA LOCAL INFILE 'C:/Users/ivani/Desktop/Пентест/Solr.txt' INTO TABLE lfr_sink`, 此处文件路径如果被修改成其他敏感文件，可能会导致信息泄露。

综合以上分析，投毒风险评估为20%。主要风险来自`script.sh`脚本和潜在的SQL注入/依赖风险，因此需要进一步审查这些组件才能确定是否存在恶意代码。

**项目地址:** [DaturaSaturated/Adminer-CVE-2021-43008](https://github.com/DaturaSaturated/Adminer-CVE-2021-43008)

**漏洞详情:** [CVE-2021-43008](https://nvd.nist.gov/vuln/detail/CVE-2021-43008)