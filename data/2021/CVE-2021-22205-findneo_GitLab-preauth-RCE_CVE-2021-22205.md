## CVE-2021-22205 - GitLab ExifTool 命令注入

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 命令注入

**影响应用:** GitLab

**危害等级:** 高危，未经身份验证的远程命令执行

**影响版本:** >=11.9, <13.8.8 || >=13.9, <13.9.6 || >=13.10, <13.10.3

**利用条件:** 目标GitLab实例需要存在漏洞版本，并且可以通过网络访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22205是一个GitLab CE/EE中的命令注入漏洞，存在于11.9到13.10.3之间的多个版本中。漏洞原因是GitLab在处理图像文件时，未正确验证传递给文件解析器的输入，导致攻击者可以利用特制的图像文件执行任意命令。

**漏洞利用方式：**

1.  攻击者构造一个恶意的图像文件，该文件包含嵌入的恶意命令。POC代码中，使用了`xxd`命令将十六进制数据转换成二进制数据，并追加到名为`1.jpg`的文件中。其中，追加的十六进制数据中包含了shell命令，最终将`xxx_base64_of_reverse_shell_code_xxx`进行base64解码后执行。
2.  攻击者通过`curl`命令，模拟文件上传请求，将恶意图像文件上传到存在漏洞的GitLab实例。POC代码通过获取用户的CSRF-Token，然后利用/uploads/user接口上传。
3.  GitLab使用ExifTool处理上传的图像文件时，由于图像文件中的恶意命令，导致ExifTool执行该命令，从而实现远程命令执行。
4.  POC中使用了`base64 -d|bash` 的方式执行payload。

**投毒风险分析：**

提供的POC代码目的是利用该漏洞实现远程代码执行，虽然执行了外部命令，但是没有发现作者在其中隐藏其他恶意代码的行为。代码清晰地展示了漏洞利用的过程，没有发现试图在目标系统上安装后门或进行其他恶意操作的迹象。该POC的主要目的是演示漏洞利用，而非进行实际的恶意攻击。

因此，投毒风险评估为 0%。

**项目地址:** [findneo/GitLab-preauth-RCE_CVE-2021-22205](https://github.com/findneo/GitLab-preauth-RCE_CVE-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)