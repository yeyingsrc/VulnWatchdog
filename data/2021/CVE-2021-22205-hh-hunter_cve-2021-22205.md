## CVE-2021-22205-GitLab-远程命令执行

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程命令执行

**影响应用:** GitLab

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 需要网络访问GitLab实例，目标实例使用受影响的版本，并且可上传图片（或其他利用ExifTool解析的文件类型）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22205是GitLab CE/EE中的一个远程命令执行漏洞。该漏洞源于GitLab对上传的图片文件（或其他利用ExifTool解析的文件类型）的校验不严格，允许攻击者通过构造恶意的图片文件，利用ExifTool执行任意命令。

**有效性：**
提供的docker-compose文件主要用于搭建存在漏洞和不存在漏洞的环境，用于验证漏洞的修复效果。docker-compose-vulnerability.yml 使用了13.9.5-ee.0版本，在受影响的版本范围内，可以验证漏洞。

**投毒风险：**
提供的docker-compose文件仅仅用于构建环境，没有发现恶意代码，投毒风险为0%。

**利用方式：**
攻击者通过上传特制的恶意图片文件（例如，包含恶意命令的Exif元数据的图片文件）到GitLab服务器。GitLab使用ExifTool解析该图片文件时，会执行图片中嵌入的恶意命令，从而导致远程命令执行。具体步骤如下：

1.  构造包含恶意命令的图片文件。
2.  将该图片文件上传到GitLab服务器。例如，可以通过头像上传、项目logo上传等功能。
3.  GitLab服务器调用ExifTool解析该图片文件，执行嵌入的恶意命令。
4.  攻击者通过执行的命令控制服务器。

**项目地址:** [hh-hunter/cve-2021-22205](https://github.com/hh-hunter/cve-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)