## CVE-2021-22205-GitLab-RCE

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程代码执行

**影响应用:** GitLab

**危害等级:** 严重，可能导致完全控制服务器

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 需要目标GitLab实例运行在受影响的版本，并且能够通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于GitLab中，由于ExifTool在处理图像文件时未正确验证，导致远程命令执行。攻击者可以通过上传特制的图像文件触发漏洞。具体来说，GitLab使用ExifTool处理上传的图像，而ExifTool在处理DjVu格式文件时，存在代码注入漏洞。攻击者构造包含恶意代码的DjVu文件，将其上传至GitLab，当GitLab尝试解析该文件时，恶意代码将被执行，从而实现远程代码执行。

**有效性：**
提供的POC代码利用了CVE-2021-22205漏洞，经验证有效。它通过创建包含恶意元数据的DjVu图像文件，然后将其上传到GitLab实例。当GitLab处理该图像时，ExifTool会执行嵌入在元数据中的命令。

**投毒风险：**
分析提供的POC代码，没有发现任何隐藏的投毒代码。该代码的功能明确，即利用CVE-2021-22205漏洞执行命令。所有操作都在脚本中清晰可见，没有混淆或隐藏行为。

**利用方式：**
1.  攻击者首先需要获取目标GitLab实例的URL。
2.  然后，攻击者使用POC脚本生成一个包含恶意DjVu元数据的图像文件。
3.  脚本使用`djvumake`命令创建一个包含恶意payload的`rce.djvu`文件，再将其重命名为`rce.jpg`。
4.  POC代码通过模拟文件上传请求，将特制的图像文件上传到GitLab实例。
5.  GitLab接收到文件后，会调用ExifTool进行处理，由于ExifTool存在漏洞，导致执行图像文件中嵌入的恶意代码。
6.  攻击者指定的命令将在GitLab服务器上执行，从而实现远程代码执行。

**项目地址:** [mr-r3bot/Gitlab-CVE-2021-22205](https://github.com/mr-r3bot/Gitlab-CVE-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)