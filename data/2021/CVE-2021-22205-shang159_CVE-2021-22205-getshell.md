## CVE-2021-22205-GitLab-远程命令执行

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程命令执行

**影响应用:** GitLab

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 目标GitLab实例版本在受影响范围内，且攻击者可以上传文件

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是由于GitLab对上传的图像文件解析不当，导致远程命令执行。攻击者可以构造包含恶意代码的图片（例如DJVU格式）并上传到GitLab，当GitLab使用ExifTool等工具解析图片时，恶意代码会被执行。根据提供的漏洞利用代码，利用方式如下：

1.  **构造Payload：**  使用Python脚本生成包含反弹shell命令的DJVU图片。脚本通过修改图片的元数据（Copyright字段）嵌入命令。Payload包含执行shell命令的代码，例如反弹shell到攻击者控制的IP地址和端口。
2.  **上传图片：** 将生成的图片上传到GitLab。根据POC描述，不同版本的GitLab上传点可能不同，需要尝试不同的上传路径（例如issue页面）。
3.  **触发漏洞：** GitLab后端使用ExifTool处理上传的图片时，会解析图片元数据，从而执行嵌入的恶意命令。
4.  **获取Shell：** 攻击者在本地监听指定端口，等待目标机器反弹shell连接，从而获取对服务器的控制权。

**有效性：** 根据提供的POC代码和漏洞描述，该POC应该是有效的，可以用于在受影响的GitLab版本上实现远程命令执行。

**投毒风险：** 分析提供的POC代码，没有发现明显的投毒代码。该代码主要功能是生成包含恶意命令的图片文件，以及一些辅助脚本。因此，投毒风险较低，为0%。

**项目地址:** [shang159/CVE-2021-22205-getshell](https://github.com/shang159/CVE-2021-22205-getshell)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)