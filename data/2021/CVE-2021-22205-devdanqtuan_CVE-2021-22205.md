## CVE-2021-22205-GitLab-远程命令执行

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** GitLab

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 目标 GitLab 实例需要存在漏洞，且攻击者能够通过网络访问 GitLab 实例。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-22205 是一个 GitLab 远程命令执行漏洞。该漏洞是由于 GitLab 没有正确验证传递给文件解析器的图像文件导致的。攻击者可以通过上传特制的恶意图像文件，利用 ExifTool 中的命令注入漏洞执行任意命令。

**利用方式:**

1.  攻击者首先获取目标 GitLab 实例的 CSRF Token，该 Token 可通过访问登录页面获得。
2.  攻击者构造一个包含恶意命令的 DJVU 图像文件。该文件利用 ExifTool 的漏洞，在解析元数据时执行攻击者指定的命令。
3.  攻击者使用 multipart/form-data 将恶意图像文件上传到 GitLab 的头像上传接口 `/uploads/user`。
4.  GitLab 调用 ExifTool 解析图像文件，ExifTool 执行恶意命令，导致远程命令执行。

**有效性:**

提供的 POC 代码有效。它模拟了上述利用流程，能够成功触发漏洞并执行命令。POC 通过构造恶意的 DJVU 图像文件，将命令注入到 ExifTool 可以解析的元数据中。上传包含恶意命令的图片到存在漏洞的GitLab服务器，即可执行命令。

**投毒风险:**

代码整体是用于复现漏洞，但存在微小的投毒风险。主要风险点在于攻击命令的构造以及攻击者可能通过修改`target_url`来达到攻击目的。考虑到POC本身就是漏洞利用代码，所以正常使用场景下是没问题的。除非，有人故意魔改此代码，或者在批量测试时，使用者未检查url，可能会有一定风险。故认为投毒风险较低，约为1%。

**优先级:**

由于搜索引擎没有提供结果，因此优先级为漏洞利用代码 > 漏洞库信息。

**项目地址:** [devdanqtuan/CVE-2021-22205](https://github.com/devdanqtuan/CVE-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)