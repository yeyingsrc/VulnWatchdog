## CVE-2021-22205-GitLab-RCE

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程代码执行

**影响应用:** GitLab

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** >=11.9, <13.8.8, >=13.9, <13.9.6, >=13.10, <13.10.3

**利用条件:** 目标GitLab实例存在漏洞且可网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22205 是一个 GitLab CE/EE 中的远程代码执行漏洞。该漏洞源于 GitLab 没有正确验证传递给文件解析器的图像文件，导致远程命令执行。

**有效性:**
根据漏洞库信息和提供的漏洞利用代码，此漏洞POC有效。漏洞库中CVSS评分为10，属于严重漏洞，CISA KEV中也标记为已知被利用漏洞，结合提供的代码，证明该漏洞存在且容易被利用。

**投毒风险:**
分析提供的POC代码，该代码主要实现了以下功能：

*   DNSLog 探测：通过 DNSLog 验证漏洞是否存在。
*   RCE：利用 Postbin 进行带外命令执行。
*   反弹 Shell：反弹 shell 到指定的 host 和 port。
*   上传文件：通过 http 协议上传文件到目标服务器（需要 VPS）。

代码主要集中在漏洞利用，没有发现明显的投毒行为。该工具需要使用者提供目标URL和命令，或者反弹shell地址，没有发现作者预留后门的迹象。因此，投毒风险较低，评估为0%。

**利用方式:**

1.  **漏洞检测:**  使用 `-m detect`  选项，通过 DNSLog 验证目标是否存在漏洞。程序会生成一个包含 DNS 查询请求的文件，如果目标存在漏洞，会向指定的 DNSLog 服务器发送请求，从而验证漏洞。
2.  **命令执行:**
    *   使用 `-m rce1` 选项，通过 Postbin 执行命令。程序构造一个包含命令的文件，并将其上传到目标服务器。目标服务器在解析该文件时，会触发漏洞并执行命令，并将结果发送到 Postbin。
3.  **反弹 Shell:** 使用 `-m rev` 选项，反弹 shell 到指定的 host 和 port。程序构造一个包含反弹 shell 命令的文件，并将其上传到目标服务器。目标服务器在解析该文件时，会触发漏洞并执行反弹 shell 命令，从而建立与攻击者服务器的连接。
4.  **文件上传:** 使用 `-m upload` 选项，上传文件到目标服务器。程序构造一个包含要上传的文件的文件，并将其上传到目标服务器。目标服务器在解析该文件时，会触发漏洞并将文件保存到指定位置。

此漏洞利用的关键在于利用ExifTool处理图片时，由于未对传入参数进行严格过滤，导致攻击者可以通过构造恶意图片，在ExifTool执行过程中执行任意命令。


**项目地址:** [c0okB/CVE-2021-22205](https://github.com/c0okB/CVE-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)