## CVE-2021-21980 - VMware vCenter Server Web Client 任意文件读取

**漏洞编号:** CVE-2021-21980

**漏洞类型:** 任意文件读取

**影响应用:** VMware vCenter Server

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** VMware vCenter Server (6.7 before 6.7 U3p and 6.5 before 6.5 U3r) and VMware Cloud Foundation 3.x

**利用条件:** 需要网络访问vCenter Server的443端口

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 VMware vCenter Server 的 vSphere Web Client (FLEX/Flash) 组件中，允许未经身份验证的攻击者通过向 `/ui/vic-rest/services/containerView` 端点发送包含路径遍历序列的请求，读取服务器上的任意文件。

**有效性：**
提供的 Nuclei 模板 `CVE-2021-21980.yaml` 经验证有效。它通过发送包含路径遍历的 GET 请求到目标服务器的 `/ui/vic-rest/services/containerView` 端点来利用此漏洞。 验证通过检查响应体中是否存在 "root:x:0:0:" 以及状态码是否为200，header中是否存在VMware。

**投毒风险：**
分析提供的文件，未发现明显的投毒代码。
*   `Dockerfile` 用于构建一个包含脆弱 Flask 应用的 Docker 镜像，该 Flask 应用模拟了 VMware vCenter Server 存在漏洞的端点。
*   `server.py` 是一个 Flask 应用，它接收来自 `/ui/vic-rest/services/containerView` 端点的请求，并尝试读取由 `id` 参数指定的文件。存在路径遍历漏洞。
*   `CVE-2021-21980.yaml` 是 Nuclei 模板，用于自动化检测和利用此漏洞。
*   `README.md` 包含有关如何构建、运行和测试此脆弱环境的说明。
*   `docker-compose.yml` 文件用于定义和运行多容器 Docker 应用程序，简化了环境的部署。
*   `nuclei-validation-output.txt` 文件记录了使用 Nuclei 验证该漏洞的输出，证明了漏洞的存在和利用。

**利用方式：**
1.  攻击者构造包含路径遍历序列的 URL，例如：`https://<vcenter_server>/ui/vic-rest/services/containerView?id=../../../etc/passwd`。
2.  攻击者向 vCenter Server 的 443 端口发送该 URL 的 GET 请求。
3.  vCenter Server 上的 vSphere Web Client 接收到请求，由于对 `id` 参数的验证不足，允许攻击者读取 `/etc/passwd` 文件或其他任意文件。
4.  攻击者从响应中获取文件内容。

**项目地址:** [pratikjojode/vcenter-cve-2021-21980-lab](https://github.com/pratikjojode/vcenter-cve-2021-21980-lab)

**漏洞详情:** [CVE-2021-21980](https://nvd.nist.gov/vuln/detail/CVE-2021-21980)