## CVE-2021-3129 - Laravel Ignition Remote Code Execution

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel (with Ignition)

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** Ignition < 2.5.2, Laravel < 8.4.2 (debug mode enabled)

**利用条件:** 目标网站必须启用 debug 模式，且使用受影响的 Laravel 和 Ignition 版本。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3129 漏洞存在于 Laravel 的 Ignition 组件中，允许未经身份验证的远程攻击者通过不安全地使用 `file_get_contents()` 和 `file_put_contents()` 函数来执行任意代码。此漏洞只在开启 `debug` 模式的 Laravel 应用中存在，尤其是 Laravel 8.4.2 之前的版本。

**漏洞利用方式：**

1.  攻击者发送特制的 HTTP 请求到目标服务器上的 `/_ignition/health-check` 路由。
2.  攻击利用 Ignition 组件中存在的问题，可以写入任意文件。
3.  通过写入恶意 PHP 代码到服务器，攻击者可以执行任意命令。

**POC 代码分析：**

提供的 POC 代码 (`laravel_debug.py`) 主要用于检测目标网站是否存在 CVE-2021-3129 漏洞。它通过发送请求到 `/_ignition/health-check` 路由，并检查响应中是否包含 `{"can_execute_commands":true}`，来判断目标是否易受攻击。如果检测到易受攻击的目标，它会将 URL 写入 `laravel-log.txt` 文件。该脚本本身并不能直接利用漏洞执行命令，而是用于快速发现潜在的攻击目标。

**投毒风险分析：**

*   `LICENSE` 文件：标准的 MIT 许可证，无风险。
*   `README.md` 文件：包含项目描述、安装说明和图片链接，无恶意代码。
*   `laravel_debug.py` 文件：此文件是漏洞扫描器，主要功能是探测目标是否存在漏洞。虽然本身不包含恶意后门代码，但有可能被修改来执行恶意操作，例如：
    *   修改请求头，伪装成正常流量。
    *   添加额外的网络请求，例如向攻击者的服务器发送目标信息。
    *   在扫描到存在漏洞的目标时，自动执行恶意代码 (虽然现在的代码只写入日志)。
    *   收集目标系统的指纹信息，进行有针对性的攻击
*   `requirements.txt` 文件：指定了项目依赖的 Python 库。攻击者可能通过替换或添加恶意库来实施供应链攻击。检查发现依赖库版本较为旧，存在一定的安全隐患。

综合来看，此仓库中的代码本身投毒风险较低，但存在被恶意修改的可能性。因此，对于从未知来源获取的代码，务必进行代码审计。

**项目地址:** [MadExploits/Laravel-debug-Checker](https://github.com/MadExploits/Laravel-debug-Checker)

**漏洞详情:** [CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)