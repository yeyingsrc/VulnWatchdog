## CVE-2023-27532 - Veeam Backup & Replication 敏感信息泄露/远程代码执行

**漏洞编号:** CVE-2023-27532

**漏洞类型:** 敏感信息泄露/远程代码执行

**影响应用:** Veeam Backup & Replication

**危害等级:** 高危，可能导致敏感凭据泄露以及完全控制备份基础设施

**影响版本:** 受影响版本：v12 (build 12.0.0.1420 P20230223), 11a (build 11.0.1.1261 P20230227)

**利用条件:** 需要网络可达目标Veeam Backup & Replication服务器，默认端口9401开放。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-27532 允许未经身份验证的攻击者获取存储在Veeam Backup & Replication配置数据库中的加密凭据。此漏洞存在两种利用方式：

1.  **凭据泄露：** PoC 代码中，如果未指定 `--cmd` 参数，则会尝试利用 `CredentialsDbScopeGetAllCreds` 方法泄露加密凭据。这些凭据可以通过某种方式解密，从而获得对备份基础设施主机的访问权限。
2.  **远程代码执行：** PoC 代码中，如果指定了 `--cmd` 参数，则会利用 SQL 注入漏洞（`xp_cmdshell`）执行任意命令。PoC 首先启用 `xp_cmdshell`，然后使用它来执行提供的命令。这允许攻击者在 Veeam Backup & Replication 服务器上执行任意代码。

**有效性评估：**

根据提供的 PoC 代码以及 CVE 信息（尤其 CISA KEV 目录中包含此漏洞），漏洞是有效的。该 PoC 旨在利用未经授权的远程调用服务来提取凭据或执行任意命令。

**投毒风险分析：**

代码分析显示，该 PoC 的目的是利用漏洞，没有明显的迹象表明作者添加了任何恶意或隐藏的功能（例如，安装后门、传播恶意软件等）。它只是利用了已知的漏洞来进行攻击。因此，可以判断该 PoC 中不存在投毒代码的概率为 0%。

**利用方式总结：**

1.  攻击者使用 PoC 针对目标 Veeam Backup & Replication 服务器的 9401 端口。该端口运行着未经身份验证的远程调用服务。
2.  如果没有指定 `--cmd` 参数，PoC 将尝试调用 `CredentialsDbScopeGetAllCreds` 方法，以泄露加密凭据。
3.  如果指定了 `--cmd` 参数，PoC 将利用 SQL 注入执行任意命令。
4.  利用成功后，攻击者可以获得对 Veeam Backup & Replication 服务器的控制权限，从而可以访问和修改备份数据，甚至破坏备份基础设施。

**项目地址:** [sfewer-r7/CVE-2023-27532](https://github.com/sfewer-r7/CVE-2023-27532)

**漏洞详情:** [CVE-2023-27532](https://nvd.nist.gov/vuln/detail/CVE-2023-27532)