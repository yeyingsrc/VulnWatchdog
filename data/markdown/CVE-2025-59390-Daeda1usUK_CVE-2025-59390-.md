## CVE-2025-59390-Apache Druid-Kerberos认证绕过

**漏洞编号:** CVE-2025-59390

**漏洞类型:** 认证绕过

**影响应用:** Apache Druid

**危害等级:** 高危，可能导致未授权访问和数据泄露

**影响版本:** <= 34.0.0

**利用条件:** Druid集群未显式配置`druid.auth.authenticator.kerberos.cookieSignatureSecret`

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Apache Druid的Kerberos认证模块。当未显式配置`druid.auth.authenticator.kerberos.cookieSignatureSecret`时，Druid使用`ThreadLocalRandom`生成弱密钥，这使得攻击者能够预测或暴力破解cookie签名密钥，从而伪造token或绕过认证。提供的POC代码利用已知的`ThreadLocalRandom`算法，通过已知的部分输出来逆向计算出初始种子，进而预测后续生成的随机数。由于`ThreadLocalRandom`不是密码学安全的随机数生成器，因此是可行的。POC代码未发现明显的投毒风险，代码逻辑清晰，主要用于逆向工程`ThreadLocalRandom`生成的随机数。利用方式如下：

1.  **前提条件：**目标Druid集群未配置`druid.auth.authenticator.kerberos.cookieSignatureSecret`，使用默认的弱密钥生成机制。
2.  **信息收集：**攻击者需要获取至少两个由Druid服务器生成的、使用默认弱密钥签名的Kerberos认证cookie。
3.  **密钥破解：**使用提供的POC代码，输入cookie中的部分信息（通常是签名的一部分），逆向计算出`ThreadLocalRandom`的初始种子。
4.  **Cookie伪造：**利用破解出的种子，攻击者可以预测后续生成的密钥，从而构造有效的Kerberos认证cookie，冒充任意用户访问Druid集群。
5.  **攻击成功：**攻击者利用伪造的cookie绕过Kerberos认证，获得未授权的访问权限，从而可以执行任意查询、修改数据或执行其他恶意操作。

有效性分析：POC代码有效，能够逆向计算`ThreadLocalRandom`生成的密钥。
投毒风险分析：POC代码未发现投毒代码。
利用方式总结：攻击者通过逆向`ThreadLocalRandom`生成的弱密钥，伪造Kerberos认证cookie，绕过身份验证。

**项目地址:** [Daeda1usUK/CVE-2025-59390-](https://github.com/Daeda1usUK/CVE-2025-59390-)

**漏洞详情:** [CVE-2025-59390](https://nvd.nist.gov/vuln/detail/CVE-2025-59390)