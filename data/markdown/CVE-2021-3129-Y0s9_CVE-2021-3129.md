## CVE-2021-3129-Laravel Ignition 远程代码执行

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel Ignition

**危害等级:** 高危，可导致服务器完全控制

**影响版本:** Ignition < 2.5.2, Laravel <= 8.4.2 (开启debug模式)

**利用条件:** Laravel应用开启debug模式，且使用受影响的Ignition版本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-3129 漏洞存在于 Laravel 的 Ignition 组件中。由于不安全地使用 `file_get_contents()` 和 `file_put_contents()` 函数，攻击者可以通过构造恶意的请求，将包含恶意 PHP 代码的 payload 写入 Laravel 的日志文件，然后通过反序列化操作执行该代码，从而实现远程代码执行。

**利用方式：**
1.  **前提条件：** Laravel 应用必须开启 debug 模式，且使用了受影响的 Ignition 组件版本。
2.  **漏洞触发：** 攻击者发送包含恶意 payload 的 POST 请求到 `_ignition/execute-solution` 接口。
3.  **Payload 构造：**  POC代码利用 `phpggc` 工具生成包含恶意 PHP 对象的 payload，该 payload 在反序列化时会触发系统命令执行。
4.  **日志写入：**  恶意 payload 通过 `file_put_contents()` 写入 Laravel 的日志文件 (`storage/logs/laravel.log`)。
5.  **反序列化触发：** 再次发送请求，通过 `phar://` 协议触发对日志文件的反序列化操作。
6.  **命令执行：**  反序列化过程执行 payload 中包含的恶意 PHP 代码，从而执行攻击者指定的系统命令。

**有效性评估：**
提供的 POC 代码是有效的。 它使用了 `phpggc` 生成 payload，并且实现了漏洞利用的整个流程，包括 payload 发送、日志写入、反序列化触发和命令执行。

**投毒风险评估：**
提供的 POC 代码中，没有发现明显的投毒代码。代码逻辑清晰，主要功能是利用漏洞执行命令。 `phpggc` 工具链的调用需要用户自行安装 `phpggc`，但该工具本身是一个知名的 PHP 反序列化漏洞利用工具，可以信赖。 该代码的主要功能是生成并发送恶意 payload，然后解析返回的结果。因此投毒风险极低，评分为0%。

**项目地址:** [Y0s9/CVE-2021-3129](https://github.com/Y0s9/CVE-2021-3129)

**漏洞详情:** [CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)