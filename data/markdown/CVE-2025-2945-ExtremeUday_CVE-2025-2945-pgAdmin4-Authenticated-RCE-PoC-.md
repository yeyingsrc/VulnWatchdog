## CVE-2025-2945 – pgAdmin4 Authenticated RCE

**漏洞编号:** CVE-2025-2945

**漏洞类型:** 远程代码执行

**影响应用:** pgAdmin4

**危害等级:** 严重，允许远程代码执行

**影响版本:** < 9.2

**利用条件:** 需要有效的pgAdmin4 账号和数据库账号

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-2945 是 pgAdmin 4 中的一个远程代码执行漏洞，影响 Query Tool 和 Cloud Deployment 模块。漏洞存在于两个 POST 端点：/sqleditor/query_tool/download，其中 query_commited 参数；/cloud/deploy 端点，其中 high_availability 参数，这些参数会被不安全地传递给 Python 的 eval() 函数，允许执行任意代码。

**有效性分析：**
提供的 POC 代码看起来是有效的，它旨在利用 pgAdmin4 中的 CVE-2025-2945 漏洞。它包含以下关键步骤：
  1. 检查 pgAdmin4 版本是否在受影响范围内 (8.10 -> 9.1)。
  2. 身份验证并检索 CSRF 令牌。
  3. 检测有效的服务器 ID。
  4. 初始化 SQL 编辑器。
  5. 通过 Query Tool 下载器端点发送有效负载，该有效负载利用 eval() 函数执行任意代码，建立反向 shell。

**投毒风险分析：**
检查了提供的 POC 代码，发现以下潜在风险：
  1. 混淆或无效代码：攻击者可能会添加混淆或无效代码，使漏洞利用失败或行为异常，从而误导安全分析人员。
  2. 依赖项问题：攻击者可能会引入恶意的第三方依赖项，从而在执行漏洞利用代码时引入其他漏洞。

总体而言，该 POC 中存在投毒代码的可能性较低，约为 10%。主要风险在于攻击者可能会修改反向 shell 的连接目标，使其连接到攻击者控制的恶意服务器。

**利用方式分析：**
利用方式涉及以下步骤：
  1. 身份验证：使用提供的用户名和密码登录到 pgAdmin4。
  2. 获取 CSRF 令牌：从登录响应中提取 CSRF 令牌，以绕过 CSRF 保护。
  3. 初始化 SQL 编辑器：向 /sqleditor/initialize/ 和 /sqleditor/panel/ 发送请求，以正确初始化 SQL 编辑器。
  4. 发送恶意负载：通过 /sqleditor/query_tool/download 端点发送包含恶意 Python 代码的请求，利用 eval() 函数执行任意代码。
  5. 反向 Shell：有效负载配置为执行反向 shell，连接回攻击者控制的 IP 地址和端口，从而允许远程代码执行。

此漏洞的利用依赖于能够通过身份验证访问 pgAdmin4 实例，并且 pgAdmin4 版本易受攻击。

**项目地址:** [ExtremeUday/CVE-2025-2945-pgAdmin4-Authenticated-RCE-PoC-](https://github.com/ExtremeUday/CVE-2025-2945-pgAdmin4-Authenticated-RCE-PoC-)

**漏洞详情:** [CVE-2025-2945](https://nvd.nist.gov/vuln/detail/CVE-2025-2945)