## CVE-2024-50629 - Synology DSM/BSM Improper Encoding/Escaping of Output

**漏洞编号:** CVE-2024-50629

**漏洞类型:** 信息泄露

**影响应用:** Synology DSM/BeeStation OS

**危害等级:** 中危，可能导致有限的文件读取

**影响版本:** 受影响版本请参考漏洞库信息

**利用条件:** 需要网络访问，目标设备运行受影响的Synology DSM或BeeStation OS版本，端口5000开放

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞源于 Synology DSM 和 BeeStation OS 中的 webapi 组件对输出的不当编码或转义。攻击者可以通过未指定的向量读取有限的文件。 

**利用方式：**
1.  **CRLF 注入：** 通过`redirect_url`参数向`/webapi/entry.cgi`的`SYNO.API.Auth.RedirectURI` API 发送包含 CRLF 序列的 HTTP 请求头注入 payload。该payload将 `X-Accel-Redirect` 设置为指向日志文件（例如`cloud-workerd.log`）。利用 Nginx 的 `X-Accel-Redirect` 机制读取该日志文件。
2.  **用户名提取：** 从读取到的日志文件中提取用户名，日志中可能包含类似`'watch_path':'/homes/<username>'`的条目。
3.  **身份验证绕过：** 使用提取到的用户名，向`/webapi/entry.cgi`的`SYNO.SynologyDrive.Authentication` API 发送认证请求，绕过身份验证。

**有效性分析：**
POC 代码实现了上述三个步骤，利用了 CRLF 注入读取日志文件，然后通过提取的用户名绕过身份验证。根据漏洞库信息，CVSS 评分为 5.3，表明漏洞利用的有效性有限，只能读取有限的文件。

**投毒风险分析：**
该 POC 代码主要功能是利用漏洞读取文件和绕过身份验证，没有发现明显的恶意代码或后门。代码主要由网络请求、字符串处理和简单的协议编码构成，功能相对明确。虽然可能被修改用于更进一步的攻击（例如：读取配置文件获取敏感信息），但当前的 POC 代码本身不包含投毒代码。

**项目地址:** [kiddo-pwn/CVE-2024-50629_50631](https://github.com/kiddo-pwn/CVE-2024-50629_50631)

**漏洞详情:** [CVE-2024-50629](https://nvd.nist.gov/vuln/detail/CVE-2024-50629)