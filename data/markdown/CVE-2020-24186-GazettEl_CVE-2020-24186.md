## CVE-2020-24186-wpDiscuz-RCE

**漏洞编号:** CVE-2020-24186

**漏洞类型:** 远程代码执行

**影响应用:** wpDiscuz

**危害等级:** 高危，允许未经身份验证的用户上传任意文件，包括PHP文件，从而导致远程代码执行。

**影响版本:** 7.0 <= version <= 7.0.4

**利用条件:** 目标WordPress站点安装了受影响版本的wpDiscuz插件，并且允许外部网络访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2020-24186存在于gVectors wpDiscuz插件7.0到7.0.4版本中。攻击者可以利用此漏洞，通过`wmuUploadFiles` AJAX action上传任意类型的文件，包括PHP文件，而无需进行身份验证。 

**利用方式：**

1.  **查找`wmuSecurity` token:**  通过GET请求访问WordPress博客页面，从中提取`wmuSecurity` token。这个token用于绕过插件的初步安全检查。
2.  **生成随机PHP文件名:**  生成一个随机的PHP文件名，用于上传恶意payload。
3.  **上传Payload:**  构造一个POST请求，将恶意PHP payload作为文件上传到`wp-admin/admin-ajax.php`，其中`action`参数设置为`wmuUploadFiles`，`wmu_nonce`参数设置为获取到的`wmuSecurity` token。Payload会伪装成GIF图片，以绕过进一步的文件类型验证。
4.  **执行Payload:**  从POST请求的响应JSON数据中提取上传文件的URL，然后通过访问该URL来执行上传的PHP代码。
5.  **交互式Shell (可选):**  使用提供的`interactive_shell`函数，通过webshell与目标系统进行交互。

**投毒风险：**

代码中没有明显的恶意行为，例如故意破坏或窃取信息。存在使用代理的配置，但这是可选的，并且在渗透测试中很常见。`pwn` 库的使用也仅限于建立简单的 listener。生成随机文件名，以及将 payload 伪装成 GIF 图片也在常见的绕过手段之内。总体投毒风险较低。
代码存在一些调试信息，例如大量的 `print` 语句，这在生产环境中的 exploit 中是不常见的，但不能直接判定为投毒行为。代码整体结构清晰，易于阅读，没有发现明显的混淆或隐藏恶意代码的尝试。

所以综上，投毒风险约为 1%。

**有效性：**
根据提供的漏洞信息和PoC代码，此漏洞利用是有效的。该PoC代码完整地实现了利用该漏洞的步骤，包括获取nonce，上传任意文件，以及执行上传的webshell。

**项目地址:** [GazettEl/CVE-2020-24186](https://github.com/GazettEl/CVE-2020-24186)

**漏洞详情:** [CVE-2020-24186](https://nvd.nist.gov/vuln/detail/CVE-2020-24186)