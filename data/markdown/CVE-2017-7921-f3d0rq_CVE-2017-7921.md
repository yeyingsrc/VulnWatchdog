## CVE-2017-7921 - Hikvision摄像机权限提升漏洞

**漏洞编号:** CVE-2017-7921

**漏洞类型:** 权限提升

**影响应用:** Hikvision Cameras

**危害等级:** 高危，可能导致未授权访问、敏感信息泄露和设备控制

**影响版本:** DS-2CD2xx2F-I Series V5.2.0 build 140721 to V5.4.0 build 160530, DS-2CD2xx0F-I Series V5.2.0 build 140721 to V5.4.0 Build 160401, DS-2CD2xx2FWD Series V5.3.1 build 150410 to V5.4.4 Build 161125, DS-2CD4x2xFWD Series V5.2.0 build 140721 to V5.4.0 Build 160414, DS-2CD4xx5 Series V5.2.0 build 140721 to V5.4.0 Build 160421, DS-2DFx Series V5.2.0 build 140805 to V5.4.5 Build 160928, and DS-2CD63xx Series V5.0.9 build 140305 to V5.3.5 Build 160106

**利用条件:** 目标设备必须存在漏洞且网络可达

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7921是海康威视摄像机中存在的一个不当身份验证漏洞。该漏洞源于应用程序未能充分或正确地验证用户身份。攻击者可以通过利用这个漏洞提升自己在系统上的权限，从而访问敏感信息。提供的PoC代码尝试利用此漏洞。它通过构造特定的URL向目标设备请求配置文件，然后解密配置文件并提取用户名和密码。脚本包含多线程处理，可以批量测试目标。经过分析，脚本没有明显的恶意行为，例如植入后门或删除数据。脚本使用requests库发送HTTP请求，存在中间人攻击的风险，但这不是脚本本身投毒。`input_file = "ips.txt"`和`output_file = "ipsvalide.txt"`可能被替换。 因此，投毒风险较低。利用方式如下：

1.  **目标探测：** 脚本首先从 `ips.txt` 文件读取目标IP地址或域名。
2.  **URL构造：** 脚本构造包含特定 `auth` 参数的URL，例如 `http://target/System/configurationFile?auth=YWRtaW46MTEK`。
3.  **请求发送：** 脚本使用 `requests` 库向目标设备发送GET请求。
4.  **响应处理：** 如果响应状态码为200 OK，则表示目标可能存在漏洞。
5.  **数据解密：** 脚本使用AES解密算法和XOR操作对响应内容进行解密。
6.  **凭据提取：** 脚本在解密后的数据中搜索用户名和密码等凭据信息，例如 "admin"。
7.  **结果保存：** 如果找到凭据，脚本将其保存到 `ipsvalide.txt` 文件中。
8.  **多线程：** 脚本使用多线程加速扫描。

此漏洞利用的有效性取决于目标设备是否使用了受影响的版本以及漏洞是否已被修复。

**项目地址:** [f3d0rq/CVE-2017-7921](https://github.com/f3d0rq/CVE-2017-7921)

**漏洞详情:** [CVE-2017-7921](https://nvd.nist.gov/vuln/detail/CVE-2017-7921)