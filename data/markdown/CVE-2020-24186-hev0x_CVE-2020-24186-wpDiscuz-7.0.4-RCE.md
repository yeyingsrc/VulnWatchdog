## CVE-2020-24186-wpDiscuz-7.0.4-RCE

**漏洞编号:** CVE-2020-24186

**漏洞类型:** 远程代码执行

**影响应用:** wpDiscuz

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 7.0 <= version <= 7.0.4

**利用条件:** 目标WordPress站点安装了受影响版本的wpDiscuz插件，并且存在允许评论的页面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-24186 存在于 gVectors wpDiscuz 插件 7.0 到 7.0.4 版本中，允许未经身份验证的用户通过 wmuUploadFiles AJAX 操作上传包括 PHP 文件在内的任何类型的文件，从而导致远程代码执行。 

**利用方式:**

1.  **获取CSRF token:**  攻击者首先访问包含评论的页面，从中提取`wmuSecurity` (CSRF token)和`wc_post_id`，这些值用于后续的文件上传请求。
2.  **构造恶意请求:** 攻击者构造一个multipart/form-data请求，发送到`/wp-admin/admin-ajax.php`，设置 `action` 为 `wmuUploadFiles`，并包含 `wmu_nonce` （CSRF token），以及包含恶意 PHP 代码的文件。
3.  **绕过文件类型检查:** 漏洞存在于插件对上传文件类型的验证机制中，允许上传任意类型的文件。
4.  **远程代码执行:** 上传的PHP文件被保存在服务器上的某个目录中。攻击者访问该文件，执行其中的恶意代码，从而控制服务器。

**有效性评估:**

提供的PoC代码利用Python编写，完整地实现了上述利用流程。它通过抓取页面信息获取CSRF token，然后构造恶意请求上传webshell，因此该PoC代码有效。

**投毒风险评估:**

通过查看PoC代码，该脚本的功能就是漏洞的利用，没有发现作者隐藏的恶意代码来进一步攻击用户，没有额外的下载或者执行恶意操作，因此投毒风险较低，可以认为投毒风险为0%。

**项目地址:** [hev0x/CVE-2020-24186-wpDiscuz-7.0.4-RCE](https://github.com/hev0x/CVE-2020-24186-wpDiscuz-7.0.4-RCE)

**漏洞详情:** [CVE-2020-24186](https://nvd.nist.gov/vuln/detail/CVE-2020-24186)