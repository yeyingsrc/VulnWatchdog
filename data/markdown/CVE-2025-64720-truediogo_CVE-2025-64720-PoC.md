## CVE-2025-64720-libpng-缓冲区溢出

**漏洞编号:** CVE-2025-64720

**漏洞类型:** 缓冲区溢出

**影响应用:** libpng

**危害等级:** 高危，可能导致拒绝服务、信息泄露甚至远程代码执行

**影响版本:** < 1.6.51

**利用条件:** 需要目标应用使用受影响的libpng版本，并使用简化的PNG API处理特制的PNG图像。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-64720存在于libpng的png_image_read_composite函数中，当处理启用了PNG_FLAG_OPTIMIZE_ALPHA的调色板图像时，会出现越界读取漏洞。png_init_read_transformations中的调色板合成代码在预乘期间错误地应用背景合成，违反了简化PNG API所需的组件≤alpha×257不变性，导致内存损坏。

**有效性评估：**

根据漏洞信息和提供的POC代码，此漏洞利用的有效性较高。POC详细描述了漏洞的根本原因、受影响的版本、攻击向量、内存布局和触发条件。利用代码中给出了清晰的步骤，包括创建带有特定属性（调色板模式、tRNS块、零alpha值、高RGB值）的恶意PNG文件，通过简化的PNG API（png_image_finish_read）处理，触发漏洞。

**投毒风险评估：**

提供的POC代码主要是一个README.md文件，详细描述了漏洞信息和利用方式。它不包含实际的可执行代码。因此，该文件本身没有明显的投毒风险。但是，如果攻击者将此POC用于传播恶意PNG文件，则可能会存在投毒行为，诱导用户下载并处理这些恶意PNG文件，从而利用该漏洞。

综合评估来看，此README文件投毒的概率较低，仅为1%。

**漏洞利用方式：**

1.  **准备阶段：**
    *   确定目标应用使用了存在漏洞的libpng版本（< 1.6.51）。
    *   确定目标应用使用简化的PNG API (`png_image_*` 函数）。
    *   确定目标应用请求alpha通道格式（例如，RGBA，ARGB）。
2.  **攻击阶段：**
    *   创建恶意的PNG文件，该文件必须满足以下条件：
        *   使用调色板模式 (颜色类型 3)。
        *   包含tRNS块（透明度信息）。
        *   tRNS块中包含alpha值为0的条目。
        *   调色板中包含较高的RGB值 (特别是 255, 255, 255)。
3.  **利用阶段：**
    *   诱导目标应用加载并处理恶意的PNG文件。
    *   当libpng处理该PNG文件时，`PNG_FLAG_OPTIMIZE_ALPHA` 会被启用 (内部启用)。
    *   调色板扩展过程违反组件不变性 `component <= alpha * 257`。
    *   导致越界数组访问 `png_sRGB_base` 或 `png_sRGB_delta`。
    *   最终导致内存损坏、拒绝服务或信息泄露。

**项目地址:** [truediogo/CVE-2025-64720-PoC](https://github.com/truediogo/CVE-2025-64720-PoC)

**漏洞详情:** [CVE-2025-64720](https://nvd.nist.gov/vuln/detail/CVE-2025-64720)