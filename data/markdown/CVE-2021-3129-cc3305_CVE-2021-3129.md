## CVE-2021-3129-Laravel-Ignition-RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel Ignition

**危害等级:** 高危，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** Ignition < 2.5.2, Laravel < 8.4.2 (debug mode)

**利用条件:** Laravel 应用程序必须运行在 debug 模式下，且使用了受影响的 Ignition 版本。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2021-3129 漏洞存在于 Laravel Ignition 组件中。由于 `file_get_contents()` 和 `file_put_contents()` 的不安全使用，未经身份验证的远程攻击者可以通过构造特定的请求来执行任意代码。此漏洞仅在 Laravel 应用程序运行于 debug 模式下，且使用了受影响的 Ignition 版本时可被利用。

**漏洞利用方式：**

1.  攻击者发送一个包含恶意 `viewFile` 参数的 POST 请求到 `/_ignition/execute-solution` 端点。
2.  `viewFile` 参数包含一个指向 phar 文件的 URL，该 phar 文件包含恶意代码。
3.  Ignition 使用 `file_get_contents()` 函数读取 phar 文件。
4.  phar 文件被解析，恶意代码得以执行。

**有效性：**

提供的 Python 脚本 `CVE-2021-3129.py` 看起来是有效的。它通过 `/_ignition/execute-solution` 端点发送恶意请求，以利用该漏洞。

**投毒风险：**

该代码存在极低的投毒风险（约 1%）。原因是:

*   该脚本的主要功能是利用已知的 CVE-2021-3129 漏洞，旨在远程代码执行。
*   虽然任何代码都可能被篡改，但该脚本逻辑比较直接，如果植入后门容易被发现。

**需要注意：**

*   该漏洞的成功利用依赖于目标 Laravel 应用是否启用了 debug 模式，并且使用了受影响版本的 Ignition。
*   攻击者需要能够访问到目标服务器的网络，并且目标服务器必须允许出站网络连接以访问恶意 phar 文件。
*  `-C, --command`参数是命令执行的关键参数

**项目地址:** [cc3305/CVE-2021-3129](https://github.com/cc3305/CVE-2021-3129)

**漏洞详情:** [CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)