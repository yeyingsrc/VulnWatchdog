## CVE-2023-27532 - Veeam Backup & Replication 敏感信息泄露及远程代码执行

**漏洞编号:** CVE-2023-27532

**漏洞类型:** 敏感信息泄露/远程代码执行

**影响应用:** Veeam Backup & Replication

**危害等级:** 高危，可导致敏感信息泄露和远程代码执行，进而控制备份基础设施。

**影响版本:** Fixed Versions: v12 (build 12.0.0.1420 P20230223), 11a (build 11.0.1.1261 P20230227)

**利用条件:** 需要目标Veeam Backup & Replication服务监听的TCP端口（默认9401）可达。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-27532 漏洞允许未经身份验证的攻击者通过网络访问Veeam Backup & Replication服务器，利用其配置数据库中存储的加密凭据，或执行任意命令。

**有效性评估：**
提供的PoC代码针对 CVE-2023-27532，包含两个利用途径：泄露凭据（已移除，但原始漏洞存在）和远程代码执行。给定的代码侧重于RCE。它使用`IRemoteInvokeService`接口，通过构造恶意的`RemoteInvokeSpec`，尤其是`DbGetDataTableRemoteInvokeSpec`中的`SqlCommand`，来执行SQL查询。由于漏洞在于缺少身份验证，攻击者可以绕过正常的身份验证机制，直接调用服务接口执行恶意SQL命令，从而利用`xp_cmdshell`存储过程执行操作系统命令。 该代码通过修改SQL Server配置启用`xp_cmdshell`, 如果`xp_cmdshell`已经被启用则可能跳过。

**投毒风险分析：**
检查提供的文件，发现以下几点：
* `App.config`：标准的.NET配置文件，没有可疑内容。
* `Program.cs`：包含漏洞利用的主要逻辑。通过命令行参数控制目标主机、端口和要执行的命令。使用了`System.ServiceModel`，`System.ServiceModel.Security`等命名空间，创建WCF信道，模拟客户端与Veeam Backup & Replication服务器通信。
* `Readme.md`：包含了漏洞描述、构建和使用说明。提及了 Rapid7 的 AttackerKB 分析，以及其他研究人员的贡献。
* `VeeamHax.csproj`：项目文件，包含了项目依赖和编译配置。无异常。

该PoC代码的投毒风险较低，估计为10%。风险主要来自于以下几个方面：
1.  虽然移除了获取凭据的部分，但是部署该工具依然存在获取凭据的风险
2.  使用者可能不清楚`xp_cmdshell`带来的风险，恶意使用可能对目标环境造成破坏
3.  编译该 PoC 需要引入 Veeam 相关的 DLL，这些 DLL 可能来自非官方渠道，存在被篡改的风险。 虽然 PoC 提供了这些 DLL，但也增加了投毒的可能性，例如 DLL 被替换为包含恶意代码的版本。
4.  **利用方式：**
攻击者需要编译提供的C#代码。然后，通过命令行指定目标Veeam Backup & Replication服务器的IP地址和端口，以及要执行的命令。 PoC 会构造一个特殊的请求，绕过身份验证，利用`xp_cmdshell`在目标服务器上执行任意命令，实现远程代码执行。 例如执行 `VeeamHax.exe --target 192.168.0.100 --port 9401 --cmd calc.exe` 会在目标服务器上启动计算器程序。


**项目地址:** [puckiestyle/CVE-2023-27532-RCE-Only](https://github.com/puckiestyle/CVE-2023-27532-RCE-Only)

**漏洞详情:** [CVE-2023-27532](https://nvd.nist.gov/vuln/detail/CVE-2023-27532)