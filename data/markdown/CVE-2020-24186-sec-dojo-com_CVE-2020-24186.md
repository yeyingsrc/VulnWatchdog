## CVE-2020-24186 - WP-Discuz 7.0.4 远程代码执行

**漏洞编号:** CVE-2020-24186

**漏洞类型:** 任意文件上传导致远程代码执行

**影响应用:** WP-Discuz

**危害等级:** 高危，允许未授权用户上传任意文件，包括PHP文件，从而实现远程代码执行。

**影响版本:** 7.0 <= version <= 7.0.4

**利用条件:** 目标网站安装了受影响版本的 WP-Discuz 插件，并且未进行相关安全加固。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-24186 漏洞存在于 WordPress 的 WP-Discuz 插件 7.0 到 7.0.4 版本中。未经验证的用户可以通过 `wmuUploadFiles` AJAX action 上传任意类型的文件，包括 PHP 文件，从而导致远程代码执行。

**利用方式：**

1.  **版本检测：** PoC 脚本首先检查目标网站是否安装了易受攻击的 WP-Discuz 7.0.4 版本，通过访问 `readme.txt` 文件并查找特定的“Stable tag”字符串。
2.  **获取文章数据：** 脚本尝试通过 WordPress REST API (`/wp-json/wp/v2/posts/`) 获取文章链接。如果未找到，则退出。
3.  **提取安全令牌和 Post ID：** 脚本从文章页面内容中提取 `wmuSecurity` 令牌和 `post_id`。PoC 脚本提供了两种提取方式,保证了更好的兼容性.
4.  **上传 Shell：** 如果成功提取了安全令牌和 Post ID，脚本将上传一个名为 `shell.php` 的 PHP Shell 文件。此文件中包含一个简单的PHP后门,通过GET参数`cmd`执行系统命令.
5.  **检查上传结果：** 脚本通过解析上传响应来确定 Shell 文件是否已成功上传，并输出Shell的URL地址。如果上传成功，会将shell URL追加到 `results.txt` 文件中。

**投毒风险分析：**

提供的 PoC 代码主要用于验证和利用 CVE-2020-24186 漏洞。其中 `shell.php` 包含一个简单的后门，允许通过 GET 参数执行系统命令。虽然这个后门本身具有潜在的风险，但它主要是为了验证漏洞的存在，而不是为了进行恶意投毒。PoC 代码会上传这个文件，但其目的是利用，而非植入不可见的恶意代码。

**结论：**

该 PoC 代码的有效性较高，因为它直接利用了未授权文件上传漏洞。仓库中作者隐藏投毒代码的风险较低 (0%)，主要风险在于成功利用漏洞后，攻击者上传的 shell.php 文件本身。

**项目地址:** [sec-dojo-com/CVE-2020-24186](https://github.com/sec-dojo-com/CVE-2020-24186)

**漏洞详情:** [CVE-2020-24186](https://nvd.nist.gov/vuln/detail/CVE-2020-24186)