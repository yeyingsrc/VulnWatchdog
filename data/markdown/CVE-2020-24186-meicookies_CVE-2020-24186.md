## CVE-2020-24186-wpDiscuz-任意文件上传

**漏洞编号:** CVE-2020-24186

**漏洞类型:** 任意文件上传

**影响应用:** wpDiscuz

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 7.0 - 7.0.4

**利用条件:** 目标网站安装了受影响版本的wpDiscuz插件，且允许未授权访问admin-ajax.php

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2020-24186 是 WordPress wpDiscuz 插件 7.0 到 7.0.4 版本中存在的一个远程代码执行漏洞。该漏洞允许未经身份验证的用户通过 wmuUploadFiles AJAX action 上传任意类型的文件，包括 PHP 文件，从而导致远程代码执行。

**有效性分析：**
提供的 POC 代码看起来有效。它首先检查目标网站是否运行易受攻击的 wpDiscuz 版本。如果是，它会获取必要的安全 nonce 和 post ID，然后使用 curl 命令上传一个包含 PHP 代码的 u.php 文件。上传成功后，它会打印上传文件的 URL 并将其保存到 result.txt 文件中。

**投毒风险分析：**
该仓库中的代码投毒风险较低。提供的 shell 脚本主要是利用漏洞，`u.php` 是一个简单的后门文件，用于上传其他文件和执行命令，不属于投毒代码。README.md 只是提供使用说明，没有发现任何恶意代码。

**利用方式：**
1.  **版本检查：** 脚本首先通过访问 `wp-content/plugins/wpdiscuz/readme.txt` 文件来检查目标 WordPress 网站是否安装了 7.0.4 版本的 wpDiscuz 插件。
2.  **获取必要参数：** 如果版本匹配，脚本会从 WordPress 文章中提取 `wmuSecurity` nonce 和 `wc_post_id`，这些参数用于绕过上传限制。
3.  **文件上传：** 脚本使用 `curl` 命令向 `wp-admin/admin-ajax.php` 端点发送一个 POST 请求，其中包含 `action=wmuUploadFiles`、`wmu_nonce`、`wmuAttachmentsData`、`wmu_files[0]=@u.php` 和 `postId` 参数。`u.php` 文件包含 PHP 代码，用于创建一个简单的文件上传表单。
4.  **验证上传：** 脚本检查响应，以确定文件是否已成功上传。如果上传成功，脚本会打印上传文件的 URL 并将其保存到 result.txt 文件中。用户可以通过访问上传的 PHP 文件来执行任意代码。

**项目地址:** [meicookies/CVE-2020-24186](https://github.com/meicookies/CVE-2020-24186)

**漏洞详情:** [CVE-2020-24186](https://nvd.nist.gov/vuln/detail/CVE-2020-24186)