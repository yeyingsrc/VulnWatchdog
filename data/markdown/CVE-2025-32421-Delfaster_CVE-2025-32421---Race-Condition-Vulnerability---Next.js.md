## CVE-2025-32421-Next.js-缓存投毒

**漏洞编号:** CVE-2025-32421

**漏洞类型:** 缓存投毒

**影响应用:** Next.js

**危害等级:** 中危，可能导致信息泄露或页面篡改

**影响版本:** < 14.2.24 或 >= 15.0.0, < 15.1.6

**利用条件:** 需要自托管Next.js，并存在CDN配置不当的情况

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是Next.js中的一个竞争条件导致的缓存投毒漏洞。 

**漏洞利用方式：**

1.  **漏洞描述：** 当 Next.js 应用自托管，并且 CDN 配置不当时，可能出现此漏洞。具体来说，如果 CDN 忽略后端返回的 `Cache-Control` 标头，并且缓存了所有 200 OK 的响应，同时又使用了不包含查询字符串的缓存键，就可能存在风险。
2.  **利用方法：** 攻击者通过并发发送两个请求：
    *   一个请求是正常的 `/` 请求，用于获取 HTML 页面。
    *   另一个请求是带有 `x-now-route-matches` 标头的 `/?__nextDataRequest=1` 请求，用于获取 `pageProps` 数据（JSON 格式）。
3.  **竞争条件：**  由于竞争条件，如果 `/?__nextDataRequest=1` 请求先被缓存，那么后续访问 `/` 的用户可能会收到 JSON 数据而不是 HTML 页面，从而导致缓存投毒。
4.  **POC 验证：** 提供的 POC 代码模拟了这种竞争条件。它并发地发送大量 `/?__nextDataRequest=1` 和 `/` 请求，并检查 `/` 请求的响应头 `Content-Type` 是否为 `application/json`。 如果是，则说明缓存投毒成功。
5.  **风险缓解：** Vercel 官方建议升级到 14.2.24 或 15.1.6 版本，或者在 CDN 上移除 `x-now-route-matches` 标头，并设置 `cache-control: no-store`。官方强烈建议只缓存具有显式 cache-control 标头的响应。

**投毒风险评估：**

分析 POC 代码，没有发现作者隐藏的投毒代码。POC 代码的目的是模拟和验证漏洞的存在，而不是执行恶意操作。因此，投毒风险为 0%。 所有操作都在模拟环境中进行，没有尝试访问或修改实际的 Next.js 应用或 CDN 资源。

**项目地址:** [Delfaster/CVE-2025-32421---Race-Condition-Vulnerability---Next.js](https://github.com/Delfaster/CVE-2025-32421---Race-Condition-Vulnerability---Next.js)

**漏洞详情:** [CVE-2025-32421](https://nvd.nist.gov/vuln/detail/CVE-2025-32421)