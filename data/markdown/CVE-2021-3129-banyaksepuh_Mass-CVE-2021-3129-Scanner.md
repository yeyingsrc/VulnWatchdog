## CVE-2021-3129 Laravel Debug RCE

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel (with Ignition)

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** Ignition < 2.5.2, Laravel < 8.4.2 (debug mode enabled)

**利用条件:** Laravel应用开启debug模式，且使用了受影响版本的Ignition组件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-3129 漏洞是由于 Ignition 组件在处理异常时，不安全地使用了 `file_get_contents()` 和 `file_put_contents()` 函数导致的远程代码执行漏洞。此漏洞利用需要满足以下条件：

1.  Laravel 应用开启了 debug 模式（`APP_DEBUG=true`）。
2.  使用了受影响版本的 Ignition 组件（< 2.5.2）。
3.  使用了 Laravel 版本小于 8.4.2。

**漏洞利用方式：**

攻击者可以通过发送特制的 HTTP POST 请求到 `/_ignition/execute-solution` 路由来触发漏洞。请求体中包含恶意构造的参数，这些参数会被传递给 `file_get_contents()` 和 `file_put_contents()`，从而允许攻击者读取任意文件或写入恶意代码到服务器，最终实现远程代码执行。

提供的 `massCVE-2021-3129scan.sh` 脚本是一个批量扫描器，用于检测目标网站是否存在此漏洞。它通过发送一个 GET 请求到 `/_ignition/execute-solution` 路由，并检查响应是否包含 'The GET method is not supported for this route. Supported methods: POST.' 字符串。如果包含，则表明目标网站可能存在漏洞。

**有效性：**

该POC代码用于检测目标是否存在漏洞是有效的。虽然它只是检查了是否存在路由，但可以作为一个初步的检测手段。

**投毒风险：**

该仓库中存在投毒代码的可能性较低，约为10%。 风险点在于批量扫描脚本可能会被修改为执行恶意操作（例如，未经授权的端口扫描，信息收集等）。 但是，考虑到代码量较少，结构简单，可以人为审核,且该脚本的主要功能是扫描，而非利用，因此判断投毒风险较低。

**项目地址:** [banyaksepuh/Mass-CVE-2021-3129-Scanner](https://github.com/banyaksepuh/Mass-CVE-2021-3129-Scanner)

**漏洞详情:** [CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)