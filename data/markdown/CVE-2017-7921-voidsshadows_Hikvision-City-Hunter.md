## CVE-2017-7921-Hikvision Cameras-不当身份验证

**漏洞编号:** CVE-2017-7921

**漏洞类型:** 不当身份验证

**影响应用:** Hikvision Cameras

**危害等级:** 高危，可能导致权限提升和敏感信息泄露

**影响版本:** DS-2CD2xx2F-I Series V5.2.0 build 140721 to V5.4.0 build 160530, DS-2CD2xx0F-I Series V5.2.0 build 140721 to V5.4.0 Build 160401, DS-2CD2xx2FWD Series V5.3.1 build 150410 to V5.4.4 Build 161125, DS-2CD4x2xFWD Series V5.2.0 build 140721 to V5.4.0 Build 160414, DS-2CD4xx5 Series V5.2.0 build 140721 to V5.4.0 Build 160421, DS-2DFx Series V5.2.0 build 140805 to V5.4.5 Build 160928, and DS-2CD63xx Series V5.0.9 build 140305 to V5.3.5 Build 160106

**利用条件:** 需要网络访问，设备端口开放，并且设备版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

漏洞CVE-2017-7921存在于特定版本的海康威视摄像头中，这是一个不当的身份验证漏洞。攻击者可以通过构造特殊的URL，绕过身份验证，获取设备信息甚至控制设备。提供的POC代码`Hunter.py`利用Shodan API搜索指定城市的海康威视设备，然后尝试使用硬编码的用户名密码`admin:12345`（Base64编码为`YWRtaW46MTEK`）通过`/System/deviceInfo`接口获取设备信息。如果成功，则进一步尝试获取快照。\n\n**利用方式：**\n1.  使用Shodan API查找目标城市的海康威视设备。\n2.  对找到的每个IP地址和端口，尝试构造包含`auth=YWRtaW46MTEK`的URL请求`/System/deviceInfo`接口。\n3.  如果返回200状态码并且响应包含设备信息，则漏洞存在，可以获取设备型号、序列号、固件版本等信息。\n4.  进一步尝试通过`/onvif-http/snapshot?auth=YWRtaW46MTEK`接口获取设备快照。\n\n**有效性：**\n提供的POC代码是有效的，因为它实现了对漏洞的利用，可以自动化地搜索并验证目标是否存在漏洞。\n\n**投毒风险：**\nPOC代码可能存在轻微的投毒风险，主要体现在以下几个方面：\n1.  **硬编码凭据：** 代码中硬编码了`admin:12345`作为默认凭据。虽然这是漏洞利用的一部分，但可能被滥用，攻击者可能基于此进行大规模扫描和攻击。\n2.  **快照保存：**  代码会将快照保存到本地。如果攻击者修改代码，可能将快照上传到恶意服务器，造成隐私泄露。\n3.  **依赖外部API密钥：**代码依赖于Shodan API密钥。作者如果公开了一个无效或者被监控的KEY,则代码可能无法正常运行或者被追踪。\n4.  **User-Agent欺骗:** 代码中使用了`Mozilla/5.0`的User-Agent,目的是为了绕过一些简单的请求检测，但如果作者有恶意，则可能添加一些不常用的User-Agent，从而更容易被识别和跟踪。\n\n综合来看，该POC代码的投毒风险大约为10%，主要风险在于可能被用于大规模扫描和攻击，以及隐私泄露。

**项目地址:** [voidsshadows/Hikvision-City-Hunter](https://github.com/voidsshadows/Hikvision-City-Hunter)

**漏洞详情:** [CVE-2017-7921](https://nvd.nist.gov/vuln/detail/CVE-2017-7921)