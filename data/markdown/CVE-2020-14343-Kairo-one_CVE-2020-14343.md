## CVE-2020-14343-PyYAML反序列化漏洞

**漏洞编号:** CVE-2020-14343

**漏洞类型:** 反序列化漏洞

**影响应用:** PyYAML

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 5.4

**利用条件:** 目标系统安装了PyYAML库，并且使用了full_load或FullLoader方法处理不可信的YAML文件

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-14343是PyYAML库在5.4版本之前存在的一个反序列化漏洞。当PyYAML使用`full_load`方法或`FullLoader`加载器处理不可信的YAML文件时，可能导致任意代码执行。 

**利用方式：**

1.  **构造恶意YAML文件：**  攻击者需要构造包含恶意payload的YAML文件。POC代码中，payload利用了`python/object/new`构造器，结合`eval`函数执行系统命令，实现反弹shell。

2.  **上传YAML文件：** POC首先尝试将恶意的YAML文件上传到目标服务器的 `/upload` 路径下。 上传的文件名为 `userConfig.yaml`, 文件类型为 `application/x-yaml`。

3.  **触发反序列化：**  POC随后发送一个登录请求到 `/login` 路径。这个登录请求可能是为了触发服务器对上传的YAML文件进行反序列化操作。

4.  **反弹shell：**  如果反序列化成功，恶意payload中的反弹shell命令会被执行，攻击者即可获得目标系统的shell。

**有效性：**

根据提供的漏洞信息和POC代码，可以判断此POC是有效的。该POC展示了利用PyYAML反序列化漏洞执行任意代码的完整流程。

**投毒风险：**

虽然POC的主要目的是利用漏洞，但存在一定程度的投毒风险。风险点在于：

*   反弹shell的IP和端口是硬编码在POC中的。如果未经修改直接使用，可能会将shell反弹到作者控制的服务器上。
*   `eval`函数的使用本身就存在风险。虽然这里用于执行反弹shell，但也可能被用于执行其他恶意代码。

因此，投毒风险大约为10%。用户在使用POC时，务必审查代码，修改反弹shell的IP和端口，并谨慎评估`eval`函数的使用。

**项目地址:** [Kairo-one/CVE-2020-14343](https://github.com/Kairo-one/CVE-2020-14343)

**漏洞详情:** [CVE-2020-14343](https://nvd.nist.gov/vuln/detail/CVE-2020-14343)