## CVE-2022-45782-dotCMS-密码重置漏洞

**漏洞编号:** CVE-2022-45782

**漏洞类型:** 密码重置漏洞

**影响应用:** dotCMS

**危害等级:** 高危，可导致账户接管

**影响版本:** 5.3.8.5 to 5.3.8.15 和 21.03 to 22.10.1

**利用条件:** 需要能够访问dotCMS服务器的网络，并能够发送HTTP请求。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

根据漏洞信息，dotCMS 在密码重置令牌生成过程中使用了密码学上不安全的伪随机数生成器（PRNG）。POC利用代码首先向目标用户（例如 nigar.najafli02@gmail.com）发起密码重置请求，记录请求的时间戳，然后利用`randomstringutils/crack`尝试预测伪随机数生成器的输出，并生成可能的token，最后在记录的时间戳范围内，循环尝试这些token进行密码重置。如果token验证成功，则可以使用新密码登录目标账户。

**有效性：** 该POC代码的有效性取决于 `randomstringutils/crack`工具的破解成功率以及时间戳记录的精确性。 由于PRNG的弱点，在一定时间内，破解成功并找到有效token的可能性较高，漏洞利用有效。

**投毒风险：** 在提供的`docker-compose.yml`和`poc.py`文件中，主要功能是部署易受攻击的dotCMS实例和利用密码重置漏洞。`docker-compose.yml`文件配置了一个包含PostgreSQL数据库、Elasticsearch和dotCMS实例的环境。`poc.py`尝试利用时间戳和破解PRNG生成的弱token来进行密码重置。主要风险在于`poc.py`中对目标邮箱的使用，以及破解模块的潜在后门。虽然没有直接证据表明该代码包含恶意行为，但仍然存在很小的风险(10%)，比如`randomstringutils/crack`本身可能被篡改过，或者代码作者可能会收集一些信息进行其他恶意活动。

**利用方式：**

1.  部署包含漏洞版本的dotCMS实例（通过docker-compose.yml）。
2.  运行poc.py脚本。
3.  POC脚本首先触发目标用户的密码重置流程，记录请求的时间戳。
4.  POC脚本调用`randomstringutils/crack`尝试破解PRNG生成的token。
5.  POC脚本在记录的时间戳范围内，循环尝试预测的token，发送带有破解的token和新密码的请求到changePassword接口。
6.  如果token验证成功，则密码被重置，攻击者可以使用新密码登录目标账户。

**项目地址:** [ninajafli/DotCMS-CVE-2022-45782](https://github.com/ninajafli/DotCMS-CVE-2022-45782)

**漏洞详情:** [CVE-2022-45782](https://nvd.nist.gov/vuln/detail/CVE-2022-45782)