## CVE-2019-15949-Nagios XI-Root RCE

**漏洞编号:** CVE-2019-15949

**漏洞类型:** 远程代码执行

**影响应用:** Nagios XI

**危害等级:** 高危，可导致完全系统控制

**影响版本:** <= 5.6.5

**利用条件:** 需要以nagios用户身份访问服务器，或者通过Web界面以管理员用户身份访问并具有插件管理权限。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-15949 存在于 Nagios XI 5.6.6 之前的版本中。该漏洞允许远程以 root 身份执行命令。利用此漏洞需要两种访问途径之一：

1.  **Nagios 用户权限：** 如果攻击者能够以 `nagios` 用户身份登录服务器，他们可以直接修改 `check_plugin` 可执行文件，插入恶意命令，从而以 root 身份执行。
2.  **Web 界面管理员权限：** 如果攻击者能够通过 Web 界面以管理员用户身份登录，并且具有修改插件的权限，他们可以通过上传恶意的 `check_plugin` 插件来实现相同的效果。

**漏洞利用方式：**

1.  **身份验证：** 使用有效的 Nagios XI 管理员凭据 (username, password) 登录。
2.  **获取 NSP Token：** 从插件管理页面或登录页面提取 NSP (Nonce Security Parameter) token，用于后续请求的身份验证。
3.  **上传恶意插件：** 将包含恶意代码的插件（这里是修改 `check_ping` 文件）上传到服务器。PoC代码通过覆盖`check_ping`内容来实现植入恶意代码。
4.  **触发漏洞：** 通过访问 `profile.php?cmd=download` 下载系统配置文件来触发 `getprofile.sh` 脚本的执行，该脚本会以 root 身份运行 `check_plugin`，从而执行攻击者上传的恶意代码。
5.  **反弹 Shell：** POC利用方式为反弹shell.

**投毒风险分析：**

提供的 PoC 代码主要包含一个 `exploit.py` 脚本和一个 `README.md` 文件。 `exploit.py` 脚本实现了漏洞利用的完整流程，包括登录、上传恶意插件和触发漏洞。 `README.md` 文件提供了漏洞的描述、利用方法和修复信息。通过对代码的分析，未发现任何隐藏的恶意代码，例如用于收集用户信息、传播恶意软件或执行其他未经授权的操作。该代码逻辑清晰，功能明确，专注于实现 CVE-2019-15949 漏洞的利用。

因此，投毒风险评估为0%。

**项目地址:** [0xla1n/Nagios-CVE-2019-15949-RCE-Poc](https://github.com/0xla1n/Nagios-CVE-2019-15949-RCE-Poc)

**漏洞详情:** [CVE-2019-15949](https://nvd.nist.gov/vuln/detail/CVE-2019-15949)