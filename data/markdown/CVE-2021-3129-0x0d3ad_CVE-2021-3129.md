## CVE-2021-3129 Laravel Ignition 远程代码执行

**漏洞编号:** CVE-2021-3129

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Laravel (使用 Ignition)

**危害等级:** 高危，允许未授权远程代码执行

**影响版本:** Ignition < 2.5.2, Laravel < 8.4.2 (debug mode)

**利用条件:** 目标站点使用 Laravel 并且开启了 debug 模式，安装了 Ignition 且版本低于 2.5.2，Laravel 版本低于 8.4.2

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2021-3129 漏洞存在于 Laravel Ignition 组件中，由于对 `file_get_contents()` 和 `file_put_contents()` 的不安全使用，导致未经身份验证的远程攻击者可以执行任意代码。

**利用方式：**

1.  **日志清理：** 首先清除 Laravel 的日志文件，为写入恶意 payload 腾出空间。
2.  **写入 Payload：** 构造一个包含恶意 PHP 代码的字符串，并将其写入 Laravel 的日志文件。此 Payload 基于 phpggc 生成的 PHAR 文件，该文件包含反序列化漏洞。
3.  **PHAR 转换：** 使用 `convert.quoted-printable-decode`、`convert.iconv.utf-16le.utf-8` 和 `convert.base64-decode` 等 PHP 过滤器将日志文件内容转换为有效的 PHAR 文件。
4.  **触发反序列化：** 通过访问 `phar://` 协议包装器，触发 PHAR 文件的反序列化，从而执行 Payload 中的任意代码。

**漏洞利用有效性：**

提供的 Python POC 代码看起来有效。它使用 `phpggc` 工具生成 PHAR payload，然后通过一系列 HTTP 请求写入目标服务器的日志文件，并最终通过 phar 协议触发反序列化漏洞，从而实现远程代码执行。

**投毒风险：**

该仓库的投毒风险较低，大约为 5%。原因如下：

*   Dockerfile 明确指定了 phpggc 的安装和使用，没有额外的操作。
*   README 文件详细描述了漏洞和利用方法。
*   Python 脚本代码逻辑清晰，主要功能是利用漏洞，没有发现隐藏的恶意代码。
*   风险主要在于利用 phpggc 生成 payload 的过程中，可能会存在安全问题，但不是此仓库作者引入的。

**总结：**

此漏洞影响开启 debug 模式且使用特定版本 Laravel 和 Ignition 组件的应用程序，允许未经身份验证的远程代码执行。提供的 POC 代码能够有效利用此漏洞，风险在于目标开启debug模式，本身存在风险。代码本身投毒风险较低。

**项目地址:** [0x0d3ad/CVE-2021-3129](https://github.com/0x0d3ad/CVE-2021-3129)

**漏洞详情:** [CVE-2021-3129](https://nvd.nist.gov/vuln/detail/CVE-2021-3129)