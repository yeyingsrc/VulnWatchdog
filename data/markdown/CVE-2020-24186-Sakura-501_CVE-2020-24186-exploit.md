## CVE-2020-24186-wpDiscuz-RCE

**漏洞编号:** CVE-2020-24186

**漏洞类型:** 远程代码执行

**影响应用:** wpDiscuz

**危害等级:** 高危，允许未授权用户上传任意文件（包括PHP），可导致远程代码执行

**影响版本:** 7.0 to 7.0.4

**利用条件:** 目标WordPress站点安装了受影响版本的wpDiscuz插件，且允许外部网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-24186 存在于 gVectors wpDiscuz 插件 7.0 到 7.0.4 版本中。漏洞允许未经身份验证的用户通过 `wmuUploadFiles` AJAX 操作上传任意类型的文件，包括 PHP 文件，从而导致远程代码执行。

**利用方式：**

1.  **获取必要参数：** 首先，攻击者需要访问包含评论功能的页面，从中提取 `wmuSecurity` 和 `wc_post_id` 的值。 这些值通常嵌入在HTML源代码中。
2.  **构造恶意请求：** 攻击者构造一个包含 `action` (设置为 `wmuUploadFiles`)、`wmu_nonce` (设置为 `wmuSecurity`)、`wmuAttachmentsData`，`wmu_files[0]`（包含恶意PHP代码），和 `postId` (设置为 `wc_post_id`) 的 multipart/form-data 请求。
3.  **上传恶意文件：** 将构造的请求发送到 WordPress 的 `admin-ajax.php` 端点。
4.  **执行代码：** 成功上传后，访问上传的文件，服务器将执行其中包含的 PHP 代码。

**投毒风险分析：**

虽然提供的POC代码主要是利用漏洞，但仍然存在潜在的投毒风险。恶意作者可能会在以下几个方面进行投毒：

*   **Webshell内容：** POC中上传的webshell代码 `<?php eval($_REQUEST['hack']); ?>` 允许执行任意PHP代码。虽然这是利用漏洞的常见做法，但也可能被替换为更隐蔽或恶意的代码，例如用于植入后门、窃取数据或进行其他恶意活动。
*   **文件内容篡改：** 上传的文件内容可以被修改为包含其他恶意脚本或代码，这些代码可能会在服务器上执行，或者被用于其他攻击。
*   **依赖项问题:** 通过 `requests`库，可以尝试通过隐蔽手段从外部引入恶意代码，但这会增加暴露的风险，不太可能发生。

因此，尽管该POC主要用于漏洞利用演示，仍然需要保持警惕，评估使用风险。投毒风险评估为10%。该比例主要考虑到eval函数本身的风险和代码中可能存在的细微修改风险。

**项目地址:** [Sakura-501/CVE-2020-24186-exploit](https://github.com/Sakura-501/CVE-2020-24186-exploit)

**漏洞详情:** [CVE-2020-24186](https://nvd.nist.gov/vuln/detail/CVE-2020-24186)