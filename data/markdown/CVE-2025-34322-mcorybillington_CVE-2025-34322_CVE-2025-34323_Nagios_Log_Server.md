## CVE-2025-34322-Nagios Log Server-命令注入

**漏洞编号:** CVE-2025-34322

**漏洞类型:** 命令注入

**影响应用:** Nagios Log Server

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** < 2026R1.0.1

**利用条件:** 需要有效的Nagios Log Server账号密码，并能够访问管理界面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

Nagios Log Server 2026R1.0.1之前版本存在经过身份验证的命令注入漏洞，位于实验性的“自然语言查询”功能中。当启用此功能后，某些用户可控的设置（包括模型选择和连接参数）将从全局配置中读取，并连接成一个shell命令，该命令通过shell_exec()执行，没有进行适当的输入处理或命令行参数过滤。经过身份验证且有权访问“全局设置”页面的用户可以在这些字段中提供精心构造的值来注入其他shell命令，从而以“www-data”用户的身份执行任意命令，并导致Log Server主机遭到入侵。

**漏洞利用方式：**

1.  攻击者需要拥有 Nagios Log Server 的有效用户名和密码。
2.  攻击者登录到 Nagios Log Server 的管理界面。
3.  攻击者导航到“全局设置”页面，找到“自然语言查询”相关的配置项。
4.  攻击者在 “self_host_ip_address” 字段中注入恶意命令。该字段的值会被拼接到shell命令中执行。
5.  攻击者保存设置并访问自然语言查询功能，触发命令执行。
6.  注入的命令以 `www-data` 用户的权限执行。

**关于有效性：**
提供的 Python 脚本 `CVE-2025-34322.py` 实现了上述漏洞利用过程。脚本通过以下步骤利用漏洞：

1.  登录 Nagios Log Server。
2.  构造包含恶意命令的payload，发送到 `/nagioslogserver/admin/globals` 接口。
3.  访问 `/nagioslogserver/dashboard/natural_language_to_query` 触发命令执行。
4.  从 `/nagioslogserver/scripts/test.txt` 读取命令执行结果。

**关于投毒风险：**
虽然主要的exp看起来是可靠的，但是也发现readme中提到了cve-2025-34323漏洞，并通过写入`/usr/local/nagioslogserver/scripts/reconfigure_ncpa.sh`文件来提升权限，攻击者如果直接运行整个仓库，可能会没有看到root提权相关代码逻辑,并直接使用。
这个投毒风险的比例判断为10%。主要是因为该repo结构合理，exp代码清晰，投毒代码隐蔽性高。

**项目地址:** [mcorybillington/CVE-2025-34322_CVE-2025-34323_Nagios_Log_Server](https://github.com/mcorybillington/CVE-2025-34322_CVE-2025-34323_Nagios_Log_Server)

**漏洞详情:** [CVE-2025-34322](https://nvd.nist.gov/vuln/detail/CVE-2025-34322)