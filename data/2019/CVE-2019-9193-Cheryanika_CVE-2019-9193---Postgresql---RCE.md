## CVE-2019-9193 - PostgreSQL 远程代码执行

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PostgreSQL

**危害等级:** 高危，可执行任意系统命令

**影响版本:** 9.3 - 11.7

**利用条件:** 需要PostgreSQL数据库的有效用户名和密码，且数据库用户拥有足够权限（如postgres用户或者属于pg_execute_server_program组的用户）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-9193 漏洞是 PostgreSQL 9.3 到 11.7 版本中 'COPY TO/FROM PROGRAM' 功能的一个问题。该功能允许超级用户和 'pg_execute_server_program' 组中的用户在数据库服务器的操作系统用户上下文中执行任意代码。提供的 Python 脚本 `CVE-2019-9193.py` 旨在利用此漏洞。利用方式如下：

1.  **连接数据库：** 脚本首先尝试使用提供的凭据（IP地址、端口、数据库名称、用户名和密码）连接到 PostgreSQL 数据库。
2.  **版本检查：** 连接成功后，脚本会查询 PostgreSQL 的版本。如果版本在易受攻击的范围内（9.3 到 11.7），则继续执行。
3.  **命令执行：** 脚本创建一个随机名称的临时表，然后使用 `COPY ... FROM PROGRAM` 命令执行用户提供的系统命令。命令的输出存储在这个临时表中。
4.  **结果获取：** 脚本从临时表中读取命令的输出，并将其打印到控制台。
5.  **清理：** 最后，脚本删除创建的临时表。

**有效性：**
提供的PoC代码是有效的，因为它利用了 `COPY FROM PROGRAM` 功能来执行任意系统命令。如果目标PostgreSQL数据库的版本在9.3到11.7之间，并且提供了有效的数据库凭据，则该脚本应该能够成功执行命令。

**投毒风险：**
该脚本没有明显的投毒行为。该脚本的主要功能是执行用户提供的命令，并没有发现任何隐藏或恶意的功能。代码虽然可能被滥用，但代码本身的设计目的不是为了投毒。因此，风险评估为0%。代码执行的是用户传入的参数，如果用户传入的参数是恶意代码，那属于用户自己投毒，而非代码本身。

**利用方式总结：**
1.  获得目标 PostgreSQL 数据库的访问权限（有效的用户名和密码）。
2.  确保目标数据库版本在 9.3 到 11.7 之间。
3.  使用 `COPY FROM PROGRAM` 功能执行任意系统命令。

**项目地址:** [Cheryanika/CVE-2019-9193---Postgresql---RCE](https://github.com/Cheryanika/CVE-2019-9193---Postgresql---RCE)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)