## CVE-2019-9193 - PostgreSQL Authenticated Remote Code Execution

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行

**影响应用:** PostgreSQL

**危害等级:** 高危，可能导致服务器被完全控制

**影响版本:** 9.3 - 12.3

**利用条件:** 需要有效的PostgreSQL数据库用户名和密码，以及'pg_execute_server_program'组权限（默认情况下superuser拥有）。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-9193允许经过身份验证的攻击者在PostgreSQL服务器上执行任意代码。漏洞存在于 'COPY TO/FROM PROGRAM' 功能中。攻击者可以使用有效的数据库凭据连接到PostgreSQL数据库，然后利用'COPY FROM PROGRAM'语句执行操作系统命令。由于PostgreSQL服务器以操作系统用户的身份运行，因此执行的命令将具有与PostgreSQL服务器相同的权限。 

**有效性：**

提供的PoC代码（cve-2019-9193.py）使用psycopg2库连接到PostgreSQL数据库，检查PostgreSQL版本，然后使用'COPY ... FROM PROGRAM'语句执行提供的系统命令。该代码会创建一个临时表，使用COPY命令将命令的输出写入表中，然后查询表并删除该表。提供的README.md 文件也提供了利用示例，表明该漏洞PoC可用。

**投毒风险：**

检查提供的PoC代码，未发现明显的投毒代码。该代码仅利用了PostgreSQL的'COPY FROM PROGRAM'功能来执行命令。代码的逻辑是连接到数据库，执行命令，获取结果，然后清理。没有发现任何尝试安装后门、修改系统文件或其他恶意行为。因此，投毒风险较低（0%）。

**利用方式：**

1.  攻击者需要有效的PostgreSQL数据库用户名和密码。
2.  攻击者使用psycopg2或其他PostgreSQL客户端连接到目标数据库服务器。
3.  攻击者执行'COPY table FROM PROGRAM 'command''语句，其中'command'是要执行的操作系统命令。
4.  PostgreSQL服务器执行该命令并将结果存储到指定的表中（如果适用）。
5.  攻击者查询该表以获取命令的输出。
6.  攻击者删除该表。

**项目地址:** [b4keSn4ke/CVE-2019-9193](https://github.com/b4keSn4ke/CVE-2019-9193)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)