## CVE-2019-9193 - PostgreSQL COPY FROM PROGRAM RCE

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程命令执行 (RCE)

**影响应用:** PostgreSQL

**危害等级:** 高危，可导致服务器被完全控制

**影响版本:** 9.3 - 11.2

**利用条件:** 需要数据库的身份验证，且用户需要是超级用户或具有 pg_execute_server_program 角色。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2019-9193 漏洞存在于 PostgreSQL 9.3 到 11.2 版本中。该漏洞允许超级用户或具有 `pg_execute_server_program` 角色的用户通过 `COPY FROM PROGRAM` 命令执行任意操作系统命令。提供的 Dockerfile 构建了一个包含易受攻击 PostgreSQL 版本的环境，并提供了一个简单的利用链。利用方式包括：

1.  连接到 PostgreSQL 数据库，使用提供的用户名和密码。
2.  创建一个用于存储命令输出的表。
3.  使用 `COPY cmd_exec FROM PROGRAM '<command>'` 命令执行操作系统命令，并将结果存储到创建的表中。
4.  查询该表以查看命令的输出。

**有效性：**  提供的 POC 代码有效。它提供了一个可重现的漏洞环境和明确的利用步骤。

**投毒风险：**  虽然 Dockerfile 构建了易受攻击的环境，但其中存在轻微的投毒风险。风险点在于 `entrypoint.sh` 脚本，需要进一步审查以确保其中没有隐藏的恶意行为。

**利用方式：**  攻击者通过身份验证后，利用 `COPY FROM PROGRAM` 命令执行任意操作系统命令。这允许他们读取文件、修改系统设置，甚至完全控制服务器。

**总结:** 这是一个高危漏洞，利用方式简单，只需几条 SQL 命令即可实现远程命令执行。建议尽快升级 PostgreSQL 版本或采取缓解措施，例如限制 `pg_execute_server_program` 角色，或禁用 `COPY PROGRAM` 功能。

**项目地址:** [netw0rk7/CVE-2019-9193-Home-Lab](https://github.com/netw0rk7/CVE-2019-9193-Home-Lab)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)