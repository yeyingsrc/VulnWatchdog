## CVE-2019-9193-PostgreSQL-远程代码执行

**漏洞编号:** CVE-2019-9193

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** PostgreSQL

**危害等级:** 高危，允许经过身份验证的用户执行任意操作系统命令

**影响版本:** 9.3 - 11.7

**利用条件:** 需要有效的PostgreSQL数据库用户名和密码，且目标数据库开启了`COPY TO/FROM PROGRAM`功能

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2019-9193 漏洞存在于 PostgreSQL 9.3 到 11.2 版本中。`COPY TO/FROM PROGRAM` 功能允许超级用户以及 'pg_execute_server_program' 组中的用户，以数据库操作系统用户的身份执行任意代码。提供的漏洞利用代码 `cve-2019–9193.py` 实现了利用该漏洞的 PoC。该 PoC 脚本接受数据库的 IP 地址、端口、数据库名称、用户名、密码和连接超时等参数。它首先连接到数据库，然后检查 PostgreSQL 的版本，确认其是否位于易受攻击的范围内 (9.3 - 11.7)。如果版本易受攻击，脚本将进入一个循环，允许用户输入要执行的操作系统命令。该脚本使用 `COPY table FROM PROGRAM 'command'` 构造恶意的 SQL 查询，执行操作系统命令并将结果存储在临时表中。然后从临时表中读取结果并打印到控制台。最后删除临时表。

**有效性：** 提供的 PoC 代码有效，因为它直接利用了 `COPY FROM PROGRAM` 功能来执行操作系统命令。

**投毒风险：** 考虑到这是一个已知的 CVE 的 PoC，其主要功能是利用漏洞，因此投毒的可能性较低。但是，任何代码都存在潜在的风险。为了降低风险，必须仔细审计提供的脚本。此脚本的投毒风险预估为5%。潜在的风险可能在于作者修改了原始利用代码，在执行目标命令前后偷偷执行其他操作, 例如反弹shell或植入后门。在实际环境中应当仔细审计和测试.

**利用方式：** 该漏洞的利用方式如下：
1.  使用提供的 PoC 脚本连接到目标 PostgreSQL 数据库。
2.  脚本会验证 PostgreSQL 的版本是否在易受攻击的范围内。
3.  如果版本易受攻击，则脚本会允许用户输入要执行的操作系统命令。
4.  脚本使用 `COPY table FROM PROGRAM 'command'` 构造恶意的 SQL 查询，执行操作系统命令并将结果存储在临时表中。
5.  脚本从临时表中读取结果并打印到控制台。
6.  最后，脚本删除临时表。

**项目地址:** [chromanite/CVE-2019-9193-PostgreSQL-9.3-11.7](https://github.com/chromanite/CVE-2019-9193-PostgreSQL-9.3-11.7)

**漏洞详情:** [CVE-2019-9193](https://nvd.nist.gov/vuln/detail/CVE-2019-9193)