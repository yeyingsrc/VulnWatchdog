## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要已认证用户执行 Lua 脚本 (默认开启)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-49844 是 Redis 中 Lua 脚本引擎的一个 Use-After-Free 漏洞。该漏洞允许经过身份验证的用户通过精心构造的 Lua 脚本来操纵垃圾回收器，触发 Use-After-Free 漏洞，并可能导致远程代码执行。

**有效性:**

根据漏洞库信息和提供的POC代码，可以判断POC代码有效。POC目录下的 `demonstration.py` 文件展示了如何利用 Lua 脚本中的垃圾回收机制来触发该漏洞。 `README.md` 描述了如何使用该 POC 在目标 Redis 环境中执行命令或连接到反向 shell。

**投毒风险:**

对提供的POC代码进行分析，发现作者提供的代码主要用于漏洞验证，没有发现明显的恶意投毒代码。`pyproject.toml` 定义了依赖项，如 `hexdump`、`iced-x86` 和 `redis`，这些依赖项都是常用的库，没有发现可疑之处。`dockerfiles` 目录下的 Dockerfile 和 compose.yaml 文件定义了 Redis 的运行环境，也没有发现恶意代码。 但是考虑到任何代码都可能被用于恶意目的，因此无法完全排除投毒风险，综合考虑，判定投毒风险为5%。

**利用方式:**

1.  **Lua 脚本执行:** 攻击者需要能够执行 Lua 脚本。默认情况下 Redis 允许执行 Lua 脚本。但在实际环境中可能通过 ACL 限制 `EVAL` 和 `EVALSHA` 命令来缓解。
2.  **精心构造的 Lua 脚本:** 攻击者需要构造一个特殊的 Lua 脚本，该脚本利用 Lua 垃圾回收器的行为，在对象被释放后再次访问它，触发 Use-After-Free 漏洞。
3.  **利用 Use-After-Free 漏洞:** 成功触发 Use-After-Free 漏洞后，攻击者可以进一步利用该漏洞执行任意代码，例如，执行系统命令或连接到反向 shell。

**总结:**

该漏洞危害性极高，攻击者可以利用该漏洞在 Redis 服务器上执行任意代码。修复方法是升级到 Redis 8.2.2 或更高版本，或者通过 ACL 限制 `EVAL` 和 `EVALSHA` 命令的执行。

**项目地址:** [saneki/cve-2025-49844](https://github.com/saneki/cve-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)