## CVE-2025-49844-Redis-Lua Use-After-Free

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis开启Lua脚本支持，并允许攻击者执行Lua脚本 (默认配置可能允许)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-49844 是一个 Redis Lua 解释器中的 Use-After-Free 漏洞，可能导致远程代码执行。

**有效性：**

根据提供的漏洞信息和漏洞利用代码，POC代码的有效性较高。漏洞库信息明确指出，Redis 版本低于 8.2.2 受到此漏洞的影响，而提供的 Dockerfile 使用了 Redis 7.2.0，确认是受影响的版本。提供的 README.md 文档详细描述了漏洞利用的步骤和预期输出，包含验证漏洞、触发UAF，测试沙箱逃逸、内存破坏等方式，进一步佐证了 POC 代码的有效性。

**投毒风险：**

提供的 Dockerfile 只是为了创建一个存在漏洞的 Redis 环境，其主要目的是方便进行漏洞验证和复现。其中`protected-mode no`、`bind 0.0.0.0`等配置项，是为了方便攻击，让 Redis 暴露在公网上，方便漏洞的利用.但实际环境中，这些配置都是非常危险的。 提供的python脚本`exploit_poc.py` 主要是用来验证漏洞的存在和利用。综合来看，虽然存在一些不安全的配置，方便了攻击，但并未发现明显的投毒代码。投毒风险较低，评估为10%。风险主要集中在使用者是否清楚风险，以及是否在生产环境中使用这些不安全配置上。

**利用方式：**

1.  **漏洞触发：** 攻击者需要能够连接到 Redis 服务器，并且 Redis 实例允许执行 Lua 脚本。默认情况下，未经身份验证的连接即可执行 Lua 脚本。
2.  **利用 EVAL 命令：** 攻击者可以使用 EVAL 或 EVALSHA 命令发送恶意的 Lua 脚本。
3.  **UAF 触发：** 恶意 Lua 脚本会精心构造，利用 Redis 的垃圾回收机制中的缺陷，触发 Use-After-Free 漏洞。这通常涉及对 Redis 内部对象进行操作，导致在对象被释放后仍然被访问。
4.  **沙箱逃逸(如果存在)：**早期的分析和报告曾提到利用此UAF进行沙箱逃逸，但是更多是利用内存破坏直接实现RCE。 如果目标启用了 Lua 沙箱，攻击者可能需要利用 UAF 漏洞绕过沙箱限制，以便执行任意代码。
5.  **远程代码执行：** 成功利用 Use-After-Free 漏洞后，攻击者可以执行任意代码，从而完全控制 Redis 服务器。这意味着攻击者可以读取、修改或删除 Redis 中的数据，甚至可以利用 Redis 服务器作为跳板攻击内网中的其他系统。
6.  **利用 ACL 进行缓解：** 漏洞描述中提到可以通过 ACL 限制 EVAL 和 EVALSHA 命令来缓解此漏洞。

**项目地址:** [lastvocher/redis-CVE-2025-49844](https://github.com/lastvocher/redis-CVE-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)