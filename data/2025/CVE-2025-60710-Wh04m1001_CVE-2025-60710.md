## CVE-2025-60710 - Host Process for Windows Tasks 权限提升漏洞

**漏洞编号:** CVE-2025-60710

**漏洞类型:** 权限提升

**影响应用:** Host Process for Windows Tasks

**危害等级:** 高危，攻击者可利用此漏洞获得SYSTEM权限

**影响版本:** Windows 11 Version 25H2 (10.0.26200.0 <= version < 10.0.26200.7171)

**利用条件:** 需要本地访问权限和用户在%LOCALAPPDATA%下创建目录的权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2025-60710是Windows任务宿主进程中的一个权限提升漏洞。攻击者可以利用该漏洞，通过不正确的链接解析在文件访问之前（'链接跟随'），在本地提升权限。该漏洞存在于`\Microsoft\Windows\WindowsAI\Recall\PolicyConfiguration`计划任务中。

**漏洞原理：**
当计划任务启动时，`taskhostw.exe`进程会尝试打开`C:\Users\%username%\AppData\Local\CoreAIPlatform.00\UKP`目录，并使用`{????????-????-????-????-????????????}`过滤器搜索目录。如果找到匹配的目录，它将在不检查符号链接的情况下将其删除。由于低权限用户默认可以在自己的`%LOCALAPPDATA%`文件夹中创建目录，这会导致以`NT AUTHORITY\SYSTEM`用户的身份删除任意文件夹。

**利用方式：**
1.  攻击者在`C:\Users\%username%\AppData\Local\CoreAIPlatform.00\UKP`下创建一个符合`{????????-????-????-????-????????????}`格式的目录，并将其设置为指向敏感目录的符号链接（例如，`C:\Windows\System32`）。
2.  通过WnfStateChangeTrigger（`RecallPolicyCheckUpdateTrigger`）或其他触发器（例如`AADStatusChangeTrigger`, `DisableAIDataAnalysisTrigger`, `UserLoginTrigger`, `SessionUnlockTrigger`）触发`\Microsoft\Windows\WindowsAI\Recall\PolicyConfiguration`计划任务。
3.  计划任务以`SYSTEM`权限运行，尝试删除攻击者创建的目录。由于该目录是符号链接，计划任务实际上会删除链接指向的目标目录，从而导致任意文件删除。

**有效性：**
提供的POC代码通过WnfStateChangeTrigger触发计划任务，并通过符号链接删除任意目录，利用方式与漏洞描述一致，因此POC有效。

**投毒风险：**
提供的代码主要是创建目录、设置符号链接、触发计划任务，没有发现任何恶意代码或后门代码，初步判断投毒风险较低。vcxproj, sln文件中也未发现异常，所以投毒风险较低，判断投毒风险为0%。

**总结：**
该漏洞允许低权限用户通过创建符号链接和触发特定的计划任务，以`SYSTEM`权限删除任意文件或目录，从而实现权限提升。该漏洞风险较高，建议尽快安装补丁。

**项目地址:** [Wh04m1001/CVE-2025-60710](https://github.com/Wh04m1001/CVE-2025-60710)

**漏洞详情:** [CVE-2025-60710](https://nvd.nist.gov/vuln/detail/CVE-2025-60710)