## CVE-2025-33073 Windows SMB Client 提权漏洞

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 提权漏洞

**影响应用:** Windows SMB Client

**危害等级:** 高危，可导致权限提升

**影响版本:** 受影响的Windows版本和Build号在漏洞库信息中已列出

**利用条件:** 需要能够访问目标网络，并且目标机器上存在受影响的SMB客户端版本。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

根据漏洞库信息，CVE-2025-33073是Windows SMB客户端中的一个权限提升漏洞，允许经过身份验证的攻击者通过网络提升权限。提供的漏洞利用代码（CVE-2025-33073.py）利用了dnstool.py、ntlmrelayx和nxc等工具，构成了一个完整的攻击链。该攻击链首先使用dnstool.py在域控制器上添加一个恶意的DNS记录。然后，该脚本会等待DNS记录生效。接下来，脚本启动ntlmrelayx，配置为将收到的NTLM认证请求转发到目标机器。最后，脚本通过nxc（用于网络渗透测试）使用PetitPotam、Printerbug或DFSCoerce等强制认证方法，诱使目标机器向攻击者控制的ntlmrelayx服务器进行身份验证，从而利用NTLM relay攻击提升权限。

**有效性分析：**

该POC代码利用了已知的NTLM relay攻击技术，结合DNS欺骗和强制认证方法，在特定条件下可以有效提升权限。漏洞利用代码主要依赖于 `dnstool.py` 添加恶意 DNS 记录，结合 `ntlmrelayx` 监听和中继 NTLM 认证，最后通过 `nxc` 触发强制认证。

**投毒风险分析：**

代码存在一定的投毒风险，但可能性较低，约为5%。原因如下：

*   代码中使用了多个第三方工具（dnstool.py, impacket-ntlmrelayx, nxc）。虽然这些工具本身是合法的渗透测试工具，但如果攻击者修改了脚本，使其在调用这些工具时添加额外的恶意参数或执行恶意操作，则可能存在投毒风险。
*   该脚本本身包含添加DNS记录的操作，如果被滥用，可能会导致网络中断或其他恶意行为。
*   脚本通过 xterm 打开新终端执行命令，这种行为本身可能存在风险。攻击者可能会利用这一点，在终端中执行恶意命令。

**利用方式分析：**

1.  **设置环境:** 攻击者需要一个攻击机（通常是Linux/Kali），安装了必要的工具（dnstool.py，impacket，nxc）。
2.  **DNS欺骗:** 攻击者使用dnstool.py向域控制器添加一个静态DNS记录，将特定的主机名解析到攻击者的IP地址。
3.  **NTLM中继:** 攻击者启动ntlmrelayx，监听传入的NTLM认证请求，并将其转发到目标机器。
4.  **强制认证:** 攻击者使用nxc（或类似工具）结合PetitPotam、Printerbug或DFSCoerce等方法，诱使目标机器通过SMB协议向攻击者控制的ntlmrelayx服务器进行身份验证。
5.  **权限提升:** 一旦目标机器向ntlmrelayx进行身份验证，攻击者就可以利用中继的凭据在目标机器上执行命令，从而提升权限。

**漏洞缓解措施：**

*   安装Microsoft提供的安全更新。
*   启用SMB签名以防止NTLM中继攻击。
*   限制对RPC服务的访问。
*   监控DNS服务器的异常记录。

**项目地址:** [Ashwesker/Blackash-CVE-2025-33073](https://github.com/Ashwesker/Blackash-CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)