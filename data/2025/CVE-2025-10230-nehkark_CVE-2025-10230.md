## CVE-2025-10230-Samba-WINS Hook命令注入

**漏洞编号:** CVE-2025-10230

**漏洞类型:** 命令注入

**影响应用:** Samba

**危害等级:** 高危，允许未经身份验证的远程攻击者以Samba进程权限执行任意命令

**影响版本:** Samba版本小于4.21.9，4.22.x版本小于4.22.5，4.23.x版本小于4.23.2且wins support = yes, 并且配置了wins hook

**利用条件:** Samba服务器启用WINS支持（wins support = yes）并且配置了WINS hook（wins hook = ...），服务器监听137/UDP端口

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2025-10230是Samba WINS hook处理中的命令注入漏洞。当Samba作为Active Directory域控制器，并启用了`wins support = yes`和配置了`wins hook = ...`时，攻击者可以通过发送特制的NetBIOS注册数据包到UDP 137端口，在NetBIOS名称中包含恶意shell命令，由于Samba没有对NetBIOS名称进行充分的验证和转义，直接将其拼接进shell命令中执行，从而以Samba进程的权限（通常是root权限）执行任意命令。PoC代码通过构造包含恶意payload的NetBIOS数据包来利用此漏洞。由于代码量少, 且作者已经声明研究目的是教育和防御目的, 故投毒概率极低。

**漏洞利用方式：**

1.  **目标确定：**  确定运行存在漏洞Samba版本，且启用了WINS支持，并配置了WINS hook的服务器。
2.  **数据包构造：**  使用PoC脚本（`cve-2025-10230.py`）构造包含恶意payload的NetBIOS Name Service (NBNS) 注册数据包。Payload需要满足 ≤15 字符的限制，并且不能包含 `< > ;` 等字符。
3.  **发送数据包：**  将构造的数据包发送到目标Samba服务器的UDP 137端口。
4.  **命令执行：**  Samba服务器接收到数据包后，WINS hook处理程序会执行包含恶意payload的shell命令。
5.  **权限获取：**  恶意命令以Samba进程的权限执行，从而可能获取服务器的控制权。

**项目地址:** [nehkark/CVE-2025-10230](https://github.com/nehkark/CVE-2025-10230)

**漏洞详情:** [CVE-2025-10230](https://nvd.nist.gov/vuln/detail/CVE-2025-10230)