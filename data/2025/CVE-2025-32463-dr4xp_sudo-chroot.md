## CVE-2025-32463-Sudo-本地权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获得Root权限

**影响版本:** 1.9.14 <= Sudo < 1.9.17p1

**利用条件:** 本地用户权限，sudo版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Sudo 1.9.14 到 1.9.17p1 之间，允许本地用户通过 `--chroot` 选项，利用用户可控目录下的 `/etc/nsswitch.conf` 文件来获得Root权限。

**漏洞利用方式：**

1.  创建一个临时目录 `temp_dir`。
2.  在该目录下创建一个 C 文件 `woot1337.c`，包含一个构造函数 `woot`，该函数设置用户和组 ID 为 0 (root)，改变当前目录到根目录，并执行 `/bin/bash`，从而获得一个 root shell。
3.  创建目录 `woot/etc` 和 `libnss_`。
4.  创建 `woot/etc/nsswitch.conf` 文件，内容为 `passwd: /woot1337`。这会指示系统使用位于 `woot1337.so.2` 中的自定义 NSS 模块来解析密码数据库。
5.  复制 `/etc/group` 到 `woot/etc` 目录下。
6.  使用 `gcc` 编译 `woot1337.c` 为共享库 `libnss_/woot1337.so.2`。`-Wl,-init,woot` 选项确保 `woot` 函数在库加载时执行。
7.  使用 `sudo -R woot woot` 命令，该命令会使用用户创建的 `woot` 目录作为 chroot 环境。因为 `nsswitch.conf` 文件被设置为使用自定义的 NSS 模块，所以加载 `libnss_/woot1337.so.2` 时会执行 `woot` 函数，从而获得 root shell。
8.  最后，清理临时目录。

**有效性：**

根据漏洞信息和提供的 PoC 代码，此漏洞利用是有效的。PoC 代码通过创建一个恶意的 `nsswitch.conf` 文件，并利用 `sudo -R` 的 chroot 功能，使得 sudo 使用该文件，从而加载攻击者控制的动态链接库，最终提升权限。

**投毒风险：**

PoC 代码中没有明显的投毒代码。该代码的目的是利用漏洞提升权限，所有操作都与漏洞利用相关。代码的主要部分是编译一个共享库并利用 `sudo -R` 加载它以提升权限，没有发现任何隐藏的恶意功能。因此投毒风险为0%。

**项目地址:** [dr4xp/sudo-chroot](https://github.com/dr4xp/sudo-chroot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)