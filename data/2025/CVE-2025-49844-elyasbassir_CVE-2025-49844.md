## CVE-2025-49844 - Redis Lua Use-After-Free 导致远程代码执行

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis服务器开启Lua脚本支持，攻击者需具备低权限用户账号

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Redis的Lua脚本解析器中。攻击者可以利用精心构造的Lua脚本，操纵垃圾回收器，触发释放后使用（Use-After-Free）漏洞，从而可能导致远程代码执行。

**有效性评估：**
提供的POC代码尝试通过创建大量Lua对象并强制进行垃圾回收，从而触发漏洞。具体来说，它定义了一个 `make_chunk_name` 函数，该函数创建一个带有 `__gc` 元方法的代理对象。当该代理对象被垃圾回收时，`__gc` 元方法会被调用，并在此时再次调用 `collectgarbage('collect')`，这可能导致在 Lua 脚本解析器仍在持有chunk name字符串时就进行垃圾回收。该操作可能会导致程序崩溃或者被利用进行代码执行。

**投毒风险评估：**
虽然POC的主要目的是触发漏洞，但仍然存在微小的投毒风险。POC代码的目的是造成崩溃或者代码执行，攻击者可能通过细微修改，增加其他恶意操作，例如在成功利用漏洞后，下载并执行远程shell，或者篡改Redis中的数据等。代码本身的混淆程度较低，易于分析，降低了投毒成功的可能性。风险评估为 10%，主要是考虑到攻击者可能会在利用该漏洞的基础上进行二次开发。

**利用方式：**
1.  攻击者需要拥有Redis实例的访问权限，并能够执行Lua脚本(eval 或 evalsha)。
2.  攻击者发送精心设计的Lua脚本到Redis服务器。
3.  Lua脚本利用垃圾回收机制的缺陷，触发Use-After-Free漏洞。
4.  成功利用该漏洞后，攻击者可以执行任意代码，从而完全控制Redis服务器。

**缓解措施：**
1.  升级Redis到8.2.2或更高版本。
2.  禁用Lua脚本执行功能，或者通过ACL限制可执行Lua脚本的用户。

**项目地址:** [elyasbassir/CVE-2025-49844](https://github.com/elyasbassir/CVE-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)