## CVE-2025-33073 Windows SMB Client Elevation of Privilege Vulnerability

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB Client

**危害等级:** 高危，允许经过身份验证的攻击者在网络上提升权限

**影响版本:** 受影响的Windows版本详见CVE描述

**利用条件:** 需要受害者系统存在于与攻击者相同的网络中，并且攻击者需要具有有效的域用户凭据。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2025-33073 是一个 Windows SMB 客户端提权漏洞。该漏洞的利用方式是首先检查目标服务器是否禁用了 SMB 签名。如果 SMB 签名被禁用，攻击者可以使用 PetitPotam 强制目标机器通过 SMB 协议向攻击者控制的服务器进行身份验证，从而进行 NTLM 中继攻击，最终提升权限。POC代码通过 crackmapexec 工具来检查 SMB 签名状态，使用 netcat 监听 445 端口，并利用 PetitPotam 脚本发起 NTLM 身份验证强制攻击。

**有效性评估:** 提供的 POC 代码看起来有效。它包含了检测漏洞和利用漏洞的必要步骤。它首先检查 SMB 签名是否禁用，然后尝试使用 PetitPotam 进行 NTLM 身份验证强制。

**投毒风险评估:** 投毒风险评估为20%。 虽然该脚本主要目的是验证漏洞的存在，但存在轻微的投毒风险，原因如下：

1.  **依赖外部脚本 (PetitPotam.py):** 该脚本依赖于从外部源下载的 PetitPotam.py 脚本。如果该脚本被恶意修改，则可能导致受害者系统被感染。
2.  **执行系统命令（sudo nc）:** 该脚本使用 `sudo nc` 启动 netcat 监听器，这可能会引入安全风险，尤其是在配置不当的情况下。
3.  **硬编码域名：**脚本的 README.md 文件提示需要在DNS中注册一个域名(`localhost1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA`)，如果攻击者控制了受害者的DNS服务器，则可以劫持该域名并造成进一步的攻击。

**利用方式:**

1.  **环境准备:**  攻击者需要安装 crackmapexec, netcat, python3, 并且获得一个有效的域用户凭据。
2.  **检查 SMB 签名:** 使用 crackmapexec 工具检查目标服务器是否禁用了 SMB 签名。
3.  **强制身份验证:** 如果 SMB 签名被禁用，攻击者使用 PetitPotam 脚本强制目标机器通过 SMB 协议向攻击者控制的服务器进行身份验证。
4.  **NTLM 中继:**  攻击者使用 netcat 监听 445 端口，捕获 NTLM 身份验证信息。
5.  **权限提升:**  攻击者利用捕获到的 NTLM 身份验证信息进行 NTLM 中继攻击，最终提升权限。

**项目地址:** [matejsmycka/CVE-2025-33073-checker](https://github.com/matejsmycka/CVE-2025-33073-checker)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)