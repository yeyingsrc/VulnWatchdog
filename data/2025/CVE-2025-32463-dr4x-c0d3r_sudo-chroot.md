## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，允许本地用户获得root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户需要能够执行sudo命令，且sudo版本在受影响范围内。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

漏洞CVE-2025-32463存在于Sudo 1.9.14到1.9.17p1版本之前，允许本地用户通过`sudo -R`选项利用用户可控的`/etc/nsswitch.conf`文件来获取root权限。具体利用方式如下：

1.  **漏洞原理：** `sudo -R`或`--chroot`选项用于在指定的根目录下运行命令。漏洞在于，sudo在切换根目录后，会使用新的根目录下的`/etc/nsswitch.conf`文件进行名称服务查找（例如用户、组等）。如果攻击者可以控制这个文件，就可以劫持名称服务查找过程，从而执行任意代码。

2.  **POC代码分析：**
    *   该Python脚本首先创建一个临时目录`/tmp/sudowoot.stage.*`，并在其中创建攻击所需的必要文件和目录。
    *   **woot1337.c：**  这段C代码定义了一个构造函数`woot()`，该函数在动态链接库被加载时自动执行。函数内部，它将进程的有效用户ID和组ID设置为0（root），然后切换到根目录，并执行`/bin/bash`，从而获得一个root shell。
    *   **woot/etc/nsswitch.conf：**  该文件覆盖了系统的`/etc/nsswitch.conf`文件。关键的一行是`passwd: /woot1337`。这意味着当sudo需要查找用户信息时，它会尝试从`/woot1337`文件（实际上是一个动态链接库）中查找，而不是使用标准的系统文件。
    *   **libnss_/woot1337.so.2：**  这是将`woot1337.c`编译成的动态链接库。当sudo尝试加载`/woot1337`时，实际上加载了这个动态链接库，从而执行了`woot()`函数，获得了root shell。
    *   脚本最后使用`sudo -R woot woot`命令在chroot环境下执行`woot`命令，触发漏洞。

3.  **漏洞利用方式：**
    *   攻击者首先创建一个包含恶意`/etc/nsswitch.conf`文件的目录。
    *   然后，攻击者利用`sudo -R`选项，将根目录切换到攻击者创建的目录。
    *   当sudo需要进行用户或组查找时，它会读取攻击者提供的`/etc/nsswitch.conf`文件，并加载攻击者提供的恶意动态链接库。
    *   恶意动态链接库中的代码被执行，攻击者获得root权限。

4.  **投毒风险评估：**
    *   该代码的功能是为了验证漏洞，虽然会创建一个root shell，但只是在本地利用，没有发现包含任何额外的、未经说明的恶意功能，因此不存在作者隐藏的投毒代码。
    *   投毒风险：0%。

**项目地址:** [dr4x-c0d3r/sudo-chroot](https://github.com/dr4x-c0d3r/sudo-chroot)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)