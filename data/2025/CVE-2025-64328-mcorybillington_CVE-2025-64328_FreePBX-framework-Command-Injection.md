## CVE-2025-64328-FreePBX-Authenticated Command Injection

**漏洞编号:** CVE-2025-64328

**漏洞类型:** 命令注入

**影响应用:** FreePBX

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** >= 17.0.2.36, < 17.0.3

**利用条件:** 需要 FreePBX 管理员权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于 FreePBX 的 filestore 模块中的 `testconnection` 功能，攻击者可以通过构造恶意的 shell 命令，在拥有 FreePBX 管理员权限的前提下，利用 `check_ssh_connect()` 函数中的命令注入漏洞执行任意系统命令。

**有效性：**
提供的 Nuclei 模板 (CVE-2025-64328.yaml) 和 curl 命令 PoC 均表明该漏洞利用的有效性。Nuclei 模板通过模拟登录并发送包含命令注入的 GET 请求来验证漏洞。curl 命令 PoC 展示了如何通过构造包含恶意命令的 `key` 参数来实现命令注入，并在目标服务器上写入文件。

**投毒风险：**
该仓库存在轻微的投毒风险。风险点主要集中在 Nuclei 模板中的 `cmd` 变量。虽然示例中使用了 `nslookup {{interactsh-url}}` 这样的 OAST (Out-of-band Application Security Testing) 命令进行验证，但攻击者可能修改该变量，执行更具破坏性的命令。此外，PoC虽然相对简单，但仍可能被滥用，对 FreePBX 系统造成损害。投毒风险评估为 10%。

**利用方式：**
1.  **身份验证：** 攻击者首先需要拥有 FreePBX 管理员账号的用户名和密码。通过 POST 请求登录 `admin/config.php`。PoC 使用 `username` 和 `password` 参数进行身份验证。
2.  **构造恶意请求：** 成功登录后，攻击者需要构造一个包含恶意命令的 GET 请求，发送到 `admin/ajax.php`。该请求针对 `filestore` 模块的 `testconnection` 命令，并设置以下参数：
    *   `module=filestore`
    *   `command=testconnection`
    *   `driver=SSH`
    *   `host=127.0.0.1` (可以是任意值，不影响漏洞利用)
    *   `user` (可以设置为任意值，用于绕过参数验证)
    *   `port=22` (可以是任意值，不影响漏洞利用)
    *   `key=asdf`echo rcetest2>/var/www/html/rcetest.txt`` (恶意命令注入点)   
    *   `path` (可以设置为任意值，用于绕过参数验证)
3.  **命令执行：** FreePBX 在处理该请求时，会执行 `check_ssh_connect()` 函数，由于对 `key` 参数的过滤不足，导致其中的恶意命令被执行。在 PoC 中，命令 `echo rcetest2>/var/www/html/rcetest.txt` 会将字符串 `rcetest2` 写入到 `/var/www/html/rcetest.txt` 文件中，攻击者可以替换为任何其他命令。
4.  **验证：** 攻击者可以通过访问 `/rcetest.txt` 来验证命令是否成功执行。

**项目地址:** [mcorybillington/CVE-2025-64328_FreePBX-framework-Command-Injection](https://github.com/mcorybillington/CVE-2025-64328_FreePBX-framework-Command-Injection)

**漏洞详情:** [CVE-2025-64328](https://nvd.nist.gov/vuln/detail/CVE-2025-64328)