## CVE-2025-32463 - Sudo 本地提权漏洞

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** 1.9.14 <= version < 1.9.17p1

**利用条件:** 本地用户访问权限

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-32463 是一个 Sudo 漏洞，存在于 1.9.14 到 1.9.16 版本（在 1.9.17p1 中修复）。漏洞的利用方式是，攻击者可以利用 `sudo` 命令的 `--chroot` 选项，结合用户可控目录下的 `/etc/nsswitch.conf` 文件来获取 root 权限。

**漏洞利用方式分析：**

1.  **创建临时目录：**  首先，在临时目录下创建必要的目录结构（`woot/etc`，`libnss_`），并放置恶意构造的 `nsswitch.conf` 文件。该文件将密码查找指向一个恶意的共享库。
2.  **构造 `nsswitch.conf`：**  在 `woot/etc/nsswitch.conf` 文件中，将 `passwd:` 指向一个恶意共享库，例如 `/woot1337`。这样，当 `sudo` 需要查找用户信息时，就会加载该共享库。
3.  **编译恶意共享库：**  创建一个 C 文件 (`woot1337.c`)，该文件包含一个构造函数 `woot()`，该函数在加载时会被执行。在这个函数中，设置用户的 uid 和 gid 为 0 (root)，然后执行一个 shell。
4.  **使用 `--chroot` 选项运行 `sudo`：**  使用 `sudo -R woot woot` 命令，其中 `-R woot` 指定 `sudo` 使用 `woot` 目录作为 chroot 环境。由于 `nsswitch.conf` 指向的共享库位于 chroot 环境之外，因此 `sudo` 会加载我们构造的恶意共享库。由于在构造函数中设置了用户的 uid 和 gid 为 0，因此启动的 shell 具有 root 权限。

**有效性评估：**

根据漏洞描述和提供的 PoC 代码，该 PoC 的有效性较高。它完整地实现了利用漏洞所需的步骤，包括创建临时目录、构造 `nsswitch.conf`、编译恶意共享库以及使用 `sudo` 命令触发漏洞。

**投毒风险评估：**

PoC 代码本身主要实现了漏洞的利用逻辑，用于本地提权。仔细检查代码，发现有如下潜在投毒风险：

1. `POC VIDEO.mp4`该文件可能是伪装的恶意文件，通过双重文件扩展名的方式来欺骗用户执行。
2. 虽然该 PoC 主要关注本地提权，但如果被用于自动化攻击脚本中，可能会对目标系统造成意料之外的损害。该风险较低，评估为 5%。其他代码部分均为常规漏洞利用步骤，判断为后门代码。

**总结：**

此漏洞允许本地用户通过精心构造的环境和 `nsswitch.conf` 文件，配合 `sudo` 命令的 `--chroot` 选项来获得 root 权限。提供的 PoC 代码能够有效利用该漏洞，存在一定程度的投毒风险。

**项目地址:** [AC8999/CVE-2025-32463](https://github.com/AC8999/CVE-2025-32463)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)