## CVE-2025-33073 Windows SMB Client 权限提升漏洞

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB Client

**危害等级:** 高危，可导致SYSTEM权限代码执行

**影响版本:** 见受影响的Windows版本列表

**利用条件:** 需要攻击者在域内, 拥有DNSAdmins权限, 目标DC启用WinRM服务，且网络可达（SMB 445, DNS 53, WinRM 5985/5986端口）。

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2025-33073 漏洞允许经过身份验证的攻击者通过网络提升权限。该漏洞的利用方式主要通过以下步骤：

1.  **DNS 投毒:** 利用`krbrelayx.dnstool`修改或创建DNS记录，将目标指向攻击者控制的IP地址。
2.  **NTLM 中继:** 启动NTLM中继服务器 (`ntlmrelayx.py`)，监听传入的NTLM认证请求。
3.  **强制认证:** 使用`nxc`和`PetitPotam`等工具，强制域控制器 (DC) 向攻击者的IP地址进行身份验证。
4.  **中继至 WinRM:** 将捕获的NTLM认证凭据中继到目标DC的WinRM服务。
5.  **获取 SYSTEM Shell:** 成功认证后，通过WinRM执行系统命令，获取SYSTEM权限的shell。
6.  **自动提取 Flag:** 脚本自动搜索并提取指定目录和文件模式中的flag。

**有效性评估：**

根据漏洞描述和提供的PoC代码，该漏洞利用链是可行的。PoC代码包含了DNS投毒、NTLM中继和WinRM利用等关键步骤，并且针对CTF环境进行了优化，具有较高的成功率。

**投毒风险评估：**

虽然PoC代码本身看起来是合法的漏洞利用工具，但仍然存在一定的投毒风险。风险主要体现在以下几个方面：

*   **外部依赖：** PoC依赖`krbrelayx`和`impacket`等外部库。这些库如果被恶意修改，可能引入恶意代码。
*   **命令执行：** PoC会执行系统命令，攻击者可以通过修改`exploit.sh`中的命令来执行恶意操作。
*  **脚本内容分析:** 初步检查未发现明显的恶意代码，但是代码逻辑较为复杂，存在隐藏后门的可能，需进一步审计脚本和依赖。

综合以上因素，初步判断投毒风险为30%。需要注意的是，在实际使用PoC时，务必进行代码审计，并从可信的来源获取依赖库，以降低安全风险。

**项目地址:** [uziii2208/CVE-2025-33073](https://github.com/uziii2208/CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)