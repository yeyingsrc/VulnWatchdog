## CVE-2025-33073 Windows SMB客户端权限提升漏洞

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB

**危害等级:** 高危，允许攻击者通过网络提升权限

**影响版本:** 受影响的Windows版本包括Windows Server 2008 SP2至Windows Server 2025等多个版本，具体版本范围请参考CVE信息。

**利用条件:** 需要攻击者在受影响的Windows域控制器中具有DNSAdmins组的成员权限，并且目标系统启用了WinRM服务，同时网络需要能够访问DC的SMB (445端口), DNS(53端口)和WinRM(5985/5986端口)

**POC 可用性:** 是

**投毒风险:** 30%

## 详情

CVE-2025-33073是一个Windows SMB客户端权限提升漏洞，攻击者利用该漏洞通过组合DNS记录操纵（需要DNSAdmins权限）、NTLM中继攻击和WinRM身份验证绕过，可以在Windows域控制器上实现SYSTEM级别的代码执行。

**漏洞利用方式：**

1.  **DNS中毒：** 攻击者首先利用`krbrelayx.dnstool`修改或创建DNS记录，将目标指向攻击者的IP地址。这是通过拥有`DNSAdmins`权限的用户来实现的。
2.  **NTLM中继服务器：** 运行`ntlmrelayx.py`，监听传入的NTLM身份验证请求。
3.  **强制认证：** 使用`nxc`工具和PetitPotam方法，强制域控制器向攻击者的IP地址进行身份验证。
4.  **中继到WinRM：** 将收到的NTLM身份验证信息中继到目标WinRM服务。
5.  **SYSTEM Shell：** 成功中继身份验证后，攻击者可以作为SYSTEM用户执行命令。
6.  **自动Flag提取：** 脚本会自动搜索并提取包含“flag”、“root”、“user”等关键词的文件。

**有效性评估：**

根据漏洞描述和提供的PoC代码，该漏洞利用具有较高的有效性。PoC包含自动化的攻击流程，包括DNS中毒、NTLM中继和WinRM利用，并且提供了详细的步骤和配置说明。

**投毒风险评估：**

PoC代码中存在一定的投毒风险，风险系数为30%。风险点包括：

*   **krbrelayx依赖：** PoC依赖于第三方工具krbrelayx，如果该工具本身被篡改，可能引入恶意代码。
*   **自动提取Flag：** 脚本自动搜索包含特定关键词的文件，攻击者可能利用这一点，在受害者系统上放置包含恶意代码的文件，并诱导脚本提取执行。
*   **自定义DNS记录：**`exploit.sh`脚本中存在`LONGHOST`变量，允许自定义DNS记录。如果攻击者诱导用户修改此变量为恶意地址，可能导致其他安全问题。
*   **第三方库 impacket netexec** 恶意代码可能会被隐藏在这些第三方库中. 

**项目地址:** [uziii2208/CVE-2025-33073](https://github.com/uziii2208/CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)