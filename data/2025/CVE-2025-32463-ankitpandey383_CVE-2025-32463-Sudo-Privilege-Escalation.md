## CVE-2025-32463-Sudo-本地提权

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地提权

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 - 1.9.17 (不含 1.9.17p1)

**利用条件:** 本地用户，sudo版本在受影响范围内，允许chroot选项

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

该漏洞存在于Sudo的--chroot选项中。攻击者可以利用用户可控目录下的/etc/nsswitch.conf文件，通过构造恶意的共享库，在chroot环境下执行任意代码，从而获得root权限。 

**利用方式分析:**
1.  **漏洞原理：** Sudo在执行`sudo -R`命令时，允许使用`--chroot`参数来改变根目录。 如果`nsswitch.conf`文件（用于配置名称服务切换）位于用户可控的目录下，则sudo会加载用户提供的`nsswitch.conf`，并根据其中的配置加载相应的`libnss_*.so`共享库。如果用户构造恶意的共享库，则可以在sudo进程中执行任意代码。
2.  **POC代码分析：**
    *   `sudo-chwoot.sh`脚本首先创建一个临时目录`${STAGE}`，并进入该目录。
    *   然后，根据是否提供了命令，设置要执行的命令`CMD`，默认为`/bin/bash`。
    *   将命令转义后插入到C代码`woot1337.c`中。该C代码利用`__attribute__((constructor))`在共享库加载时自动执行`woot`函数，该函数设置uid和gid为0，然后执行指定的命令。
    *   创建`woot/etc/nsswitch.conf`文件，内容为`passwd: /woot1337`，指定使用`/woot1337`共享库来解析passwd条目。
    *   将`/etc/group`复制到`woot/etc`，可能是为了满足某些依赖。
    *   使用`gcc`编译`woot1337.c`为共享库`libnss_/woot1337.so.2`。
    *   执行`sudo -R woot woot`，其中`woot`是临时目录，也是`chroot`的目标目录。由于`woot/etc/nsswitch.conf`存在，sudo会加载`libnss_/woot1337.so.2`，从而执行其中的代码，实现提权。
    *   最后，删除临时目录。
3.  **有效性：** 提供的POC代码应该有效，它展示了漏洞利用的基本步骤，能够在受影响的版本上实现本地提权。
4.  **投毒风险：** 投毒风险较低。虽然脚本包含C代码编译过程，但C代码本身的功能是明确的，就是设置权限并执行指定命令。脚本中确实没有发现明显的恶意代码。但仍然需要注意，任何自动执行的脚本都存在潜在风险，特别是涉及到root权限时。`5%` 的风险值主要是考虑到以下可能：
    *   **细微的代码修改：** 虽然当前代码看起来安全，但攻击者可能在未来版本中引入细微的修改，使其在特定环境下执行恶意操作，比如特定文件存在时。
    *   **依赖项风险：** 脚本依赖于`gcc`和`sudo`等系统命令，如果这些命令本身被篡改，可能导致安全问题。
    *   **环境依赖性：** 脚本在特定环境下的行为可能与预期不同，导致未知的安全风险。


**项目地址:** [ankitpandey383/CVE-2025-32463-Sudo-Privilege-Escalation](https://github.com/ankitpandey383/CVE-2025-32463-Sudo-Privilege-Escalation)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)