## CVE-2025-8088-WinRAR-Path Traversal

**漏洞编号:** CVE-2025-8088

**漏洞类型:** 路径遍历

**影响应用:** WinRAR

**危害等级:** 高危，可能导致任意代码执行

**影响版本:** <= 7.12

**利用条件:** 用户需要解压恶意RAR压缩包

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

该漏洞是 WinRAR 中存在的路径遍历漏洞，允许攻击者通过构造恶意 RAR 压缩包来执行任意代码。漏洞利用代码 `CVE-2025-8088.py` 的分析如下：

1.  **漏洞原理：** 该漏洞利用了 WinRAR 在处理压缩包时，未正确过滤文件名中的路径分隔符（如 `..\`），导致可以将文件解压到任意目录。通过构造包含恶意路径的文件，可以将 payload 放置到启动目录，从而实现开机自启动，执行任意代码。

2.  **POC 代码分析：**
    *   代码首先定义了一些常量，包括要创建的遍历深度 (`NUM_DEPTHS`)、payload 放置的相对路径 (`RELATIVE_DROP_PATH`)、payload 内容 (`PAYLOAD`)、占位符长度 (`PLACEHOLDER_LEN`) 和输出 RAR 文件名 (`OUT_RAR`)。
    *   `create_files()` 函数创建占位文件和 payload 文件（一个简单的 bat 脚本，用于显示“Payload executed!”）。
    *   `attach_ads()` 函数用于将 payload 作为备用数据流附加到 decoy 文件。
    *   `find_rar()` 函数用于查找 WinRAR 可执行文件。
    *   `create_base_rar()` 函数使用 WinRAR 可执行文件创建一个包含 decoy 文件的基本 RAR 压缩包。
    *   `get_vint()` 函数用于从字节缓冲区读取可变长度整数，这在解析 RAR5 格式时是必要的。
    *   `patch_placeholder_in_header()` 函数用目标路径替换标头中的占位符。
    *   `rebuild_all_header_crc()` 函数重新计算所有标头的 CRC 校验和。
    *   `build_relative_paths()` 函数生成不同深度的路径遍历字符串列表。
    *   `patch_rar()` 函数的核心功能。它读取基本 RAR 压缩包的内容，然后使用 `patch_placeholder_in_header()` 函数将文件名中的占位符替换为包含路径遍历的恶意路径，例如 `..\..\..\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\payload.bat`。然后，它使用 `rebuild_all_header_crc()` 函数重新计算修改后的标头的 CRC 校验和，并将修改后的数据写入输出 RAR 文件。

3.  **利用方式：**
    *   攻击者运行脚本 `CVE-2025-8088.py`，该脚本自动创建包含恶意路径的 RAR 压缩包。
    *   攻击者将恶意 RAR 压缩包发送给受害者。
    *   受害者使用 WinRAR 解压该压缩包。
    *   由于路径遍历漏洞，payload 文件被解压到受害者计算机的启动目录中。
    *   下次受害者启动计算机时，payload 文件将自动执行，从而允许攻击者执行任意代码。

4.  **有效性评估：** 基于漏洞信息和 POC 代码，可以判定该 POC 有效。POC 代码实现了路径遍历漏洞的利用，并且包含必要的步骤来构造恶意的 RAR 压缩包，最终实现任意代码执行。

5. **投毒风险评估:** 代码中确实存在执行任意命令的功能,但是这段代码目的是为了验证漏洞,如果用户不下载此代码到本地,并且执行验证过程,那么漏洞不会被触发,所以投毒概率很低,评估为1%。但是需要**注意**,用户应该从可信的来源下载漏洞利用代码，并谨慎使用，以防止被利用或感染其他恶意软件。


**项目地址:** [nhattanhh/CVE-2025-8088](https://github.com/nhattanhh/CVE-2025-8088)

**漏洞详情:** [CVE-2025-8088](https://nvd.nist.gov/vuln/detail/CVE-2025-8088)