## CVE-2025-32463-Sudo-Chroot权限提升

**漏洞编号:** CVE-2025-32463

**漏洞类型:** 本地权限提升

**影响应用:** Sudo

**危害等级:** 高危，本地用户可提升至root权限

**影响版本:** 1.9.14 <= Sudo < 1.9.17p1

**利用条件:** 需要用户具有sudo权限，且允许以chroot方式运行命令

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Sudo的chroot实现中，当使用-R参数指定chroot目录时，会使用用户可控目录下的/etc/nsswitch.conf文件。攻击者可以通过构造恶意的nsswitch.conf文件，加载恶意的动态链接库，从而在chroot环境中执行任意代码，并提升至root权限。

**利用方式：**

1.  **创建恶意C Payload：** PoC代码首先创建一个C语言的payload，该payload包含一个`__attribute__((constructor))`修饰的函数，当该payload被编译成动态链接库并加载时，该函数会自动执行，payload的功能是创建root shell。
2.  **设置Chroot环境：** 创建一个临时目录作为假的chroot环境，并在其中放置一个恶意的`/etc/nsswitch.conf`文件。
3.  **配置恶意nsswitch.conf：**  恶意的nsswitch.conf文件配置系统使用自定义的动态链接库(`libnss_privesc.so.2`)来处理密码查询，这个库实际上是步骤1中编译得到的payload。
4.  **编译Payload：** 将C payload编译为共享对象`libnss_privesc.so.2`。
5.  **利用Sudo提权：** 使用sudo命令并带上`-R`参数进入chroot环境。由于nsswitch.conf被恶意配置，系统会加载恶意的动态链接库，执行其中的payload，从而获得root shell。

**有效性评估：**

提供的PoC代码描述清晰，步骤完整，且漏洞库信息和搜索引擎结果都证实了该漏洞的存在和利用方式。因此，可以认为该PoC代码是有效的。

**投毒风险评估：**

PoC代码创建临时目录，并在其中放置恶意文件，操作完成后会删除临时目录，一定程度上避免了留下痕迹。但是,创建root shell的C代码具有潜在的风险,如后门连接,计划任务等。代码具有一定潜在风险，评估投毒风险为10%。

**项目地址:** [D3ltaFormation/CVE-2025-32463-Sudo-Chroot-Escape](https://github.com/D3ltaFormation/CVE-2025-32463-Sudo-Chroot-Escape)

**漏洞详情:** [CVE-2025-32463](https://nvd.nist.gov/vuln/detail/CVE-2025-32463)