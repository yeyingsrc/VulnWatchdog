## CVE-2025-33073-Windows SMB Client权限提升漏洞

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB Client

**危害等级:** 高危，可能导致域内权限提升和远程代码执行

**影响版本:** 见CVE描述中的受影响版本范围

**利用条件:** 需要攻击者在域内，并且目标主机受到漏洞影响

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-33073 是一个Windows SMB客户端权限提升漏洞。该漏洞允许经过身份验证的攻击者通过SMB协议提升权限。提供的PoC代码利用了dnstool.py来添加恶意DNS记录，然后使用ntlmrelayx进行NTLM中继攻击，最后使用PetitPotam或其他类似方法触发目标机器向攻击者控制的服务器进行身份验证，从而通过NTLM中继获得目标机器的权限。 

**有效性分析：**
PoC代码看起来有效，因为它涵盖了NTLM中继攻击的典型步骤：
1.  添加恶意DNS记录，使目标机器解析特定主机名为攻击者控制的IP地址。
2.  启动ntlmrelayx监听器，等待NTLM身份验证请求。
3.  使用PetitPotam或其他强制身份验证的方法，诱使目标机器向攻击者控制的服务器进行身份验证。
4.  ntlmrelayx中继身份验证到目标服务器，执行任意命令，从而提升权限。

**投毒风险分析：**
代码中存在一定投毒风险，但概率较低（10%）。
*   `dnstool.py` 脚本的安全性需要进一步审查，如果该脚本本身存在漏洞，则可能被用于植入后门或者执行恶意操作。
*   代码使用了`subprocess.run` 和 `subprocess.Popen`，这些函数如果使用不当，可能会受到命令注入攻击。
*   PoC 依赖于 `impacket` 和 `nxc` 这两个第三方库。虽然这两个库本身很常用，但如果攻击者修改了 PoC，加入了从恶意源下载这些库的逻辑，就有可能引入恶意代码。
*   代码中使用了静态DNS记录，这可能会导致攻击行为更容易被检测。

**漏洞利用方式：**
1.  攻击者首先需要位于与目标机器相同的网络中。
2.  攻击者使用提供的PoC代码，指定用户名、密码、攻击者IP、DNS服务器IP、域控制器FQDN以及目标机器IP。
3.  PoC代码使用dnstool.py在DNS服务器上添加一个恶意的DNS记录，将特定的域名解析到攻击者控制的IP地址。
4.  PoC代码启动ntlmrelayx，监听传入的NTLM身份验证请求。
5.  PoC代码使用PetitPotam, Printerbug 或 DFSCoerce 等方法诱使目标机器向攻击者控制的IP地址发起NTLM身份验证。
6.  ntlmrelayx截获NTLM身份验证信息，并将其转发到目标机器。
7.  成功中继NTLM身份验证后，攻击者可以在目标机器上执行任意命令，从而提升权限。

**排序优先级考虑：** 由于没有提供搜索结果，漏洞利用代码的分析比漏洞库信息更具优先级。 代码本身提供更详细的攻击步骤，对风险判断、利用方式分析更有帮助。

**项目地址:** [mverschu/CVE-2025-33073](https://github.com/mverschu/CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)