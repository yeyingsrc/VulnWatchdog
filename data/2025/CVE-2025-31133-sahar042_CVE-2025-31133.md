## CVE-2025-31133 runc maskedPaths 竞态条件漏洞利用

**漏洞编号:** CVE-2025-31133

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致容器逃逸，获取宿主机权限

**影响版本:** 未知，需根据实际runc版本判断

**利用条件:** 需要能够运行runc容器

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该PoC代码利用 CVE-2025-31133 runc 的 maskedPaths 配置不当导致的竞态条件漏洞。攻击者通过在容器内与 runc 进程进行竞态，将 /dev/null 符号链接到宿主机上的 /proc/sys/kernel/core_pattern 文件。 然后，当容器内的进程崩溃时，宿主机将执行 /proc/sys/kernel/core_pattern 中指定命令，从而实现代码执行。

**有效性：**
根据PoC代码中的描述和注释，该PoC尝试执行宿主机代码。因此，如果runc版本存在CVE-2025-31133漏洞，该PoC可能有效。

**投毒风险：**
PoC代码的主要目的是利用漏洞，而非进行恶意投毒。但是，PoC中利用了 `core_pattern` 机制在宿主机上执行代码，虽然PoC本身是创建一个交互式shell，但攻击者可以替换为任意恶意代码。这里的投毒风险主要体现在，使用者如果不理解PoC的原理，直接运行，可能会导致宿主机受到攻击或者被植入后门。

**利用方式：**
1.  **准备环境：** 准备一个存在 CVE-2025-31133 漏洞的 runc 环境。创建一个包含 /bin/busybox 的最小 rootfs。
2.  **创建配置文件：** 创建一个 config.json 文件，该文件定义了容器的配置，包括命名空间、挂载点以及关键的 `maskedPaths` 配置，其中包含了 `/proc/sys/kernel/core_pattern`，这是漏洞利用的关键。
3.  **启动竞态条件：** 运行一个后台脚本，该脚本循环地删除并重新创建指向 `/proc/sys/kernel/core_pattern` 的符号链接 `/dev/null`，从而与 runc 进程竞争。
4.  **启动容器：** 使用 runc 启动容器，并指定 config.json 文件。
5.  **触发漏洞：** 在容器内，向 `/proc/sys/kernel/core_pattern` 写入恶意代码，并故意使容器内的进程崩溃(通过 `kill -ABRT $$`)。这会触发宿主机执行写入的恶意代码，从而实现容器逃逸。

由于PoC本身的功能就是执行宿主机代码，很难完全避免执行恶意操作的可能性。因此，在分析PoC是否存在投毒风险时，主要关注作者是否故意隐藏了其他恶意行为。在此PoC中，未发现明显的额外投毒代码。

投毒风险评估: 由于脚本本身会改变宿主机配置，如果对原理不了解，直接使用，有潜在风险，故存在一定的投毒风险，估算为 10%。

**项目地址:** [sahar042/CVE-2025-31133](https://github.com/sahar042/CVE-2025-31133)

**漏洞详情:** [CVE-2025-31133](https://nvd.nist.gov/vuln/detail/CVE-2025-31133)