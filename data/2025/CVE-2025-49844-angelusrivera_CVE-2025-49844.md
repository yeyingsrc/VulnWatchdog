## CVE-2025-49844 Redis Lua Use-After-Free 远程代码执行

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis服务器开启Lua脚本功能，并且攻击者能够执行Lua脚本（通过 EVAL 或 EVALSHA 命令）。需要较低权限即可利用。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-49844 漏洞是 Redis 在处理 Lua 脚本时出现的 use-after-free 漏洞。具体来说，当 Redis 服务器允许执行 Lua 脚本时，攻击者可以利用精心构造的 Lua 脚本来操纵 Redis 的垃圾回收器，从而触发 use-after-free 漏洞，并最终导致远程代码执行。

**漏洞利用方式：**

1.  **攻击目标：** 针对 Redis 的 Lua 脚本系统，尤其是 `EVAL` 和 `EVALSHA` 命令。
2.  **攻击步骤：**
    *   攻击者首先需要能够连接到 Redis 服务器，并且拥有执行 Lua 脚本的权限。
    *   然后，攻击者发送包含恶意代码的 Lua 脚本到 Redis 服务器。
    *   恶意 Lua 脚本会利用 Redis 的内存管理机制中的缺陷，特别是垃圾回收器。
    *   通过操纵垃圾回收器，攻击者可以释放已被使用的内存，然后再次尝试访问该内存。
    *   这会导致 use-after-free 漏洞，并允许攻击者覆盖内存中的数据，最终执行任意代码。

**POC有效性评估：**

提供的 POC 代码是一个 Redis 漏洞扫描器，用于检查 Redis 服务器是否存在 CVE-2025-49844 漏洞。该代码通过编译 `redis-scanner.go` 文件生成一个名为 `rscan` 的可执行文件，然后可以使用不同的参数来扫描 Redis 服务器。例如，它可以检查单个服务器、使用密码验证的服务器、多个服务器或从文件中读取的主机列表。如果 Redis 服务器版本低于 8.2.2 并且 Lua 脚本已启用，则扫描器会报告服务器存在漏洞。

**投毒风险评估：**

该 POC 代码的主要功能是扫描 Redis 服务器是否存在漏洞，并提供修复建议。但是，存在少量潜在的投毒风险，原因是攻击者可能在扫描器中植入恶意代码，例如：

*   **信息收集：** 扫描器可能会收集 Redis 服务器的相关信息（例如版本、配置等），并将这些信息发送到攻击者的服务器。
*   **后门植入：** 扫描器可能会尝试在 Redis 服务器上植入后门，以便攻击者可以长期控制该服务器。
*   **拒绝服务攻击：** 扫描器可能会发送大量的请求到 Redis 服务器，从而导致拒绝服务攻击。
*   **依赖包污染:** `go mod tidy` 存在依赖包污染的可能性.

尽管存在这些风险，但总体来说，该 POC 代码的投毒风险相对较低，因为它的主要目的是帮助用户检测和修复漏洞。 风险占比10%。

总之，该漏洞的利用方式是利用 Lua 脚本操纵 Redis 的内存管理机制，触发 use-after-free 漏洞，并最终导致远程代码执行。提供的扫描器用于检测是否存在此漏洞，并存在一定的低概率投毒风险。

**项目地址:** [angelusrivera/CVE-2025-49844](https://github.com/angelusrivera/CVE-2025-49844)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)