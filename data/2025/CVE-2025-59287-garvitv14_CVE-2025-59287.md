## CVE-2025-59287 WSUS RCE

**漏洞编号:** CVE-2025-59287

**漏洞类型:** 反序列化漏洞

**影响应用:** Windows Server Update Service (WSUS)

**危害等级:** 高危，可导致远程代码执行

**影响版本:** Windows Server 2012/2012 R2/2016/2019/2022/2025/23H2，受影响版本见漏洞库信息

**利用条件:** 需要能够访问WSUS服务器的网络

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-59287 是一个 Windows Server Update Service (WSUS) 中的远程代码执行漏洞。该漏洞是由于 WSUS 在处理不受信任的数据时，存在反序列化漏洞，未经授权的攻击者可以利用此漏洞通过网络执行任意代码。

**有效性评估：**

提供的漏洞利用代码 `CVE-2025-59287.py` 似乎是有效的，它尝试自动化利用此漏洞。代码具有以下特征：

*   自动下载ysoserial.net：脚本能够自动从GitHub下载`ysoserial.net`，一个.NET反序列化漏洞利用工具，用于生成恶意payload。
*   Payload生成：使用PowerShell反向shell作为payload，并可自定义lhost和lport。
*   加密：使用WSUS服务器使用的AES密钥和IV加密payload。
*   依赖项检测：检查系统中是否存在.NET运行时环境 (Wine/Mono)。

根据这些特征，该PoC大概率是有效的。CISA ADP的vulnrichment信息也标明了该漏洞的Automated为yes，Exploitation为poc，Technical Impact为total，佐证了该PoC的有效性。

**投毒风险评估：**

对提供的Python代码进行分析，投毒风险较低，大约5%。风险分析如下：

*   代码结构：代码结构清晰，主要功能是下载ysoserial.net，生成payload，加密payload，并没有发现任何隐藏的恶意行为，如上传敏感信息、安装后门等。
*   依赖项：代码依赖 ysoserial.net，这是一个知名的漏洞利用工具。虽然使用外部工具存在一定的风险，但ysoserial.net本身并不是恶意软件。
*   网络连接：代码会连接到 GitHub 下载 ysoserial.net。存在GitHub仓库被篡改的风险，导致下载恶意文件。
*   明文密钥：代码包含WSUS的AES密钥和IV。虽然这本身不是投毒，但如果该密钥泄露，可能会被攻击者利用。
*   执行外部命令：代码会执行外部命令（wine、mono、ysoserial.exe），这存在一定的风险，例如命令注入。

总体来说，直接投毒的可能性较低，主要是利用了已知的反序列化漏洞，生成payload。主要的风险点在于所依赖的外部资源(github仓库)以及外部命令执行可能带来的安全问题。所以投毒风险判定为5%。

**利用方式分析：**

1.  **环境准备：** 攻击者需要安装Python 3环境，并安装requests和pycryptodome库(`pip install requests pycryptodomex`)。
2.  **下载 ysoserial.net：** 脚本会自动尝试下载 `ysoserial.net`，如果下载失败，需要手动下载并放到指定目录。
3.  **.NET环境检测:** 脚本会尝试检测.NET运行时环境，如果目标环境没有.NET环境，则需要安装Wine或Mono。
4.  **生成 Payload：** 使用 `ysoserial.net` 生成用于远程代码执行的序列化 payload。利用脚本中的`generate_payload`函数，指定反弹shell的lhost和lport。
5.  **加密 Payload：** 使用 WSUS 的 AES 密钥和 IV 对 payload 进行加密。脚本使用内置的`WSUS_AES_KEY`和`WSUS_IV`进行加密。
6.  **触发反序列化：** 将加密后的 payload 发送到 WSUS 服务器，触发反序列化漏洞。攻击者需要找到WSUS服务器中存在反序列化的接口，并将加密后的payload作为参数传递过去。具体的接口需要根据WSUS服务器的实现来确定（该PoC未包含此步骤，需要自行研究）。
7.  **执行代码：** WSUS 服务器在反序列化 payload 时，会执行其中的恶意代码，从而实现远程代码执行。

**项目地址:** [garvitv14/CVE-2025-59287](https://github.com/garvitv14/CVE-2025-59287)

**漏洞详情:** [CVE-2025-59287](https://nvd.nist.gov/vuln/detail/CVE-2025-59287)