## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE

**影响应用:** Ktor

**危害等级:** 高危，可能导致敏感信息泄露

**影响版本:** < 2.3.5

**利用条件:** 服务器端使用Ktor并且ContentNegotiation配置了XML格式，且使用受影响的版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45612 是一个存在于 JetBrains Ktor 2.3.5 之前的版本中的 XXE (XML 外部实体) 漏洞。当 Ktor 使用 ContentNegotiation 中 XML 格式的默认配置时，未经授权的攻击者可以通过构造恶意的 XML 输入，读取服务器上的本地文件或访问内部网络资源。 

**漏洞利用分析：**

提供的漏洞利用代码包含一个用于复现该漏洞的 Ktor 应用程序。相关文件包括：

*   `README.md`: 包含漏洞描述、参考链接和 PoC 的基本信息。
*   `build.gradle.kts`: Gradle 构建脚本，定义了项目依赖项，包括 Ktor 2.3.4 和 XML 序列化。
*   `gradle.properties`: Gradle 属性文件。
*   `gradlew`: Gradle 包装器脚本，用于构建和运行应用程序。

关键在于 `build.gradle.kts` 文件中指定了 `io.ktor:ktor-serialization-kotlinx-xml:2.3.4` 和 `io.ktor:ktor-server-content-negotiation:2.3.4`，这使得应用程序容易受到攻击。通过发送包含外部实体定义的恶意 XML 请求，攻击者可以利用 XXE 漏洞。

**投毒风险分析：**

尽管提供的代码旨在演示 XXE 漏洞，但仍存在潜在的投毒风险。尽管代码目的不是恶意行为，但也需要防范以下几点：

*   **供应链风险:**  如果直接使用此仓库的代码，需要确保没有其他恶意代码被添加到项目中的依赖项中。
*   **构建过程:**  需要审核 `build.gradle.kts` 文件，确保没有添加任何可疑的任务或插件。

虽然仓库中直接嵌入恶意代码的可能性较低（估计 10%），但仍然需要谨慎处理，建议手动审查所有代码。

**利用方式总结：**

1.  目标系统使用 Ktor 并且启用了 XML 的 ContentNegotiation，版本低于 2.3.5。
2.  攻击者构造包含恶意外部实体定义的 XML 请求。
3.  服务器解析 XML 请求时，会尝试解析外部实体。
4.  如果未正确配置 XML 解析器以禁用外部实体解析，则服务器会读取本地文件或访问内部网络资源，并将内容返回给攻击者。

**项目地址:** [stefan-500/ktor-cve-2023-45612-poc](https://github.com/stefan-500/ktor-cve-2023-45612-poc)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)