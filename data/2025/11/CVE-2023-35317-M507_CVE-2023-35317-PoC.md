## CVE-2023-35317 - Windows Server Update Service (WSUS) 提权漏洞

**漏洞编号:** CVE-2023-35317

**漏洞类型:** 特权提升/反序列化漏洞

**影响应用:** Windows Server Update Service (WSUS)

**危害等级:** 高危，可能导致远程代码执行和系统控制

**影响版本:** Windows Server 2012, 2012 R2, 2016, 2019, 2022 受影响版本

**利用条件:** 需要本地权限，目标WSUS服务器未打补丁

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-35317 是一个 Windows Server Update Service (WSUS) 中的特权提升漏洞。该漏洞源于对不可信数据进行反序列化（CWE-502）。攻击者利用此漏洞提升在目标系统上的权限。 

**漏洞利用方式：**

1.  **身份验证绕过/获取授权Cookie：** PoC代码首先尝试通过 `SimpleAuthWebService` 获取授权cookie。如果无法获取，则尝试从 `ReportingWebService` 获取 ServerId 并使用它来生成一个cookie。
2.  **构造恶意的 SOAP 请求:** PoC代码使用 SOAP 请求与WSUS服务器通信，利用 `BinaryFormatter` 反序列化漏洞。
3.  **发送恶意事件数据:** 攻击者将包含恶意序列化数据的SOAP请求发送到WSUS服务器上的某个端点（具体端点在代码中未完全展示，但根据其他参考链接可以推断）。服务器在反序列化该数据时执行攻击者控制的代码，从而提升权限。
4.  **利用 ysoserial.net 生成payload：** 参考链接提到 ysoserial.net 可以用来生成恶意的 .NET payload，这些 payload 可以被嵌入到序列化数据中，从而实现远程代码执行。

**有效性：**
提供的POC代码看起来是有效的。它实现了与WSUS服务器交互，利用反序列化漏洞执行代码所需步骤。

**投毒风险：**
代码主要功能是利用漏洞，但依然存在投毒风险。PoC代码中使用的外部资源（例如ysoserial.net）可能包含恶意代码。此PoC使用了base64编码，xml，zip等编码方式对代码进行混淆，存在一定的隐藏恶意代码的可能性。总体估计投毒风险在10%左右。

**项目地址:** [M507/CVE-2023-35317-PoC](https://github.com/M507/CVE-2023-35317-PoC)

**漏洞详情:** [CVE-2023-35317](https://nvd.nist.gov/vuln/detail/CVE-2023-35317)