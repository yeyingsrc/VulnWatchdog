## CVE-2023-36845-Juniper-J-Web-PHP外部变量修改导致RCE

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP外部变量修改

**影响应用:** Junos OS J-Web (EX系列和SRX系列)

**危害等级:** 高危，可导致远程代码执行

**影响版本:** 受影响版本请参考漏洞库信息

**利用条件:** 目标设备开启了J-Web管理界面，并且允许通过HTTP或HTTPS访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于Juniper Junos OS的J-Web管理界面中。攻击者可以通过修改`PHPRC`环境变量，控制PHP的配置，进而执行任意代码。

**漏洞利用方式：**

1.  攻击者发送一个特制的HTTP POST请求到目标J-Web服务器。
2.  该请求包含一个`PHPRC`参数，该参数被设置为指向一个恶意PHP配置文件或包含恶意代码的文件，例如`/dev/fd/0`，并结合`auto_prepend_file`包含`/etc/passwd`。
3.  由于`PHPRC`环境变量被修改，PHP在处理后续请求时会加载攻击者提供的恶意配置。
4.  通过`auto_prepend_file`，强制包含`/etc/passwd`文件内容,以验证漏洞存在。
5. 最终导致攻击者可以远程执行任意代码。

**有效性：**

提供的PoC代码是有效的，它通过`curl`命令发送带有恶意`PHPRC`参数的请求来验证漏洞。如果目标存在漏洞，将会返回`/etc/passwd`的内容，`grep -i 'root:'` 用于检测`/etc/passwd`是否存在，从而判断目标是否漏洞。

**投毒风险：**

分析提供的PoC代码，未发现明显的投毒代码。PoC代码的功能是发送恶意请求并验证漏洞是否存在，并没有执行任何恶意操作（例如植入后门），风险等级判定为0%。


**项目地址:** [simrotion13/CVE-2023-36845](https://github.com/simrotion13/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)