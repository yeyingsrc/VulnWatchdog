## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE

**影响应用:** Ktor

**危害等级:** 高危，可能导致信息泄露

**影响版本:** < 2.3.5

**利用条件:** 需要Ktor应用使用ContentNegotiation且配置XML格式

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-45612是JetBrains Ktor 2.3.5之前版本中存在的一个XML外部实体注入（XXE）漏洞。该漏洞存在于ContentNegotiation中XML格式的默认配置中。攻击者可以通过发送包含恶意XML payload的请求，读取服务器上的敏感文件。 

**有效性评估:**
提供的PoC代码包含Dockerfile，docker-compose.yaml，以及server和client目录，基本可以判断 PoC 的有效性较高。docker-compose.yaml 编排了 server 和 client 两个服务，server 服务构建一个存在漏洞的 Ktor 应用，client 服务则用于执行 XXE 攻击。Dockerfile 里创建了 /lfi_poc.txt 文件，用于验证 LFI 是否成功，同时安装了 `nc` 工具，用于 healthcheck。PoC 的 README.md 描述了复现步骤。

**投毒风险分析:**
虽然PoC的主要功能是演示XXE漏洞，但仍存在一定投毒风险。例如，`client` 或 `server` 的 `Dockerfile` 可能包含恶意指令，例如在构建过程中下载并执行恶意脚本。此外，`client` 脚本本身也可能尝试执行除LFI之外的恶意操作。该风险评估较低，约为10%，因为主要目的是复现漏洞，但不能完全排除。

**漏洞利用方式:**
1.  目标Ktor应用使用ContentNegotiation并且配置XML格式。
2.  攻击者构造包含恶意XML实体的请求，其中XML实体指向服务器本地文件。
3.  Ktor应用解析XML时，会尝试解析外部实体，从而导致服务器读取并返回攻击者指定的文件内容。
4.  通过docker-compose可以快速搭建漏洞环境，便于漏洞复现与验证

**项目地址:** [ksaweryr/CVE-2023-45612-PoC](https://github.com/ksaweryr/CVE-2023-45612-PoC)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)