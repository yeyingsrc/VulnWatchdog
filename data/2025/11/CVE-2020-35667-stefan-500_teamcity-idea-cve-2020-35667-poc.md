## CVE-2020-35667 - TeamCity IntelliJ IDEA Plugin SSRF 漏洞

**漏洞编号:** CVE-2020-35667

**漏洞类型:** SSRF

**影响应用:** JetBrains TeamCity Plugin for IntelliJ IDEA

**危害等级:** 高危，可能导致用户凭据泄露

**影响版本:** 2020.2.85695 之前版本

**利用条件:** 需要安装旧版本的TeamCity IntelliJ插件，并能够修改IntelliJ插件配置，使其指向攻击者控制的URL

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-35667 是一个存在于 JetBrains TeamCity IntelliJ IDEA 插件中的 SSRF 漏洞。该漏洞允许攻击者通过控制插件所连接的 TeamCity 服务器 URL，欺骗插件连接到恶意的服务器。利用方式如下：

1.  **安装旧版本插件：** 用户需要安装受影响的 TeamCity IntelliJ IDEA 插件（2020.2.85695之前）。
2.  **设置恶意服务器URL：** 在 IntelliJ IDEA 中，修改 TeamCity 插件的服务器 URL 设置，将其指向攻击者控制的服务器。
3.  **伪造XML-RPC端点：** 攻击者搭建一个伪造的 XML-RPC TeamCity 端点，并监听 8888 端口。该端点模拟 TeamCity 服务器返回 RSA 公钥。
4.  **窃取凭据：** 当用户尝试通过插件登录时，插件会从攻击者的服务器获取 RSA 公钥，使用该公钥加密用户密码，并将加密后的密码发送给攻击者的服务器。由于攻击者拥有私钥，可以解密密码，从而窃取用户的明文凭据。

**有效性：** 提供的POC代码能够重现该漏洞，并成功窃取用户凭据。

**投毒风险：** 代码本身主要是为了演示漏洞，但是也存在潜在的投毒风险。攻击者可能在POC代码中加入恶意代码，例如植入后门、窃取用户敏感信息等。可能性评估为 10%，因为已经是一个相对简单的漏洞复现，不太可能加入复杂的后门代码。需要注意的是 `poc_server.py` 文件以及 `requirements.txt`文件是否存在额外的恶意库。

**项目地址:** [stefan-500/teamcity-idea-cve-2020-35667-poc](https://github.com/stefan-500/teamcity-idea-cve-2020-35667-poc)

**漏洞详情:** [CVE-2020-35667](https://nvd.nist.gov/vuln/detail/CVE-2020-35667)