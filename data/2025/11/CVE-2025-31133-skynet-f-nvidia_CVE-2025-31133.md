## CVE-2025-31133-runc-容器逃逸

**漏洞编号:** CVE-2025-31133

**漏洞类型:** 容器逃逸

**影响应用:** runc

**危害等级:** 高危，可能导致主机信息泄露，主机拒绝服务，容器逃逸或绕过maskedPaths。

**影响版本:** < 1.2.8, >= 1.3.0-rc.1, < 1.3.3, >= 1.4.0-rc.1, <= 1.4.0-rc.3

**利用条件:** 需要低权限用户权限和用户交互，容器使用脆弱的runc版本，以及特定的容器配置（例如，没有将/dev bind-mount到容器的/dev/null）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-31133 漏洞是 runc 中的一个容器逃逸漏洞，起因是 runc 在使用容器的 /dev/null 来 mask 路径时，没有充分验证 bind-mount 的源（即容器的 /dev/null）是否真的是一个真实的 /dev/null inode。这导致了两种攻击方式：

1.  **任意挂载 gadget：** 导致主机信息泄露、主机拒绝服务、容器逃逸。
2.  **绕过 maskedPaths：**

**漏洞利用方式：**

该漏洞利用的根本原因是竞争条件，攻击者尝试在 runc 执行 mount 操作时，将容器内的 `/dev/null` 替换为一个指向主机文件系统上敏感文件的符号链接。由于 runc 没有正确验证 `/dev/null` 是否为设备节点，攻击者可以利用这一漏洞挂载任意文件到容器中，从而实现容器逃逸。

POC 代码通过以下步骤利用该漏洞：

1.  **创建容器 rootfs：** 创建一个包含基本目录结构（proc、dev、sys、bin、tmp）的 rootfs。
2.  **创建 config.json：** 创建一个包含容器配置信息的 config.json 文件，其中 `maskedPaths` 包含 `/proc/sys/kernel/core_pattern`。注意，这个配置文件里没有将/dev进行bind mount， 允许对rootfs/dev/null进行race。
3.  **symlink 竞争：** 在 runc 运行容器之前和期间，启动一个 symlink 竞争。该竞争的目的是在 runc 尝试使用 `/dev/null` 进行 bind-mount 时，将其替换为一个指向主机文件系统上 `/proc/sys/kernel/core_pattern` 的符号链接。通过快速删除并重新创建 `/dev/null` (先是设备节点，然后是符号链接，再然后是设备节点), 争取竞争窗口。
4.  **启动容器：** 使用 runc 启动容器。
5.  **验证：** 如果竞争成功，容器内的 `/proc/sys/kernel/core_pattern` 将会被修改为 "pwned"，表明漏洞利用成功。

**有效性：**

提供的 POC 代码是有效的，可以用来验证 CVE-2025-31133 漏洞的存在。它通过修改主机上的 `core_pattern` 文件来证明容器逃逸。

**投毒风险：**

POC 代码的主要功能是演示漏洞，风险较低。它没有直接执行恶意代码，只是修改了 `core_pattern`。风险在于，如果该 POC 被修改并包含恶意代码，例如在竞争成功后执行任意命令，则可能导致更严重的后果。从当前的代码来看，其主要操作是修改 `core_pattern`，因此投毒的概率相对较低。虽然代码尝试清理环境，但如果清理失败，可能会留下一些残余文件。整体分析投毒风险较低，大约为10%。主要担心有人修改这个POC增加恶意代码。

**项目地址:** [skynet-f-nvidia/CVE-2025-31133](https://github.com/skynet-f-nvidia/CVE-2025-31133)

**漏洞详情:** [CVE-2025-31133](https://nvd.nist.gov/vuln/detail/CVE-2025-31133)