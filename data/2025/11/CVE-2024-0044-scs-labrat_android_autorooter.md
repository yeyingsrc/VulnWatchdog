## CVE-2024-0044 - Android PackageInstallerService 特权提升

**漏洞编号:** CVE-2024-0044

**漏洞类型:** 特权提升

**影响应用:** Android PackageInstallerService

**危害等级:** 高危，可能导致本地提权

**影响版本:** Android 12, 12L, 13, 14, 15

**利用条件:** 本地访问，需要用户安装包含恶意 payload 的应用

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0044 存在于 Android 的 PackageInstallerService 中，由于不正确的输入验证，允许攻击者以任何应用的身份运行代码。这导致本地提权，无需额外权限，且无需用户交互。

**利用方式：**
1.  攻击者需要创建一个包含恶意 payload 的 APK 文件。Payload 的目的是利用 `PackageInstallerService` 的 `createSessionInternal` 函数中的漏洞。
2.  该 payload 包含一个精心构造的字符串，其中包含目标应用程序的 UID。攻击者通过 `pm list packages -U` 命令获取目标应用的 UID。
3.  `exploit.sh`脚本尝试使用`pm install`命令，-i参数传入构造的payload,以目标应用UID安装任何应用，实现模拟运行。
4.  由于该漏洞不需要额外的执行权限，攻击者只需要诱导用户安装这个恶意 APK 就可以实现提权。

**有效性：**
根据提供的漏洞信息和利用代码，可以判断 POC 代码大致有效，因为它试图利用 CVE-2024-0044。

**投毒风险：**
该仓库存在一定的投毒风险，风险值约为 10%。体现在以下几个方面：
* `commands.rc` 和 `execute_script.rc` 中的 IP 地址和路径需要用户手动修改，如果用户不小心使用了攻击者的地址，可能会被反向利用。
* `exploit.sh` 脚本中的 `victim_package` 需要用户指定，如果用户不了解 Android 应用的包名，可能会导致利用失败，甚至可能意外地影响其他应用。
* `exploit.sh`  脚本的用途看起来是提权，但脚本中使用了wget下载shell脚本等行为，存在一定的风险，如果攻击者在shell脚本中写入恶意代码，可能导致更严重的后果。
总的来说，这个仓库更像是一个漏洞利用的思路记录和初步尝试，还没有形成完全自动化和稳定的利用工具，需要用户进行一定的配置和修改，因此存在一定的投毒风险。

**搜索引擎结果**
由于没有给出搜索引擎结果，无法评估其对有效性和投毒风险的影响。若搜到更多可靠的分析报告，可用于判断poc的有效性。若搜到更多exp，则投毒风险降低，因为会有更多的参考实现。

**项目地址:** [scs-labrat/android_autorooter](https://github.com/scs-labrat/android_autorooter)

**漏洞详情:** [CVE-2024-0044](https://nvd.nist.gov/vuln/detail/CVE-2024-0044)