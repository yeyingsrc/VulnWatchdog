## CVE-2024-0044

**漏洞编号:** CVE-2024-0044

**漏洞类型:** 权限提升

**影响应用:** Android

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** Android 12, 12L, 13, 14

**利用条件:** 设备已连接ADB调试，目标应用已安装

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-0044 允许攻击者在Android 12, 12L, 13, 14 上利用 `PackageInstallerService.java` 中 `createSessionInternal` 函数的输入验证漏洞进行权限提升。该漏洞允许攻击者以任意应用的身份运行代码，从而可能读取或篡改其他应用的数据。从漏洞库信息来看，此漏洞无需用户交互即可利用。

**有效性:** 提供的POC代码尝试通过 `pm install` 命令，使用精心构造的 `payload`，欺骗系统以目标应用的UID安装APK。成功后，它会使用 `run-as` 命令以目标应用的身份创建该应用数据的tar归档文件，实现数据备份。
根据参考链接 (https://rtx.meta.security/exploitation/2024/03/04/Android-run-as-forgery.html 和 https://tinyhack.com/2024/06/07/extracting-whatsapp-database-or-any-app-data-from-android-12-13-using-cve-2024-0044/?s=03)，此POC代码是有效的，能够在受影响的Android版本上利用该漏洞导出应用数据。

**投毒风险:**  分析提供的POC代码，`/tmp/02f18dcd96cb8983cdb54c3b8b185bd9/CVE-2024-0044-EXP.sh` 脚本的主要功能是：

1.  获取目标应用的UID和APK路径。
2.  构造包含目标UID的`payload`，用于`pm install` 命令。
3.  使用`pm install`安装APK。
4.  使用`run-as`和`tar`命令创建目标应用数据的tar归档文件。

代码中没有发现明显的恶意行为，例如上传数据、执行未授权操作等。代码逻辑主要集中在利用漏洞提取数据，而非植入恶意代码或后门。因此，投毒风险较低，可以认为投毒风险为0%。

**利用方式:**

1.  攻击者需要拥有ADB调试权限的设备。
2.  攻击者需要知道目标应用的包名。
3.  运行POC脚本，提供目标应用的包名作为参数。
4.  脚本将自动获取目标应用的UID和APK路径，构造payload，并尝试使用`pm install`命令安装APK。
5.  如果安装成功，脚本将使用`run-as`和`tar`命令创建目标应用数据的tar归档文件。
6.  攻击者可以从设备中提取该tar归档文件，并解压以访问应用数据。

**项目地址:** [Kai2er/CVE-2024-0044-EXP](https://github.com/Kai2er/CVE-2024-0044-EXP)

**漏洞详情:** [CVE-2024-0044](https://nvd.nist.gov/vuln/detail/CVE-2024-0044)