## CVE-2022-40684 Fortinet Authentication Bypass

**漏洞编号:** CVE-2022-40684

**漏洞类型:** Authentication Bypass

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 高危，允许未经身份验证的攻击者在管理界面上执行操作

**影响版本:** FortiOS 7.2.0 - 7.2.1, 7.0.0 - 7.0.6; FortiProxy 7.2.0, 7.0.0 - 7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标系统运行受影响的 Fortinet 产品版本，且暴露管理界面于网络。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684 是 Fortinet FortiOS, FortiProxy, 和 FortiSwitchManager 中的一个身份验证绕过漏洞。未经身份验证的攻击者可以通过构造特制的 HTTP 或 HTTPS 请求，在管理界面上执行操作。

**漏洞利用有效性分析：**
提供的 POC 代码 (Go 语言) 通过向目标设备的 `api/v2/cmdb/system/admin/{username}` 端点发送 PUT 请求，尝试为指定用户添加 SSH 公钥。POC 代码会读取指定的 SSH 公钥文件，并将其作为 `ssh-public-key1` 字段的值包含在 JSON 数据中。 通过设置 `Forwarded` 请求头来绕过身份验证检查。如果成功，攻击者可以使用新添加的 SSH 密钥登录到设备。

根据漏洞描述和 POC 代码，该漏洞利用的有效性较高。漏洞库信息明确指出存在利用代码成熟度为 FUNCTIONAL (E:F)。

**投毒风险分析：**
查看提供的 POC 代码，未发现明显的恶意代码或后门。该代码的主要功能是读取 SSH 公钥并发送到目标设备，逻辑相对简单直接。所有的操作都在代码中明确可见。因此，投毒风险较低，可能性为 0%。

**利用方式总结：**
1.  攻击者准备一个 SSH 公钥文件。
2.  攻击者运行 POC 代码，指定目标 Fortinet 设备的 URL、要添加 SSH 公钥的用户名，以及 SSH 公钥文件的路径。
3.  POC 代码构造包含 SSH 公钥的 PUT 请求，并设置 `Forwarded` 请求头，绕过身份验证。
4.  如果请求成功，攻击者可以使用新添加的 SSH 公钥通过 SSH 登录到 Fortinet 设备。

总而言之，此漏洞危害严重，并且存在可用的功能性POC代码，应尽快修复。

**项目地址:** [ClickCyber/cve-2022-40684](https://github.com/ClickCyber/cve-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)