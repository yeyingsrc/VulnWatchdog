## CVE-2024-0044: Android PackageInstallerService 提权漏洞

**漏洞编号:** CVE-2024-0044

**漏洞类型:** 权限提升

**影响应用:** Android

**危害等级:** 高危，本地权限提升，可能导致任意代码执行

**影响版本:** Android 12, 12L, 13, 14, 15

**利用条件:** 本地访问，无需特殊权限，用户安装应用

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

根据漏洞库信息，CVE-2024-0044 漏洞存在于 Android 的 PackageInstallerService.java 中，由于不正确的输入验证，可能允许攻击者以任何应用程序的身份运行代码，导致本地权限提升。利用此漏洞不需要额外的执行权限，并且不需要用户交互。

**漏洞利用分析：**

根据提供的Python漏洞利用代码，该POC脚本的目的是利用CVE-2024-0044漏洞在目标Android设备上安装APK，并尝试以目标应用 UID 运行。脚本首先检查APK文件是否存在，然后将其推送到`/data/local/tmp/`目录。 接下来，该脚本会尝试使用`pm list packages -U`命令获取目标应用的UID。然后，该脚本生成一个payload（但代码不完整，缺失了生成payload的后半部分），并将该payload与`cmd package install-create`一起使用以安装APK。

**有效性评估：**
提供的代码片段是不完整的，关键的 payload 生成部分缺失，导致无法直接利用。根据 github 上 meta-redteam 发布的exp，可知该漏洞利用的关键在于构造恶意的 `PackageInstaller.SessionParams`，通过设置 `setSessionParams` 的 `installSourceInfo.mRequestingPackageUid` 为其他应用的uid，达到以该应用身份安装应用的目的。

**投毒风险评估：**

该脚本的投毒风险较低。虽然代码不完整，但主要操作是文件推送、命令执行。风险点在于：

*   **依赖外部APK：** 攻击者可以通过提供恶意APK来感染目标系统，但这不是POC本身的问题，而是APK本身的安全问题。

因此，判定投毒风险为1%。 尽管如此，使用任何第三方漏洞利用代码时，都应谨慎审查，以避免潜在的恶意行为。

**利用方式总结：**

1.  准备好需要安装的恶意 APK 文件。
2.  执行该 Python 脚本，输入目标应用的包名以及 APK 文件的路径。
3.  脚本会将 APK 文件推送到设备，获取目标应用的 UID。
4.  脚本构建特殊的 `PackageInstaller.SessionParams`，将待安装应用伪装成目标应用进行安装，从而以目标应用的权限运行。

**优先级排序:**
实际利用优先级应该以github上可用的POC为最高优先级，能够直接验证漏洞真实性。搜索引擎可以快速检索到相关的技术分析文章，例如meta-redteam发布的文章。漏洞库信息则提供了漏洞的基本信息，为漏洞分析提供了方向。

**项目地址:** [007CRIPTOGRAFIA/c-CVE-2024-0044](https://github.com/007CRIPTOGRAFIA/c-CVE-2024-0044)

**漏洞详情:** [CVE-2024-0044](https://nvd.nist.gov/vuln/detail/CVE-2024-0044)