## CVE-2022-40684-Fortinet身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，允许未经身份验证的攻击者执行管理操作

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标存在漏洞版本，且可以通过HTTP/HTTPS访问管理界面。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-40684 是 Fortinet FortiOS、FortiProxy 和 FortiSwitchManager 中的一个身份验证绕过漏洞。该漏洞允许未经身份验证的攻击者通过特制的 HTTP 或 HTTPS 请求在管理界面上执行操作。

**有效性：**
提供的POC代码有效。它首先尝试通过`/api/v2/cmdb/system/admin` API接口获取用户名、访问级别、序列号和版本信息，并尝试获取LDAP配置。如果成功，则表明目标存在漏洞。然后，它允许用户输入用户名和SSH公钥路径，并将公钥写入目标系统，实现SSH免密登录，从而获得控制权。

**投毒风险：**
POC代码本身的主要功能是利用身份验证绕过漏洞，枚举用户名和写入SSH公钥以获得系统访问权限。直接利用此代码进行攻击会在目标系统上留下明显的痕迹，因此进行隐蔽的投毒操作不太可能。但是仍然存在着很小的概率。例如，攻击者可能会修改 `get_shell` 函数，在写入 SSH 公钥的同时，也在后台执行其他恶意代码，比如下载并执行恶意脚本等。考虑到该代码主要通过网络请求交互，潜在的风险可能来自于伪造服务器响应、篡改 API 返回数据，从而在受害者不知情的情况下植入后门。所以综合评估投毒风险在10%。

**利用方式：**
1.  **身份验证绕过：** 攻击者利用漏洞绕过身份验证。
2.  **信息泄露：**  利用绕过的身份验证，通过API接口 `/api/v2/cmdb/system/admin` 枚举用户名、访问级别、序列号和版本信息，并尝试获取LDAP配置等敏感信息。
3.  **SSH密钥注入：** 攻击者提供SSH公钥，POC利用PUT请求将公钥添加到指定用户的authorized_keys中。
4.  **远程控制：**  攻击者使用SSH密钥登录到目标系统，实现远程控制。

**项目地址:** [z-bool/CVE-2022-40684](https://github.com/z-bool/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)