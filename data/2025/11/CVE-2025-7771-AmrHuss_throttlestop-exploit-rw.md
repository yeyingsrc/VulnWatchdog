## CVE-2025-7771-ThrottleStop.sys-权限提升

**漏洞编号:** CVE-2025-7771

**漏洞类型:** 权限提升

**影响应用:** ThrottleStop

**危害等级:** 高危，允许本地用户以内核权限执行任意代码

**影响版本:** 3.0.0.0 and possibly others

**利用条件:** 需要已安装易受攻击版本的ThrottleStop.sys驱动，且用户具有执行用户模式应用程序的权限。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-7771 存在于 TechPowerUp 的 ThrottleStop.sys 驱动中。该驱动暴露了两个 IOCTL 接口，允许通过 MmMapIoSpace 函数对物理内存进行任意读写访问。由于没有充分的访问控制，恶意用户模式应用程序可以利用此漏洞来修补正在运行的 Windows 内核，并以 ring-0 权限调用任意内核函数。这使本地攻击者能够在内核上下文中执行任意代码，从而导致权限提升和潜在的后续攻击，例如禁用安全软件或绕过内核级保护。

**有效性：**
提供的 POC 代码利用了 CVE-2025-7771 漏洞。它首先初始化一个驱动程序接口，然后尝试找到目标进程（notepad.exe）。更重要的是，它使用 superfetch 技术将虚拟地址转换为物理地址，然后使用驱动程序提供的 IOCTL 接口读取和写入物理内存。代码验证了读写操作，展示了漏洞的可利用性。因此，该POC代码是有效的。

**投毒风险：**
该存储库中的代码主要用于演示漏洞利用，可能存在轻微的投毒风险。例如，readme.md文件中可能存在引导用户下载恶意版本 ThrottleStop 的链接，虽然提供的漏洞利用代码本身并没有明显的恶意行为，但无法完全排除作者在其他地方（例如，依赖项或构建脚本）隐藏恶意代码的可能性。考虑到漏洞利用代码的复杂性和潜在的内核级影响，需要谨慎评估和审查每一行代码。对潜在投毒行为的评估为5%，原因在于代码逻辑相对清晰，主要功能是利用已知漏洞，但始终存在通过依赖项或构建过程引入恶意行为的可能性。如果存在构建脚本或者依赖未知的库，则应该提升中毒概率。

**利用方式：**
1.  **查找易受攻击的驱动：** 攻击者需要找到并访问已安装的易受攻击的 ThrottleStop.sys 驱动程序。
2.  **获取驱动程序句柄：** 攻击者需要通过 `CreateFile` API 打开设备 `\\.\ThrottleStop` 的句柄。
3.  **绕过地址空间布局随机化 (ASLR)：** 利用 Superfetch 等技术将内核虚拟地址转换为物理地址。这对于找到要修改的内核数据至关重要。
4.  **构造 IOCTL 请求：** 攻击者构造一个 `DeviceIoControl` 请求，其中包含要读取或写入的物理地址和数据。
5.  **执行任意内核代码：** 通过修改内核中的关键数据结构（例如，系统服务表或内核对象），攻击者可以获得内核代码执行能力。
6.  **权限提升：** 通过在内核模式下执行代码，攻击者可以完全控制系统，并可以执行通常需要管理权限的操作。

总而言之，此漏洞允许未经授权的用户通过利用易受攻击的驱动程序对物理内存进行任意读写操作，从而提升权限并在内核模式下执行任意代码。

**项目地址:** [AmrHuss/throttlestop-exploit-rw](https://github.com/AmrHuss/throttlestop-exploit-rw)

**漏洞详情:** [CVE-2025-7771](https://nvd.nist.gov/vuln/detail/CVE-2025-7771)