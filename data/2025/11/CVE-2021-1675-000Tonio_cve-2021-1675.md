## CVE-2021-1675 (PrintNightmare)

**漏洞编号:** CVE-2021-1675

**漏洞类型:** 远程代码执行

**影响应用:** Windows Print Spooler

**危害等级:** 高危，可导致系统被完全控制

**影响版本:** 受影响的Windows版本请参考漏洞库信息

**利用条件:** 需要目标系统开启Print Spooler服务，攻击者需要有权限连接到打印服务（通常是网络可达）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-1675 (PrintNightmare) 漏洞存在于 Windows Print Spooler 服务中，允许攻击者通过向服务添加恶意打印驱动程序来执行任意代码。提供的 PowerShell 脚本 `Invoke-Nightmare.ps1` 是一个本地利用此漏洞的 PoC (Proof of Concept)。

**有效性：**
根据漏洞库信息和脚本内容，此PoC代码旨在利用 CVE-2021-1675 本地提权。它通过添加恶意的打印驱动程序来实现，从而以 `NT AUTHORITY\SYSTEM` 权限执行代码。因此，该POC在未修复漏洞的系统上是有效的。

**投毒风险：**
PoC本身有较小的投毒风险，大约 10%。原因如下：
*   PoC 允许指定要加载的自定义 DLL (`-DLL` 参数)，这意味着用户可以执行任意代码。攻击者可能会将恶意代码嵌入DLL中，并共享此脚本，诱导他人使用该恶意DLL进行攻击。
*   脚本内置一个默认DLL，目的是创建一个新的本地管理员用户。虽然这个功能本身不是恶意投毒，但如果攻击者修改了脚本，使其内置的DLL执行更具破坏性的操作，然后发布修改后的脚本，就构成投毒。

**利用方式：**
1.  攻击者运行 `Invoke-Nightmare.ps1` 脚本，可以选择使用默认设置（添加名为 `adm1n` 的新管理员用户，密码为 `P@ssw0rd`）或自定义用户名、密码和驱动程序名称。
2.  如果提供了 `-DLL` 参数，脚本会加载并执行指定的 DLL 文件。否则，脚本会将内置的 payload (用于创建新管理员用户的 DLL) 写入到临时目录中，并加载执行。
3.  脚本利用 `AddPrinterDriverEx` 函数添加恶意打印驱动程序。 由于存在漏洞，Print Spooler 服务会以 `NT AUTHORITY\SYSTEM` 权限加载并执行恶意驱动程序。
4.  恶意驱动程序（DLL）执行攻击者指定的代码，例如创建新的管理员用户或执行任意命令。

**优先级排序依据：**
 漏洞利用代码 > 漏洞库信息 > 搜索引擎结果（因为没有有用的搜索引擎结果）

**项目地址:** [000Tonio/cve-2021-1675](https://github.com/000Tonio/cve-2021-1675)

**漏洞详情:** [CVE-2021-1675](https://nvd.nist.gov/vuln/detail/CVE-2021-1675)