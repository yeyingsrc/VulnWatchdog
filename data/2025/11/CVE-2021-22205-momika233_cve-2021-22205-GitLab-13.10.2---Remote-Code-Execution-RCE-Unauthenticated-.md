## CVE-2021-22205-GitLab-RCE

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程代码执行

**影响应用:** GitLab

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 可从网络访问存在漏洞的GitLab实例，且实例版本在受影响范围内

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22205 漏洞是 GitLab CE/EE 版本中存在的一个未经身份验证的远程代码执行漏洞。漏洞原因是 GitLab 未能正确验证传递给文件解析器的图像文件。攻击者可以上传特制的图像文件（例如，DjVu文件）利用 ExifTool 中的命令注入漏洞执行任意命令。

**有效性：**
提供的PoC代码看起来有效。它包含两个主要步骤：
1.  **生成Payload：**  PoC 首先生成一个名为 lol.jpg 的 DjVu 图像，该图像包含一个反向 shell 的 Payload。该Payload使用 `base64` 编码并拼接shell命令到文件末尾. Payload建立与 `10.0.0.3` 端口 `1270` 的反向连接，并在目标系统上执行命令。
2.  **发送Payload：**  PoC 使用 `curl` 命令将生成的 lol.jpg 文件上传到 GitLab 实例。`-F 'file=@lol.jpg'` 参数将文件作为 POST 请求的一部分发送。`http://10.0.0.7/$(openssl rand -hex 8)` 表示攻击者可以通过任意 endpoint 触发该漏洞。

**投毒风险：**
通过分析PoC代码，没有发现明显的投毒迹象。该代码旨在生成并上传一个包含反向 shell 的图像文件。所有操作都是为了利用漏洞，并没有添加任何与漏洞利用无关的恶意代码。因此，投毒风险评估为 0%。

**利用方式：**
利用方式如下：
1.  攻击者构造恶意的DjVu图像，该图像嵌入了命令注入Payload。
2.  攻击者通过上传功能，将构造的图像上传到存在漏洞的GitLab实例。由于未进行充分的验证，上传过程不会阻止恶意图像。
3.  GitLab在处理图像时，调用ExifTool等图像处理工具。
4.  ExifTool解析恶意图像，执行其中嵌入的恶意命令，从而导致远程代码执行。
5.  攻击者通过反向shell获取对GitLab服务器的访问权限，从而实现对系统的控制。

**项目地址:** [momika233/cve-2021-22205-GitLab-13.10.2---Remote-Code-Execution-RCE-Unauthenticated-](https://github.com/momika233/cve-2021-22205-GitLab-13.10.2---Remote-Code-Execution-RCE-Unauthenticated-)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)