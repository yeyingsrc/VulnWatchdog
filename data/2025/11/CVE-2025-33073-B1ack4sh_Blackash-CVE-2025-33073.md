## CVE-2025-33073 - Windows SMB Client Elevation of Privilege

**漏洞编号:** CVE-2025-33073

**漏洞类型:** 权限提升

**影响应用:** Windows SMB Client

**危害等级:** 高危，允许未经授权的攻击者提升网络上的权限

**影响版本:** 受影响的Windows版本见漏洞库信息

**利用条件:** 需要域环境，目标系统在受影响的版本范围内，攻击者位于可访问域控和目标机器的网络中。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞允许经过身份验证的攻击者通过SMB客户端提升权限。利用方式如下：

1.  **利用 `dnstool.py` 添加恶意DNS记录:**  攻击者首先使用提供的`dnstool.py`脚本在域控制器上添加一个恶意的DNS记录，将一个特定的主机名（`STATIC_DNS_RECORD`）解析到攻击者的IP地址。这通常需要有效的域用户凭据。
2.  **等待DNS记录传播:** 脚本会等待新添加的DNS记录在DNS服务器上生效，确保目标系统能够解析到攻击者的IP。
3.  **启动 `ntlmrelayx` 监听器:** 使用 `impacket` 工具集中的 `ntlmrelayx` 启动一个NTLM中继服务器。这个服务器会监听来自目标系统的NTLM认证请求，并将其转发到另一个目标（`--target`），通常是域控制器本身，以获取权限。
4.  **触发NTLM认证请求:**  使用 `nxc` (crackmapexec的修改版本)  配合 `coerce_plus` 模块，通过诸如`PetitPotam`、`Printerbug`或`DFSCoerce`之类的方法强制目标服务器向攻击者控制的IP地址进行NTLM认证。这些方法通常利用Windows服务的特性来触发认证。
5.  **NTLM中继和权限提升:** `ntlmrelayx` 将收到的NTLM认证请求中继到域控制器，如果relay成功，攻击者可以模拟目标机器的身份，从而执行操作，例如添加用户、修改组策略或者执行任意命令。根据`--custom-command`参数，可以指定要执行的命令，默认情况下可能执行`secretsdump.py`来转储域凭据。

**有效性评估:**  提供的POC代码看起来是有效的，它结合了多个已知的攻击技术（DNS欺骗、NTLM中继、强制认证）来实现权限提升。  成功利用该漏洞取决于多个因素，包括目标系统的配置、网络环境以及所使用的强制认证方法的有效性。

**投毒风险评估:** 通过对POC代码的分析，没有发现明显的恶意或投毒代码。所有操作都是为了实现合法的攻击流程，没有隐藏的后门或破坏性行为。因此，投毒风险评估为0%。

**项目地址:** [B1ack4sh/Blackash-CVE-2025-33073](https://github.com/B1ack4sh/Blackash-CVE-2025-33073)

**漏洞详情:** [CVE-2025-33073](https://nvd.nist.gov/vuln/detail/CVE-2025-33073)