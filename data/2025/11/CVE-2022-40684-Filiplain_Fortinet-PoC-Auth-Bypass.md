## CVE-2022-40684-Fortinet认证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 认证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 高危，可能允许未授权访问管理界面，执行任意操作

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 需要网络访问目标设备的管理界面，端口通常为HTTPS（443）或自定义端口。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684 存在于 Fortinet FortiOS、FortiProxy 和 FortiSwitchManager 中，是一个认证绕过漏洞。未认证的攻击者可以通过构造特殊的 HTTP 或 HTTPS 请求，绕过身份验证，在管理界面执行操作。

**漏洞利用分析：**

提供的 PoC 代码 (`poc.sh`) 尝试利用该漏洞。

1.  **请求构造：** PoC 脚本使用 `curl` 命令发送带有特定 header 的 HTTP GET 请求到目标设备。
2.  **关键 Header：** 关键的 HTTP header 包括 `Host`、`User-Agent`、`Accept-Encoding`、`Forwarded` 和 `X-Forwarded-Vdom`。
    *   `Forwarded` header 用于伪造客户端 IP 地址。
    *   `X-Forwarded-Vdom: root` 用于指定 VDOM (Virtual Domain)。设置为 `root` 可能会绕过某些身份验证检查。
3.  **目标 URL：** 请求的目标 URL 为 `/api/v2/cmdb/system/admin`，用于获取系统管理员信息。
4.  **验证：** 脚本检查返回的数据中是否包含 `results` 字符串，以判断目标是否受到漏洞影响。

**有效性评估：**

根据漏洞信息和 PoC 代码，此 PoC 具有一定的有效性。CISA 已将此漏洞添加到已知被利用漏洞目录中，表明该漏洞已被广泛利用。

**投毒风险分析：**

查看 `poc.sh` 脚本：

*   脚本逻辑相对简单，主要就是发送一个带有特定 header 的 GET 请求，并检查返回结果。
*   脚本会将结果保存到 `$target.out` 文件中，方便分析。
*   没有发现任何执行恶意操作的代码，例如反弹 shell，下载恶意文件等。

查看 `README.md` 文件：

*   提供了脚本的使用方法。
*   链接到了 Exploit-db 上的相关利用。

综合来看，没有发现明显的投毒代码。脚本的功能与其描述相符，主要是用于检测漏洞的存在。
因此，投毒风险评估为 0%。

**利用方式总结：**

1.  攻击者发送特制的 HTTP/HTTPS 请求到目标 Fortinet 设备。
2.  请求中包含精心构造的 `Forwarded` 和 `X-Forwarded-Vdom` 等 header，以绕过身份验证。
3.  攻击者利用绕过的身份验证访问管理 API，执行未授权操作，例如获取系统信息，添加/删除用户，修改配置等。

**项目地址:** [Filiplain/Fortinet-PoC-Auth-Bypass](https://github.com/Filiplain/Fortinet-PoC-Auth-Bypass)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)