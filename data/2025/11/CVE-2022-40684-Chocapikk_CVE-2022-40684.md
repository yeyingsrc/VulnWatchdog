## CVE-2022-40684-Fortinet身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，可能导致完全控制受影响的系统

**影响版本:** FortiOS 7.2.0 - 7.2.1, 7.0.0 - 7.0.6; FortiProxy 7.2.0, 7.0.0 - 7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 需要网络访问受影响的设备的管理界面

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684是一个Fortinet FortiOS、FortiProxy和FortiSwitchManager中的身份验证绕过漏洞。未经身份验证的攻击者可以通过构造特制的HTTP或HTTPS请求，在管理界面上执行操作。

**漏洞利用方式：**

该漏洞的利用方式是发送特制的HTTP或HTTPS请求绕过身份验证。提供的POC代码使用Python编写，可以利用此漏洞为指定用户设置SSH密钥，从而允许攻击者使用该密钥登录系统。

1.  **分析POC代码：**
    *   POC代码包含一个Python脚本 (exploit.py) 和一个Nmap脚本 (cve-2022-40684.nse)。
    *   `exploit.py` 脚本接受目标URL、用户名和SSH公钥作为参数，并发送特制的HTTP请求来设置SSH密钥。
    *   `cve-2022-40684.nse` 是一个Nmap脚本，用于检测目标是否存在此漏洞。

2.  **有效性：**
    *   漏洞库信息中CVSS评分为9.8，漏洞利用成熟度为“功能齐全 (FUNCTIONAL)”，CISA的已知被利用漏洞目录中也包含此漏洞，表明该漏洞被广泛利用，POC代码的有效性较高。

3.  **投毒风险：**
    *   检查了提供的POC代码，未发现明显的恶意代码。该脚本的主要功能是利用漏洞在目标系统上设置SSH公钥。虽然使用此脚本可以进行未授权访问，但脚本本身不包含任何隐藏的恶意行为（例如，删除文件、安装后门等）。因此，投毒风险较低，估计为0%。这个百分比基于对提供代码的静态分析，没有发现任何试图在目标机器上建立持久性后门、提取额外信息或横向移动的迹象。所有操作都集中在利用身份验证绕过来设置SSH密钥。

**总结：**

此漏洞影响多个Fortinet产品，允许未经身份验证的远程攻击者完全控制受影响的系统。由于存在可用的POC代码，并且该漏洞已被积极利用，因此组织应尽快应用补丁。

**项目地址:** [Chocapikk/CVE-2022-40684](https://github.com/Chocapikk/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)