## CVE-2024-45496-Openshift-controller-manager-Node Compromise

**漏洞编号:** CVE-2024-45496

**漏洞类型:** 权限提升

**影响应用:** Openshift-controller-manager

**危害等级:** 高危，可能导致节点被完全控制

**影响版本:** 4.12.0 <= version <= 4.18.0

**利用条件:** 需要开发者权限

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2024-45496 是 OpenShift Container Platform 中存在的一个权限提升漏洞。攻击者利用开发者权限，可以通过构造恶意的 .gitconfig 文件，在构建过程中利用 git-clone 容器的特权安全上下文执行任意命令，最终导致 worker 节点被攻陷。

**漏洞利用方式：**

1.  攻击者拥有 OpenShift 的开发者权限。
2.  攻击者创建一个包含恶意 .gitconfig 文件的 Git 仓库。
3.  该 .gitconfig 文件包含在 git clone 过程中执行的命令。
4.  当 OpenShift 构建服务克隆该仓库时，git-clone 容器会执行 .gitconfig 文件中指定的恶意命令。
5.  由于 git-clone 容器具有特权安全上下文，这些命令在 worker 节点上以提升的权限执行，从而导致节点被攻陷。

**POC 代码分析：**

提供的 Dockerfile 用于演示漏洞，但它并没有直接包含恶意代码，而是设置 git 的全局 include.path 到一个固定的位置 `/etc/gitconfig/.gitconfig`。这个设置本身不是攻击，而是为攻击创造条件。攻击者需要能够控制或修改 `/etc/gitconfig/.gitconfig` 的内容，才能执行恶意代码。

Dockerfile 中后续的 git init 和 git status 只是为了触发 git 的配置读取。

最后，Dockerfile 会检查是否存在 `/tmp/configmap_seen` 文件，这似乎是为了验证配置是否被正确读取。如果文件不存在，说明配置读取失败，攻击可能无法成功。

**投毒风险分析：**

提供的 POC 代码本身没有包含任何直接执行恶意操作的代码，因此不存在直接的投毒风险。它仅仅是设置了一个 git 配置，并将命令执行依赖于外部的`/etc/gitconfig/.gitconfig` 文件，如果攻击者能够控制这个文件，就可以实现任意命令执行。


**项目地址:** [fatcatresearch/cve-2024-45496](https://github.com/fatcatresearch/cve-2024-45496)

**漏洞详情:** [CVE-2024-45496](https://nvd.nist.gov/vuln/detail/CVE-2024-45496)