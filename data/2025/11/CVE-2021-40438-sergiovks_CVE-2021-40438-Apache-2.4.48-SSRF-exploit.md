## CVE-2021-40438 - Apache HTTP Server mod_proxy SSRF

**漏洞编号:** CVE-2021-40438

**漏洞类型:** 服务器端请求伪造 (SSRF)

**影响应用:** Apache HTTP Server (mod_proxy)

**危害等级:** 高危，可能导致敏感信息泄露、内部服务访问和远程代码执行 (取决于内部服务的配置)

**影响版本:** <= 2.4.48

**利用条件:** Apache HTTP Server启用了mod_proxy模块且配置不当

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-40438 是一个存在于 Apache HTTP Server 2.4.48 及更早版本中的 mod_proxy 模块的服务器端请求伪造 (SSRF) 漏洞。攻击者可以通过构造特殊的 URI 路径，使得 mod_proxy 将请求转发到由攻击者控制的服务器。 

**有效性：**

根据漏洞信息和漏洞利用代码，该漏洞利用的有效性较高。CISA已将其加入已知被利用的漏洞目录，证明其真实存在且已被实际利用。

**投毒风险：**

提供的漏洞利用代码 `CVE-2021-40438.py` 存在轻微的投毒风险。 代码本身结构简单，主要功能是发送带有特定构造的URL的HTTP请求,尝试利用SSRF漏洞。风险主要在于webhook_url变量, 如果代码的使用者不审查代码，可能将目标服务器的流量引入恶意或受控的webhook。 但代码本身并没有恶意代码,只是参数可以被滥用。因此，投毒风险评估为 10%。

**利用方式：**

1.  **攻击者构造恶意 URI 路径:**  攻击者构建包含目标服务器地址的 URI 路径，例如：`target_url?unix:AAAAAAAAAAAAAAAA...`，其中 `target_url` 是受影响的 Apache 服务器地址，`unix:`  后的字符串用于触发漏洞。
2.  **mod_proxy 转发请求:**  当 Apache 服务器收到包含恶意 URI 路径的请求时，`mod_proxy` 模块会错误地将请求转发到攻击者指定的服务器。
3.  **SSRF 实现:** 通过控制转发的目标服务器，攻击者可以实现 SSRF，从而访问内部服务、读取敏感信息或执行其他恶意操作。例如，攻击者可以将请求转发到内部的 metadata 服务，获取云服务器的凭据。

总体来说，CVE-2021-40438是一个严重的安全漏洞，需要及时进行修复。该漏洞的利用方式相对简单，攻击者可以通过构造恶意URI路径实现SSRF，进而可能造成严重的安全威胁。

**项目地址:** [sergiovks/CVE-2021-40438-Apache-2.4.48-SSRF-exploit](https://github.com/sergiovks/CVE-2021-40438-Apache-2.4.48-SSRF-exploit)

**漏洞详情:** [CVE-2021-40438](https://nvd.nist.gov/vuln/detail/CVE-2021-40438)