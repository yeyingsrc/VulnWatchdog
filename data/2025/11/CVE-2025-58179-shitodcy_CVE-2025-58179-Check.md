## CVE-2025-58179-Astro Cloudflare adapter SSRF

**漏洞编号:** CVE-2025-58179

**漏洞类型:** SSRF (Server-Side Request Forgery)

**影响应用:** Astro

**危害等级:** 高危，可能导致敏感信息泄露、内部服务访问和潜在的远程代码执行

**影响版本:** >= 11.0.3, < 12.6.6

**利用条件:** 需要 Astro 应用使用 Cloudflare adapter，且配置为 output: 'server' 和默认 imageService: 'compile'

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2025-58179 漏洞存在于 Astro 框架的 Cloudflare adapter 中，允许未经授权的第三方域名内容被服务端代理。当 Astro 应用配置为 `output: 'server'` 且使用默认的 `imageService: 'compile'` 时，`/_image` 端点缺少对 URL 参数的充分验证，攻击者可以通过构造恶意的 `href` 参数，使服务器从任意外部地址获取资源。\n\n**有效性：** 提供的 POC 代码 `CVE-2025-58179-Check.py` 能够有效验证漏洞。该脚本通过构建包含恶意 `href` 参数的 URL，并选择性地发送 HTTP 请求来检测目标服务器是否存在 SSRF 漏洞。脚本会检查响应状态码和 Content-Type，以判断服务器是否返回了预期的外部资源。\n\n**投毒风险：** 风险较低 (5%)。虽然无法完全排除代码投毒的可能性，但从代码内容来看，该脚本主要功能是生成和验证 URL，并未发现明显的恶意代码或后门。投毒风险主要来自于作者可能在未来版本中引入恶意代码，或者通过其他方式篡改脚本。需要注意 `verify_with_requests` 函数中使用了 `requests` 库，如果该库被篡改，可能会引入风险。\n\n**利用方式：** 利用方式如下：\n1.  使用提供的 Python 脚本 `CVE-2025-58179-Check.py`，指定目标 Astro 应用的 URL 和要请求的外部 URL。\n2.  脚本会生成包含恶意 `href` 参数的 URL，该参数指向攻击者控制的外部服务器。\n3.  如果启用了 `--request` 参数，脚本会发送 HTTP 请求到目标服务器。\n4.  如果目标服务器存在漏洞，它会从外部服务器获取资源，并将资源内容返回给客户端。\n5.  攻击者可以通过监控外部服务器的访问日志，来确认漏洞是否被成功利用。同时，通过分析目标服务器返回的响应内容，可以进一步判断漏洞的利用价值。

**项目地址:** [shitodcy/CVE-2025-58179-Check](https://github.com/shitodcy/CVE-2025-58179-Check)

**漏洞详情:** [CVE-2025-58179](https://nvd.nist.gov/vuln/detail/CVE-2025-58179)