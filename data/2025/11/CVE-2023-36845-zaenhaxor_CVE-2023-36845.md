## CVE-2023-36845-Junos OS-远程代码执行

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP外部变量修改导致远程代码执行

**影响应用:** Junos OS (EX Series 和 SRX Series) J-Web

**危害等级:** 高危，未授权远程代码执行

**影响版本:** 受影响版本: 所有版本 prior to 20.4R3-S9; 21.1 versions 21.1R1 and later; 21.2 versions prior to 21.2R3-S7; 21.3 versions prior to 21.3R3-S5; 21.4 versions prior to 21.4R3-S5; 22.1 versions prior to 22.1R3-S4; 22.2 versions prior to 22.2R3-S2; 22.3 versions prior to 22.3R2-S2, 22.3R3-S1; 22.4 versions prior to 22.4R2-S1, 22.4R3; 23.2 versions prior to 23.2R1-S1, 23.2R2.

**利用条件:** 需要开启J-Web服务 (http或https)

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-36845 存在于Juniper Networks Junos OS 的 J-Web 组件中。攻击者可以通过设置 `PHPRC` 环境变量来修改 PHP 运行环境，从而远程执行代码。提供的 `cve.sh` 脚本读取一个包含目标主机列表的文件，然后通过构造包含恶意 `PHPRC` 参数的 HTTP 请求，尝试在目标系统上执行代码。脚本通过检查响应中是否包含 `root:` 字符串来判断漏洞是否成功利用，这是因为脚本尝试通过 `auto_prepend_file` 包含 `/etc/passwd` 文件。 

**有效性：**
POC 代码利用了 PHP 外部变量修改漏洞，通过设置 PHPRC 环境变量来包含任意文件，从而实现远程代码执行。该方法被广泛报道，并且CISA KEV 已经收录，确定了其有效性。

**投毒风险：**
脚本本身相对简单，主要功能是发送 HTTP 请求并检查响应。 投毒风险主要体现在以下几个方面：
*   **明面上的风险：** 脚本使用 curl 命令发送请求，存在被中间人攻击的风险，导致信息泄露或者被篡改。
*   **隐藏的风险：** 虽然脚本代码较为简短，但依然存在作者在其他地方植入恶意代码的可能性，比如通过读取其他配置文件、调用外部命令等方式。但是从目前的代码来看，直接的投毒风险较低， 评估为5%。

**利用方式：**
1.  **确定目标:**  需要一个存在漏洞且开启了 J-Web 服务的 Juniper 设备。
2.  **准备攻击脚本：** 使用提供的 `cve.sh` 脚本。
3.  **构造目标列表：** 创建一个包含目标设备 IP 地址或域名的文本文件（例如 `file.txt`）。
4.  **执行攻击：** 运行 `bash cve.sh file.txt` 命令。
5.  **验证结果：** 脚本会输出哪些主机存在漏洞（`VULN`）。


**项目地址:** [zaenhaxor/CVE-2023-36845](https://github.com/zaenhaxor/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)