## CVE-2021-42013 Apache HTTP Server Path Traversal 和远程代码执行

**漏洞编号:** CVE-2021-42013

**漏洞类型:** 路径遍历/远程代码执行

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露和远程代码执行

**影响版本:** 2.4.49 和 2.4.50

**利用条件:** 需要目标服务器运行受影响的 Apache 版本，且 Alias-like 指令配置不当，CGI脚本启用，以及相应的目录权限配置。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是 CVE-2021-41773 的不完整修复，存在于 Apache HTTP Server 2.4.49 和 2.4.50 中。攻击者可以利用路径遍历漏洞读取服务器上的任意文件，如果服务器启用了 CGI 脚本，则可能导致远程代码执行。

**漏洞利用方式：**

1.  **路径遍历：** 攻击者构造包含 `/.%2e/.%2e/` 或双重 URL 编码的 `%%32%65%%32%65/` 的恶意 URL，绕过 Apache 的路径限制，访问受限目录之外的文件。
2.  **远程代码执行（如果 mod_cgi 启用）：** 攻击者通过路径遍历访问 CGI 脚本，并利用 POST 请求发送恶意命令。由于服务器将 URL 路径当作可执行文件，POST 数据当作输入，从而执行攻击者提供的命令。

**POC 代码分析：**

提供的 Python 脚本 `CVE-2021-41773.py` 包含以下功能：

*   **路径遍历检测 (CVE-2021-41773)：** 使用 `/.%2e/.%2e/.%2e/.%2e/` 构造 payload，尝试读取 `/etc/passwd` 和 `/etc/shadow` 文件。
*   **双重 URL 编码路径遍历检测 (CVE-2021-42013)：** 使用 `%%32%65%%32%65/` 构造 payload，尝试读取 `/etc/passwd` 文件。
*   **远程代码执行检测：**  尝试通过 CGI 脚本执行 `id` 命令。如果服务器返回包含 `uid=` 或 `gid=` 的响应，则表示存在 RCE 漏洞。

**有效性：**

根据漏洞描述和 POC 代码的实现，提供的 POC 代码是有效的，可以用于检测目标服务器是否存在 CVE-2021-42013 漏洞，如果目标服务器配置不当，还可检测 RCE 漏洞。

**投毒风险：**

该POC代码是一个扫描器，用于检测漏洞的存在，主要功能是发送 HTTP 请求并分析响应。 代码本身的功能是漏洞检测，不存在恶意行为或后门。对代码进行分析后，可以认为投毒风险为0%。

**总结：**

CVE-2021-42013 是一个严重的安全漏洞，可能导致服务器上的敏感信息泄露，甚至被远程控制。请及时将 Apache HTTP Server 升级到安全版本，并检查服务器配置，确保 Alias-like 指令配置正确，并禁用不必要的 CGI 脚本。

**项目地址:** [drackyjr/CVE-2021-42013](https://github.com/drackyjr/CVE-2021-42013)

**漏洞详情:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)