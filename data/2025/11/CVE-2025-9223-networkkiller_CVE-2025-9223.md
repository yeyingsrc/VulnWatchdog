## CVE-2025-9223-ManageEngine Applications Manager-命令注入

**漏洞编号:** CVE-2025-9223

**漏洞类型:** 命令注入

**影响应用:** ManageEngine Applications Manager

**危害等级:** 高危，可导致远程代码执行

**影响版本:** < 178200

**利用条件:** 需要认证且具有"Execute Program Action"权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-9223是ManageEngine Applications Manager 178100及以下版本中存在的一个经过身份验证的命令注入漏洞。该漏洞存在于“Execute Program Action”功能中，由于不正确的配置导致。 

**有效性分析：**

根据提供的漏洞信息和漏洞利用代码，该漏洞利用的有效性较高。漏洞库信息明确指出存在命令注入漏洞，且提供了受影响的版本范围。漏洞利用代码（PoC）详细描述了漏洞的细节，包括漏洞原理、绕过方法（绝对路径、环境变量、脚本包装器），以及利用示例。 PoC还提供了用于接收上传文件的简单HTTP服务器（upload_server.py），进一步验证了漏洞的可利用性。

**投毒风险分析：**

PoC代码的主要功能是演示命令注入，并提供文件上传服务。`upload_server.py` 代码中包含路径遍历保护、唯一文件名生成、请求日志记录以及内容类型验证等安全特性，这表明作者在一定程度上考虑了安全性。 但是，仍存在一些潜在的风险：

*   **文件上传服务：** `upload_server.py` 接收上传的文件，如果攻击者上传恶意文件（例如包含反弹shell的脚本），并诱导管理员或其他用户执行，则可能导致远程代码执行。尽管有内容类型验证，但绕过验证仍然是可能的。
*   **代码审查不完整：** 尽管PoC代码看起来是良性的，但由于缺乏完整的上下文信息，无法完全排除作者隐藏恶意代码的可能性。

综合考虑，由于存在潜在的恶意文件上传风险，因此认为存在10%的投毒风险。PoC 代码更多关注的是漏洞验证, `upload_server.py` 存在被利用的风险，但其主要目的是为了辅助漏洞演示, 而不是为了投毒。

**利用方式：**

1.  **身份验证：** 首先，攻击者需要获得ManageEngine Applications Manager的有效用户凭据，且该用户需要具有“Execute Program Action”的权限。
2.  **命令注入：** 利用“Execute Program Action”功能，通过以下方法绕过命令黑名单限制：
    *   使用绝对路径执行命令，例如 `C:\Windows\System32\netstat.exe`
    *   使用环境变量，例如 `%SystemRoot%\System32\netstat.exe`
    *   使用脚本包装器，例如 `echo netstat > a.bat && a.bat`
3.  **远程代码执行：** 通过注入的命令，可以执行系统命令，例如：
    *   执行`whoami`或`ipconfig`等命令以获取系统信息。
    *   使用`curl`或`powershell`等工具从目标服务器提取数据。
    *   下载和执行恶意代码，实现完全控制。
4.  **数据提取（可选）：** 如果需要提取数据，可以使用 `upload_server.py` 提供的文件上传服务，将数据发送到攻击者的服务器。

**缓解措施：**

*   升级到不受漏洞影响的ManageEngine Applications Manager版本。
*   严格限制“Execute Program Action”功能的访问权限。
*   加强输入验证，对用户输入的命令进行严格的过滤和转义。
*   使用白名单机制代替黑名单机制，限制允许执行的命令。
*   监控系统日志，检测异常的命令执行活动。

**项目地址:** [networkkiller/CVE-2025-9223](https://github.com/networkkiller/CVE-2025-9223)

**漏洞详情:** [CVE-2025-9223](https://nvd.nist.gov/vuln/detail/CVE-2025-9223)