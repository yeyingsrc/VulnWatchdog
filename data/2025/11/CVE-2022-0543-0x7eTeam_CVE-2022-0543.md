## CVE-2022-0543 - Redis Lua Sandbox Escape

**漏洞编号:** CVE-2022-0543

**漏洞类型:** Lua Sandbox Escape

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** Debian specific packaging issue, version N/A

**利用条件:** 需要Redis服务器运行在存在此漏洞的Debian系统上，并且允许用户执行Lua脚本。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0543 是一个 Debian 版本的 Redis 中的 Lua 沙箱逃逸漏洞，允许攻击者执行任意命令。

**有效性:**
提供的 POC 代码 `CVE-2022-0543.py` 看上去是有效的。它利用了 Redis 的 `eval` 命令执行 Lua 脚本，绕过沙箱执行系统命令。代码首先加载 `/usr/lib/x86_64-linux-gnu/liblua5.1.so.0` 这个动态库，然后使用 `io.popen` 执行 shell 命令，并将结果返回。

**投毒风险:**
代码中没有明显的投毒行为。它直接利用了已知的 Lua 沙箱逃逸技术，利用 `package.loadlib` 和 `io.popen` 函数执行系统命令。代码相对简单，主要功能是执行用户输入的命令。README.md文件只是简单的使用说明，也没有投毒代码。因此，投毒风险为0%。

**利用方式:**
1.  攻击者首先需要连接到存在漏洞的 Redis 服务器，并且Redis服务器运行在debian系统上。
2.  攻击者执行 `CVE-2022-0543.py` 脚本，指定 Redis 服务器的 IP 地址、端口以及密码(如果需要身份验证)。
3.  脚本会提示攻击者输入要执行的命令。
4.  脚本使用 `redis.eval` 命令执行构造的 Lua 脚本。
5.  Lua 脚本利用 `package.loadlib` 加载 `liblua5.1.so.0`，然后使用 `io.popen` 执行指定的系统命令。
6.  命令执行的结果会被返回给攻击者。

此漏洞利用依赖于 Debian 系统特定的 Redis 打包问题，因此只影响运行在 Debian 系统上的 Redis 服务器。

**项目地址:** [0x7eTeam/CVE-2022-0543](https://github.com/0x7eTeam/CVE-2022-0543)

**漏洞详情:** [CVE-2022-0543](https://nvd.nist.gov/vuln/detail/CVE-2022-0543)