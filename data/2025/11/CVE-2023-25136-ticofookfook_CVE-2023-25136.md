## CVE-2023-25136 OpenSSH 双重释放漏洞

**漏洞编号:** CVE-2023-25136

**漏洞类型:** 双重释放

**影响应用:** OpenSSH

**危害等级:** 高危，理论上可导致远程代码执行

**影响版本:** 9.1

**利用条件:** 目标运行OpenSSH 9.1，且配置为默认配置

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-25136是OpenSSH 9.1中引入的一个双重释放漏洞，发生在 options.kex_algorithms 处理过程中。该漏洞允许未经身份验证的远程攻击者通过构造特定的数据包触发双重释放，从而跳转到sshd进程地址空间的任意位置。虽然利用难度较高，但是理论上可以实现远程代码执行。

**有效性评估：**

根据提供的漏洞库信息，CVE-2023-25136确实存在于OpenSSH 9.1版本中。漏洞库和第三方报告均指出远程代码执行在理论上是可能的。提供的PoC代码尝试利用此漏洞。

**漏洞利用代码分析：**

该PoC代码首先尝试解析域名到IP地址，然后通过Paramiko库尝试连接到目标SSH服务器。代码会检查SSH banner是否为`SSH-2.0-PuTTY_Release_0.64`，但这个检查和CVE-2023-25136本身的漏洞没有直接联系。PoC代码中的连接尝试，如果成功，会尝试执行`echo $SSH_CONNECTION`命令。这个利用流程可能不是直接触发双重释放，而是试图检测或利用漏洞触发后的效果。

**投毒风险评估：**

仔细检查提供的PoC代码后，没有发现明显的投毒代码。代码主要功能是域名解析，SSH连接，banner检查和命令执行，都是漏洞利用相关的操作。作者可能将部分利用代码藏在其他地方。未发现作者隐藏的投毒代码，可以初步判断投毒风险较低。

**利用方式总结：**

1.  **目标确定：** 扫描或通过其他方式获得运行 OpenSSH 9.1 的服务器列表。
2.  **触发漏洞：** 通过发送特制的SSH握手信息（特别是kex_algorithms选项）来触发双重释放漏洞。
3.  **控制执行流：** 利用双重释放造成的内存损坏，尝试覆盖sshd进程中的关键数据结构，从而控制程序执行流。
4.  **远程代码执行：** 在控制程序执行流后，攻击者可以执行任意代码，从而完全控制目标服务器。

**有效性：** PoC可能有一定的有效性，但利用条件和具体利用方法可能需要进一步研究。

**投毒风险：** 未发现。

**利用方式：** 通过构造畸形的KEX算法协商数据包，触发OpenSSH 9.1的double-free漏洞，最终实现远程代码执行。

**项目地址:** [ticofookfook/CVE-2023-25136](https://github.com/ticofookfook/CVE-2023-25136)

**漏洞详情:** [CVE-2023-25136](https://nvd.nist.gov/vuln/detail/CVE-2023-25136)