## CVE-2024-51378-CyberPanel-命令注入

**漏洞编号:** CVE-2024-51378

**漏洞类型:** 命令注入

**影响应用:** CyberPanel

**危害等级:** 高危，可能导致远程代码执行和系统完全控制

**影响版本:** <= 2.3.7 (未打补丁)

**利用条件:** 需要网络访问CyberPanel的管理端口(默认8090)

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2024-51378是CyberPanel的一个命令注入漏洞，存在于`dns/views.py`和`ftp/views.py`的`getresetstatus`函数中。攻击者可以通过发送特制的OPTIONS请求到`/dns/getresetstatus`或`/ftp/getresetstatus`，绕过`secMiddleware` (该中间件只对POST请求生效)，并在`statusfile`属性中使用shell元字符注入恶意命令。

**有效性：**
根据漏洞信息和提供的POC代码，该漏洞是有效的。漏洞库信息明确指出该漏洞在野外已被利用。POC代码也提供了详细的利用步骤和目标版本。

**投毒风险：**
提供的POC代码看起来比较直接，主要功能是发送包含命令注入的HTTP请求，并打印响应。虽然代码的目的是利用漏洞，但经过仔细检查，没有发现明显的投毒迹象。POC的作者提供了公开的博客和GitHub资料，增加了可信度。`httpx`是一个常见的Python HTTP客户端库，也没有明显的恶意行为。`README.md`中的免责声明也符合安全研究的规范。虽然不能完全排除极小的风险，但目前看来该仓库存在恶意投毒代码的可能性较低。

**利用方式：**
1.  攻击者首先需要能够访问CyberPanel的管理界面。
2.  攻击者通过发送OPTIONS请求到`/dns/getresetstatus`或者`/ftp/getresetstatus`端点，并在`statusfile`参数中注入恶意命令。
3.  由于`secMiddleware`只针对POST请求生效，攻击者可以通过OPTIONS请求绕过身份验证。
4.  服务器执行注入的命令，攻击者可以获取服务器控制权。
5.  POC代码提供了一个交互式shell，允许攻击者执行任意命令。

**项目地址:** [refr4g/CVE-2024-51378](https://github.com/refr4g/CVE-2024-51378)

**漏洞详情:** [CVE-2024-51378](https://nvd.nist.gov/vuln/detail/CVE-2024-51378)