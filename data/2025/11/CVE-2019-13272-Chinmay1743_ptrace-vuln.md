## CVE-2019-13272-Linux内核-ptrace权限提升

**漏洞编号:** CVE-2019-13272

**漏洞类型:** 权限提升

**影响应用:** Linux内核

**危害等级:** 高危，本地用户可获取root权限

**影响版本:** < 5.1.17

**利用条件:** 需要存在满足漏洞触发条件的父子进程关系，父进程放弃权限并调用execve。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2019-13272漏洞存在于Linux内核的ptrace实现中。当一个进程尝试创建ptrace关系时，`ptrace_link`函数在处理进程凭据时存在缺陷，导致权限检查不正确。攻击者可以利用这一漏洞，通过构造特定的父子进程关系，其中父进程降低权限并调用`execve`，使得子进程能够以更高的权限运行。这可以通过例如Polkit的pkexec助手与PTRACE_TRACEME结合来实现本地提权。提供的PoC代码旨在演示ptrace功能，验证系统是否易受攻击，它主要通过父子进程进行ptrace调用和系统调用跟踪。

**有效性评估：**
提供的POC代码本身并不能直接利用该漏洞进行提权，而是一个简单的ptrace示例，用于验证系统是否允许ptrace操作。实际利用需要结合pkexec或其他SUID程序。该PoC通过展示系统调用的过程，间接表明ptrace功能是否正常运行，这可以作为判断系统是否存在漏洞利用可能性的依据。

**投毒风险评估：**
代码仓库中的`LICENSE`、`README.md`和`poc.c`文件均未发现明显的恶意代码。`poc.c`的功能是演示ptrace的基本用法，跟踪系统调用。`README.md`也只是说明了如何编译和运行POC。因此，该仓库的投毒风险较低，约为0%。

**利用方式分析：**
1.  **漏洞原理：** `ptrace_link`函数在处理进程凭据时存在缺陷，导致权限检查绕过。
2.  **利用场景：** 需要满足特定的父子进程关系，其中父进程放弃权限并调用`execve`。
3.  **利用工具：** 可以结合pkexec等SUID程序，利用`PTRACE_TRACEME`进行提权。
4.  **缓解措施：** SELinux的`deny_ptrace`策略可以在一定程度上缓解该漏洞的影响。
5.  **POC说明：** 提供的POC主要用于检测系统是否允许ptrace操作，而不是直接进行提权。实际的提权过程需要更复杂的代码。

总而言之，该漏洞利用需要精心构造的父子进程关系和合适的SUID程序才能成功提权。POC提供的代码主要用于验证ptrace功能是否启用，而不是一个完整的提权exp。

**项目地址:** [Chinmay1743/ptrace-vuln](https://github.com/Chinmay1743/ptrace-vuln)

**漏洞详情:** [CVE-2019-13272](https://nvd.nist.gov/vuln/detail/CVE-2019-13272)