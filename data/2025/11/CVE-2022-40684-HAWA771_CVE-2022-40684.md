## CVE-2022-40684-Fortinet-Authentication-Bypass

**漏洞编号:** CVE-2022-40684

**漏洞类型:** Authentication Bypass

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 高危，允许未授权的攻击者执行管理操作

**影响版本:** FortiOS: 7.0.0-7.0.6, 7.2.0-7.2.1; FortiProxy: 7.0.0-7.0.6, 7.2.0; FortiSwitchManager: 7.0.0, 7.2.0

**利用条件:** 需要能够通过HTTP或HTTPS访问目标设备的管理界面

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-40684是一个Fortinet FortiOS、FortiProxy和FortiSwitchManager中的身份验证绕过漏洞。未经身份验证的攻击者可以利用此漏洞通过特制的HTTP或HTTPS请求在管理界面上执行操作。

**有效性：**

根据漏洞库信息和提供的POC代码，该漏洞已被公开披露，且存在可用的POC利用代码，并被CISA列入已知被利用漏洞目录(KEV)。POC代码通过发送特制的HTTP PUT请求到目标设备的`/api/v2/cmdb/system/admin/{username}`接口，修改指定用户的SSH公钥来实现身份验证绕过。如果`SSH key is good`出现在响应文本中，则表示公钥已成功设置，之后即可使用对应的私钥通过SSH登录。

**投毒风险：**

分析提供的POC代码，没有发现明显的恶意代码或后门。代码主要功能是利用漏洞设置SSH密钥。虽然代码包含网络请求和SSH连接，但这些都是漏洞利用的必要步骤，没有发现其他可疑行为。但是，在使用任何第三方提供的漏洞利用代码时，都应谨慎审查，以确保其安全性。投毒的可能性极低，故设置为1%。

**利用方式：**

1.  **确定目标：** 找到运行受影响版本的FortiOS、FortiProxy或FortiSwitchManager的设备。
2.  **准备SSH密钥：** 生成一对SSH公钥和私钥。POC代码需要公钥的内容。
3.  **运行POC代码：** 使用提供的`exploit.py`脚本，指定目标URL、用户名和SSH公钥文件。例如：`python exploit.py -u <target_url> -U <username> -k <path_to_public_key>`。
4.  **SSH登录：** 如果利用成功，可以使用相应的私钥通过SSH登录到目标设备：`ssh <username>@<target_ip>`。

**项目地址:** [HAWA771/CVE-2022-40684](https://github.com/HAWA771/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)