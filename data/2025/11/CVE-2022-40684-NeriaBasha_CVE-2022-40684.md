## CVE-2022-40684-Fortinet身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 高危，允许未经身份验证的攻击者在管理界面上执行操作

**影响版本:** FortiOS 7.2.0 through 7.2.1 and 7.0.0 through 7.0.6, FortiProxy 7.2.0 and version 7.0.0 through 7.0.6 and FortiSwitchManager version 7.2.0 and 7.0.0

**利用条件:** 目标设备必须存在漏洞且可以通过网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684 是 Fortinet FortiOS, FortiProxy, FortiSwitchManager 中的一个身份验证绕过漏洞。根据漏洞库信息，未经身份验证的攻击者可以通过特制的 HTTP 或 HTTPS 请求在管理界面上执行操作。CVSS 3.1 评分为 9.8 (Critical)，说明该漏洞非常严重。

POC代码（poc-cve-2022-40684.ps1）是一个PowerShell脚本，它通过发送包含特定 Header 的 HTTP GET 请求到目标设备的 `/api/v2/cmdb/system/admin` 路径来尝试绕过身份验证。关键的 Header 包括 'Host', 'forwarded' 和 'x-forwarded-vdom'，这些 Header 被用来欺骗目标设备，使其认为请求来自受信任的来源。

**有效性：**

POC代码的有效性较高。漏洞库信息中该漏洞的 `ExploitCodeMaturity` 为 `FUNCTIONAL`，表明已经存在可用的利用代码。CISA 已将其添加到已知被利用的漏洞目录中，进一步表明该漏洞已被积极利用。

POC 代码通过构造特殊的HTTP头部来绕过身份验证，并尝试访问 `/api/v2/cmdb/system/admin` 获取管理员信息。如果返回状态码不是 401 (未经授权) 或 null (无法连接)，则表示目标可能存在漏洞，并解析返回的 JSON 数据以提取管理员用户名、权限信息、序列号、版本和构建信息。如果返回的是管理员信息，则证明漏洞利用成功。

**投毒风险：**

查看提供的 PowerShell 脚本 `poc-cve-2022-40684.ps1` 和 `README.md`，没有发现明显的恶意代码或投毒行为。脚本的功能明确，主要用于发送特制的 HTTP 请求来测试目标设备是否存在 CVE-2022-40684 漏洞。它只是简单地读取管理员信息，没有执行任何可能危害系统的操作。因此，判断投毒风险为 0%。

**利用方式：**

1.  攻击者构造包含特制的 HTTP Header（'Host', 'forwarded', 'x-forwarded-vdom'）的请求。
2.  将请求发送到目标 Fortinet 设备的 `/api/v2/cmdb/system/admin` 路径。
3.  如果设备存在漏洞，则身份验证将被绕过，攻击者可以访问管理员信息（用户名、权限等）和系统信息（序列号、版本、构建）。
4.  攻击者可以进一步利用获取的信息，例如，使用已知的管理员用户名和默认密码（如果存在）登录设备，或者利用获取的系统信息查找其他漏洞。

**项目地址:** [NeriaBasha/CVE-2022-40684](https://github.com/NeriaBasha/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)