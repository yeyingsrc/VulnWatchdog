## CVE-2024-4040-CrushFTP-服务器端模板注入

**漏洞编号:** CVE-2024-4040

**漏洞类型:** 服务器端模板注入

**影响应用:** CrushFTP

**危害等级:** 高危，可能导致任意文件读取，身份验证绕过和远程代码执行

**影响版本:** 10.0 <= version < 10.7.1 和 11.0 <= version < 11.1.0

**利用条件:** 需要网络访问CrushFTP服务

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-4040是一个CrushFTP中的服务器端模板注入漏洞，存在于所有10.7.1之前的10.x版本和11.1.0之前的11.x版本。攻击者可以通过发送特制的请求利用此漏洞，实现未经身份验证的远程任意文件读取（超出VFS沙箱）、身份验证绕过，并最终在服务器上执行远程代码。

**有效性：**
根据漏洞库信息和漏洞利用代码（Dockerfile，README.md），提供的Docker镜像部署了一个易受攻击的CrushFTP版本。README.md明确推荐使用Stuub的PoC进行利用，表明该漏洞的利用是可行的。

**投毒风险：**
提供的Docker文件主要用于搭建一个存在漏洞的环境以供研究。Dockerfile执行的操作主要包括：
*   使用OpenJDK 21作为基础镜像
*   创建一个`crushftp` 用户并创建CrushFTP的安装目录，赋予用户相应的权限
*   复制CrushFTP 10的源代码到容器中
*   创建一个具有随机密码的`crushadmin`用户
*   暴露相关端口(21, 22, 443, 8080, 9090)
*   启动CrushFTP服务

`crushftp_init.sh` 脚本用于启动CrushFTP服务。总体来看，此Dockerfile的目的在于创建方便利用CVE-2024-4040的环境，主要风险在于利用此漏洞控制CrushFTP服务本身，通过CrushFTP服务进行非法操作。并没有发现明显的恶意投毒代码，但由于Docker容器可以执行任意命令，仍然存在一定的风险，如在创建用户时可能植入后门账户等。因此，投毒风险评估为10%。

**利用方式：**
1.  **环境搭建：** 使用提供的Dockerfile构建并运行一个包含易受攻击CrushFTP版本的Docker容器。
2.  **漏洞触发：** 利用服务器端模板注入漏洞，通过精心构造的HTTP请求发送到CrushFTP服务器，触发漏洞。
3.  **利用：**
    *   **任意文件读取：**  读取服务器上的任意文件（绕过VFS沙箱）。
    *   **身份验证绕过：**  绕过身份验证机制，获取管理员权限。
    *   **远程代码执行：**  执行任意代码，完全控制服务器。
4.  **参考PoC：** README.md推荐使用[Stuub](https://github.com/Stuub)'s [CVE-2024-4040-SSTI-LFI-PoC](https://github.com/Stuub/CVE-2024-4040-SSTI-LFI-PoC)进行漏洞验证。

**项目地址:** [juanorts/CrushFTP10-Docker-CVE-2024-4040](https://github.com/juanorts/CrushFTP10-Docker-CVE-2024-4040)

**漏洞详情:** [CVE-2024-4040](https://nvd.nist.gov/vuln/detail/CVE-2024-4040)