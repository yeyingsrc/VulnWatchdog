## CVE-2023-36845-Junos OS J-Web PHP 外部变量修改导致远程代码执行

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP 外部变量修改

**影响应用:** Junos OS J-Web (EX Series, SRX Series)

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** 受影响版本包括但不限于: 20.4R3-S9之前的所有版本；21.1R1及更高版本；21.2版本低于21.2R3-S7；21.3版本低于21.3R3-S5；21.4版本低于21.4R3-S5；22.1版本低于22.1R3-S4；22.2版本低于22.2R3-S2；22.3版本低于22.3R2-S2, 22.3R3-S1；22.4版本低于22.4R2-S1, 22.4R3；23.2版本低于23.2R1-S1, 23.2R2

**利用条件:** 目标设备需要启用 J-Web，并且可以通过 HTTP 或 HTTPS 访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36845 是 Juniper Networks Junos OS 中 J-Web 组件的一个 PHP 外部变量修改漏洞。攻击者可以通过发送特制的 HTTP 请求，设置 `PHPRC` 环境变量来修改 PHP 的执行环境，从而实现远程代码执行。该漏洞影响 EX 系列和 SRX 系列设备上运行的多个 Junos OS 版本。提供的PoC代码利用了这一漏洞，通过POST请求，将`auto_prepend_file`设置为`/etc/passwd`，并修改`PHPRC`变量为`/dev/fd/0`。该代码的目的是读取目标服务器的`/etc/passwd`文件，验证漏洞的存在性。虽然PoC本身是为了验证漏洞，但攻击者可以利用此漏洞执行任意代码，例如植入恶意程序。虽然代码看起来简洁明了, 但需要注意的是该代码存在潜在的风险：

1.  **依赖外部`hosts.txt`文件:** 攻击目标列表依赖于外部文件，如果该文件被替换为包含恶意目标的列表，则可能被用于攻击。尽管这不属于代码本身的投毒，但利用代码的人可能被误导攻击错误的目标。
2.  **简化的利用方式:**  该POC只验证了读取`/etc/passwd`，实际利用可能需要更复杂的payload，而简化版本可能会隐藏更复杂的攻击逻辑。

因此，评估投毒风险为10%。主要是考虑到代码的简洁性和明确的目的，直接用于恶意目的的可能性较低，但仍需注意潜在的被误用或利用的风险。

**利用方式总结：**
1.  攻击者需要能够通过网络访问目标设备的 J-Web 接口。
2.  攻击者发送一个包含特制参数 `PHPRC` 的 HTTP POST 请求。
3.  `PHPRC` 变量被设置为指向攻击者控制的文件或数据流，用于修改PHP的执行环境。
4.  `auto_prepend_file`被用于包含`/etc/passwd`，以读取该文件，验证漏洞。
5.  利用 `PHPRC` 环境变量修改，攻击者可以注入并执行任意 PHP 代码。

**项目地址:** [0xNehru/CVE-2023-36845-Juniper-Vulnerability](https://github.com/0xNehru/CVE-2023-36845-Juniper-Vulnerability)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)