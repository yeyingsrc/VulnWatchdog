## CVE-2017-7494 - Samba 远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 3.5.0 <= version < 4.6.4, 4.5.10, 4.4.14

**利用条件:** 需要有效的Samba用户凭据，可写入的共享文件夹，以及共享文件夹在服务器端的路径。某些情况下，匿名访问和常见的文件系统位置可能被利用。

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2017-7494，也被称为“SambaCry”，是Samba 3.5.0到4.6.4, 4.5.10, 和4.4.14版本中存在的一个远程代码执行漏洞。攻击者可以通过上传一个共享库到可写共享文件夹，然后诱使服务器加载并执行它，从而实现远程代码执行。\n\n**有效性：**根据漏洞库信息和漏洞利用代码的描述，该漏洞利用是有效的，并且存在公开的POC。\n\n**投毒风险：**提供的POC代码主要包含一个README.md文件和一个Ruby脚本`is_known_pipename.rb`。README.md文件描述了漏洞的细节和利用条件，Ruby脚本很可能是用于辅助漏洞利用，例如检测目标环境是否满足某些先决条件。直接的投毒代码的可能性较低，但不能完全排除作者在脚本中隐藏恶意代码的可能性。因此，投毒风险评估为5%。需要进一步审计`is_known_pipename.rb`脚本的内容才能确定是否存在恶意行为。\n\n**利用方式：**\n1.  **获得访问权限：** 攻击者需要具有对Samba服务器上可写共享目录的有效用户凭据。在某些配置不当的情况下，匿名访问也可能允许未经身份验证的写入权限。\n2.  **上传恶意共享库：** 攻击者编译一个包含恶意代码的共享库（例如，`.so`文件），并将其上传到目标服务器上的可写共享目录。\n3.  **触发加载执行：** 攻击者通过构造一个特殊的SMB请求，诱使Samba服务器加载并执行上传的共享库。这通常涉及到修改SMB配置或利用Samba的路径处理机制。例如，通过 `loadmodule` 选项指定恶意库的路径。\n4.  **远程代码执行：** 一旦恶意共享库被加载，它将在Samba服务器的上下文中执行，允许攻击者执行任意命令，控制服务器，或进一步渗透网络。

**项目地址:** [homjxi0e/CVE-2017-7494](https://github.com/homjxi0e/CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)