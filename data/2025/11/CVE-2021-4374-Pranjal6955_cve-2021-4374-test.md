## CVE-2021-4374-WordPress Automatic Plugin-任意选项更新

**漏洞编号:** CVE-2021-4374

**漏洞类型:** 任意选项更新

**影响应用:** WordPress Automatic Plugin

**危害等级:** 高危，可能导致网站被完全控制

**影响版本:** <= 3.53.2

**利用条件:** 无需认证，可直接通过网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-4374 存在于 WordPress Automatic 插件中，由于 process_form.php 文件中缺少授权和选项验证，导致未经身份验证的攻击者可以更新插件的设置，从而完全控制网站。

**有效性：**

提供的漏洞利用代码包含了一个完整的测试环境，其中包括：

*   Docker Compose 文件，用于快速搭建包含 WordPress 和 MySQL 的测试环境。
*   Nuclei 模板，用于检测漏洞。
*   测试脚本，用于自动化测试。
*   创建模拟易受攻击端点的脚本，用于在没有真实插件的情况下进行测试。

该测试环境能够有效验证漏洞的存在。

**投毒风险：**

该漏洞利用代码的主要目的是提供一个测试环境，用于验证 CVE-2021-4374 漏洞。虽然存在一些风险，但总体投毒风险较低：

*   **风险点：** `setup-mock-endpoint.sh` 脚本创建了一个模拟的易受攻击端点，可能会被恶意使用。
*   **缓解措施：** 该脚本明确标记为“MOCK VULNERABLE ENDPOINT - FOR TESTING ONLY”，并且只在测试环境中使用。用户应仔细阅读说明文档，避免在生产环境中使用该脚本。
*   **代码审计：** 用户可以检查所有的脚本和配置文件，以确保其中不包含恶意代码。

综合来看，该漏洞利用代码存在一定的投毒风险，但是风险较低，用户可以通过代码审计和遵循安全建议来降低风险。

**利用方式：**

1.  攻击者通过发送恶意构造的 POST 请求到 `wp-content/plugins/wp-automatic/process_form.php` 文件，该请求包含要更新的选项和对应的值。
2.  由于缺少授权验证，插件会直接更新选项的值，而无需验证请求的来源和用户的身份。
3.  攻击者可以利用该漏洞修改插件的设置，例如：
    *   添加恶意代码到插件的模板中，实现远程代码执行。
    *   修改插件的 API 密钥，控制插件与其他服务的交互。
    *   禁用插件的功能，导致网站无法正常运行。

**项目地址:** [Pranjal6955/cve-2021-4374-test](https://github.com/Pranjal6955/cve-2021-4374-test)

**漏洞详情:** [CVE-2021-4374](https://nvd.nist.gov/vuln/detail/CVE-2021-4374)