## CVE-2015-3306 ProFTPD 1.3.5 mod_copy 远程命令执行

**漏洞编号:** CVE-2015-3306

**漏洞类型:** 远程命令执行

**影响应用:** ProFTPD

**危害等级:** 高危，可读取和写入任意文件，可能导致服务器被完全控制

**影响版本:** 1.3.5

**利用条件:** ProFTPD 1.3.5 开启 mod_copy 模块

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2015-3306 漏洞存在于 ProFTPD 1.3.5 版本的 mod_copy 模块中。该模块允许未经授权的远程攻击者利用 `SITE CPFR` 和 `SITE CPTO` 命令读取和写入服务器上的任意文件。 

**有效性分析：**

提供的 Python 脚本 `exploit.py` 针对 CVE-2015-3306 漏洞，其基本原理是：

1.  连接到目标 ProFTPD 服务器的 21 端口。
2.  发送 `SITE CPFR /secret.txt` 命令，指示服务器从 `/secret.txt` 文件进行复制。
3.  发送 `SITE CPTO /var/www/html/secret.txt` 命令，指示服务器将复制的内容写入 `/var/www/html/secret.txt` 文件。 
4. 通过http请求访问/var/www/html/secret.txt，验证漏洞是否成功

如果目标服务器存在此漏洞且启用了 `mod_copy` 模块，攻击者可以利用此脚本将服务器上的 `/secret.txt` 文件复制到 Web 服务器的根目录，然后通过 Web 浏览器访问该文件，从而获取敏感信息。

**投毒风险分析：**

检查提供的 `exploit.py` 脚本，没有发现明显的恶意代码或后门。脚本的功能与其声明的目的相符，即利用 CVE-2015-3306 漏洞复制文件。脚本仅包含用于连接 FTP 服务器、发送命令和验证文件是否成功写入的代码。因此，可以认为该仓库不存在投毒代码的可能性较高。

**利用方式：**

1.  **目标确定：** 确定运行 ProFTPD 1.3.5 且启用 `mod_copy` 模块的目标服务器。
2.  **脚本执行：** 运行提供的 `exploit.py` 脚本，并提供目标服务器的 IP 地址作为参数 (`python3 exploit.py <target-ip>`)。
3.  **文件访问：** 脚本成功执行后，尝试通过 Web 浏览器访问复制后的文件（例如，`http://<target-ip>/secret.txt`）。如果成功访问，则表明漏洞利用成功。
4.  **权限提升：** 理论上，如果攻击者可以写入任意文件，则可以通过写入恶意的 PHP 脚本到 Web 服务器的根目录，从而实现远程代码执行，最终完全控制服务器。例如可以cpfr /etc/passwd 到web目录。但是本脚本仅仅复制了/secret.txt文件，实际危害取决于该文件的内容。

**注意事项：**

*   确保在授权的情况下进行漏洞利用测试。
*   在生产环境中利用此漏洞可能导致严重的安全问题。
*   建议及时升级 ProFTPD 版本或禁用 `mod_copy` 模块以修复此漏洞。

**项目地址:** [cybersensei-EH/hackviser_labs_CVE-2015-3306](https://github.com/cybersensei-EH/hackviser_labs_CVE-2015-3306)

**漏洞详情:** [CVE-2015-3306](https://nvd.nist.gov/vuln/detail/CVE-2015-3306)