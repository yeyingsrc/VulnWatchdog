## CVE-2023-25136-OpenSSH-Double-Free

**漏洞编号:** CVE-2023-25136

**漏洞类型:** Double-Free

**影响应用:** OpenSSH

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 9.1

**利用条件:** 目标服务器运行OpenSSH 9.1，且允许SSH连接

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25136是OpenSSH 9.1中存在的一个双重释放漏洞，位于`options.kex_algorithms`处理过程中。远程未经身份验证的攻击者可以通过构造恶意的数据包触发此漏洞，从而在sshd地址空间中跳转到任意位置，理论上可能实现远程代码执行。提供的POC代码包含两个Python脚本：`openssh-9_1.py`用于扫描IP地址列表以查找易受攻击的OpenSSH 9.1服务器，`openssh-9_1-single_exploit.py`旨在利用单个易受攻击的IP地址。

**有效性：**

根据漏洞信息，此漏洞影响OpenSSH 9.1。POC代码尝试通过`paramiko`库建立SSH连接，并设置`transport.local_version`来触发漏洞。虽然提供的代码只是尝试连接，并没有完整的漏洞利用流程，但它是漏洞利用的基础。更完整的利用需要进一步的内存操作，实现任意代码执行。因此，提供的POC的**有效性较低，仅验证漏洞存在**。要完全利用该漏洞，需要更复杂的利用程序。

**投毒风险：**

分析POC代码：
*   `README.md`: 包含漏洞描述、使用方法、依赖库等信息。没有发现恶意代码。
*   `openssh-9_1.py`:  扫描指定IP列表，检测是否存在漏洞版本，尝试连接目标机器的22端口，并发送SSH版本信息，根据连接结果判断是否存在漏洞。该脚本本身不包含恶意代码。
*   `openssh-9_1-single_exploit.py`: 利用指定IP地址，尝试连接目标机器的22端口，并发送SSH版本信息。该脚本本身不包含恶意代码。

总体来看，代码逻辑较为简单，主要用于检测漏洞是否存在。但存在以下风险：
1.  **依赖库风险：** `paramiko`, `pyfiglet`, `termcolor` 等依赖库可能存在安全风险，如果这些库被投毒，则可能影响使用该POC的用户。
2.  **扫描行为风险：** 使用`openssh-9_1.py` 扫描大量IP可能被视为恶意行为，导致IP被封禁。
3.  **未来代码修改风险：** 代码作者可能在未来版本中加入恶意代码。

综合考虑，投毒风险较低，估计为10%。

**利用方式：**

1.  **版本检测：** 攻击者首先需要确定目标服务器运行的OpenSSH版本为9.1。
2.  **发送恶意数据包：** 通过构造特殊的SSH握手数据包，触发`options.kex_algorithms`处理过程中的双重释放漏洞。
3.  **内存控制：** 成功触发双重释放后，攻击者需要精心构造内存布局，以便利用该漏洞实现任意地址读写。
4.  **代码执行：** 利用任意地址读写能力，攻击者可以修改sshd进程的内存，例如覆盖函数指针等，最终实现远程代码执行。

总结：利用方式涉及复杂的内存操作和漏洞触发，需要对SSH协议和OpenSSH代码有深入的理解。提供的POC代码仅仅完成了版本检测和初步的连接尝试，距离完整的漏洞利用还有很大差距。

**项目地址:** [Christbowel/CVE-2023-25136](https://github.com/Christbowel/CVE-2023-25136)

**漏洞详情:** [CVE-2023-25136](https://nvd.nist.gov/vuln/detail/CVE-2023-25136)