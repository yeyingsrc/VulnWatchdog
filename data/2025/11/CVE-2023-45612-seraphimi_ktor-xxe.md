## CVE-2023-45612-Ktor-XXE

**漏洞编号:** CVE-2023-45612

**漏洞类型:** XXE

**影响应用:** Ktor

**危害等级:** 高危，可能导致信息泄露、SSRF

**影响版本:** < 2.3.5

**利用条件:** 目标Ktor应用启用了ContentNegotiation并且使用XML格式，且未进行安全配置

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2023-45612是JetBrains Ktor框架中存在的一个XXE漏洞。当Ktor应用使用XML进行内容协商时，如果未正确配置XML解析器，攻击者可以通过发送包含恶意XML Payload的请求来利用此漏洞。

**有效性：**
提供的POC代码看起来是有效的。它包含了一个Ktor服务端示例，以及一个Python脚本 `poc.py`，该脚本用于发送包含XXE Payload的请求。POC提供了两种利用方式：
*   **文件泄露：** 攻击者可以读取服务器上的任意文件（例如，`/etc/hostname`、`/etc/passwd`）。
*   **SSRF：** 攻击者可以利用服务器发起任意的网络请求。

**投毒风险：**
对提供的代码仓库进行分析，发现投毒风险较低。关键点如下：
*   `build.gradle.kts` 文件指定了依赖，版本都是已知的。
*   `README.md` 描述了如何运行和使用POC。
*   `poc.py`  （虽然没有提供），根据README描述可以推断是用于发送恶意XML，没有明显的后门代码。
*   脚本目的是演示漏洞利用，而非植入恶意代码。
因此，仓库存在恶意投毒代码的概率较低，估计在1%左右。

**利用方式：**
1.  **目标应用环境：** 目标Ktor应用必须启用了ContentNegotiation并且使用XML格式，且使用的Ktor版本低于2.3.5。
2.  **恶意XML Payload：** 攻击者构造包含恶意XML实体定义的Payload。例如，Payload可能包含对本地文件的引用或者外部URL的引用。
3.  **发送请求：** 攻击者将包含恶意Payload的XML数据发送到目标Ktor应用的某个端点。
4.  **漏洞触发：** Ktor应用在解析XML数据时，会解析Payload中的恶意实体，从而导致XXE漏洞的触发。
5.  **利用结果：** 攻击者可以利用XXE漏洞读取服务器上的文件、发起SSRF攻击，或者执行其他恶意操作。

**项目地址:** [seraphimi/ktor-xxe](https://github.com/seraphimi/ktor-xxe)

**漏洞详情:** [CVE-2023-45612](https://nvd.nist.gov/vuln/detail/CVE-2023-45612)