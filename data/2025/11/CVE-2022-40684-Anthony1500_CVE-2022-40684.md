## CVE-2022-40684 - Fortinet身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，未经身份验证的攻击者可以在管理界面上执行操作

**影响版本:** FortiOS 7.2.0 - 7.2.1, 7.0.0 - 7.0.6; FortiProxy 7.2.0, 7.0.0 - 7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 需要网络访问目标Fortinet设备的管理界面

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-40684是一个Fortinet产品中的身份验证绕过漏洞。未经身份验证的攻击者可以通过特制的HTTP或HTTPS请求在管理界面上执行操作。

**漏洞利用有效性：**
根据提供的漏洞库信息，该漏洞的CVSS评分为9.8（严重），并且存在功能齐全的漏洞利用代码（Exploit Code Maturity: FUNCTIONAL）。CISA也将其添加到已知被利用的漏洞目录中，表明该漏洞在实际环境中被积极利用。提供的Python脚本似乎利用了`X-Forwarded-For`和`X-Forwarded-Vdom`头来绕过身份验证，并检索敏感信息，如管理员用户名、访问级别、序列号、版本以及LDAP配置。

**投毒风险分析：**

*   **README.md:**  `README.md` 文件仅包含简单的漏洞描述和使用说明，没有发现可疑代码。
*   **exploit.py:**  `exploit.py` 脚本本身旨在利用漏洞读取敏感信息，例如管理员用户名、密码配置文件和LDAP配置。脚本会将这些信息以JSON格式保存到文件中。虽然脚本的功能是信息泄露，但它本身并没有执行任何恶意代码或植入后门的功能。`validate_ip` 函数虽然名字叫做验证IP，但实际上的作用是验证 URL, 这点也需要注意。

虽然脚本本身没有明显的投毒代码，但是任何未经授权的漏洞利用都存在风险。利用此类漏洞获取的敏感信息可能被用于进一步的攻击，例如凭据盗用或横向移动。因此，在使用任何漏洞利用代码时，务必谨慎，并在受控环境中进行测试。

综合来看，该仓库存在投毒代码的可能性较低，但仍然建议人工审查漏洞利用代码，确保代码的安全性，避免在无意中执行恶意代码。并且该脚本存在错误验证函数, 可能导致被利用。

**漏洞利用方式：**

1.  攻击者构造包含特定的`X-Forwarded-For`、`X-Forwarded-Vdom`和`Host`头的HTTP/HTTPS请求。
2.  这些头信息被用于绕过身份验证检查。
3.  攻击者通过绕过身份验证后，可以访问`/api/v2/cmdb/system/admin/{username}`和`/api/v2/cmdb/user/ldap`等API端点。
4.  攻击者可以获取管理员用户名、访问级别、序列号、版本以及LDAP配置等敏感信息。
5.  获取的信息可被用于进一步攻击，例如尝试使用泄露的凭据登录或利用LDAP配置中的漏洞。

**项目地址:** [Anthony1500/CVE-2022-40684](https://github.com/Anthony1500/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)