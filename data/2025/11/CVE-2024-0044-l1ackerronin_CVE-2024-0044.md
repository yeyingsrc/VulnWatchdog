## CVE-2024-0044-Android PackageInstallerService权限提升

**漏洞编号:** CVE-2024-0044

**漏洞类型:** 权限提升

**影响应用:** Android

**危害等级:** 高危，可能导致本地权限提升

**影响版本:** Android 12, 12L, 13, 14, 15

**利用条件:** 需要ADB访问权限和Root权限

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-0044 是一个Android PackageInstallerService 中的权限提升漏洞。由于`PackageInstallerService.java`中的`createSessionInternal`方法对输入验证不当，可能导致攻击者可以以任何应用程序的身份运行。 这可能导致本地权限提升，而无需额外的执行权限。利用过程主要分为以下几个步骤：

1.  **APK推送:** 首先，将一个恶意的APK推送到目标设备的`/data/local/tmp/`目录下。
2.  **UID提取:** 提取目标应用程序的UID。
3.  **Payload生成:** 生成包含恶意负载的字符串，该负载利用`pm install`命令来模拟安装过程。
4.  **Payload执行:** 在`adb shell`中执行生成的payload。
5.  **run-as 利用:** 使用`run-as` 命令以目标应用的身份执行操作，进一步提取数据。
6.  **数据提取:** 使用`tar` 命令打包目标应用数据，然后使用`adb pull`命令将数据提取到攻击者设备。

**有效性评估：**
提供的POC代码似乎是有效的，因为它遵循了漏洞描述中提到的利用方式。通过推送恶意APK，伪造安装会话，并利用`run-as`命令，攻击者可以获得目标应用程序的权限。

**投毒风险评估：**
POC代码存在一定的投毒风险。虽然脚本的主要功能是利用漏洞，但脚本中也存在一些潜在的投毒点：
*   **恶意APK:** 脚本依赖于用户提供的APK文件，如果提供的APK文件本身包含恶意代码，则会导致设备被感染。
*   **payload.txt内容:** 脚本生成payload.txt 文件,如果payload构造不合理,可能导致设备崩溃或数据损坏。

总体而言，投毒风险较低，估计为10%。主要的风险在于用户提供的恶意APK。

**利用方式总结：**
CVE-2024-0044的利用方式是通过构造恶意的`PackageInstaller`会话来欺骗系统，使其认为攻击者拥有目标应用程序的权限。然后，攻击者可以使用`run-as`命令来执行操作，访问目标应用程序的数据目录。

**项目地址:** [l1ackerronin/CVE-2024-0044](https://github.com/l1ackerronin/CVE-2024-0044)

**漏洞详情:** [CVE-2024-0044](https://nvd.nist.gov/vuln/detail/CVE-2024-0044)