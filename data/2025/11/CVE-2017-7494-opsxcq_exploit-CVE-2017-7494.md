## CVE-2017-7494-Samba-远程代码执行

**漏洞编号:** CVE-2017-7494

**漏洞类型:** 远程代码执行

**影响应用:** Samba

**危害等级:** 高危，可能导致完全控制受影响的系统

**影响版本:** 3.5.0 <= 版本 < 4.6.4, 4.5.x < 4.5.10, 4.4.x < 4.4.14

**利用条件:** 需要可写共享目录的访问权限，以及有效的Samba用户账户。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2017-7494 (SambaCry) 漏洞允许经过身份验证的远程攻击者通过上传恶意共享库到可写的共享目录，然后触发服务器加载并执行它，从而执行任意代码。

**漏洞利用方式：**

1.  **身份验证：** 攻击者需要有效的 Samba 用户账户和密码才能连接到目标服务器。
2.  **上传恶意库：** 攻击者将编译好的恶意共享库（例如 `libbindshell-samba.so`）上传到服务器上具有写入权限的共享目录。
3.  **触发加载：** 攻击者使用特制的命名管道请求，诱使 Samba 服务器加载并执行上传的恶意库。

**POC有效性：**

提供的 Dockerfile 和 README.md 描述了一个可用于复现和利用 CVE-2017-7494 漏洞的环境。README.md 提供了明确的利用步骤，包括依赖项安装、Python 版本要求以及利用脚本的使用方法。因此，POC代码是有效的。

**投毒风险：**

虽然提供的代码描述了如何利用漏洞，但存在潜在的投毒风险。 `libbindshell-samba.so`是外部文件，如果不验证其来源和内容，可能包含恶意代码。 Dockerfile 中的构建步骤和配置看起来是标准的，但不能保证 `src` 目录下的源代码没有被篡改过,因此存在一定投毒风险, 风险大约为10%。主要集中在：

*   **恶意共享库 (libbindshell-samba.so):**  攻击者可能将恶意代码嵌入到共享库中，例如植入后门、执行恶意操作或窃取敏感信息。
*  **src目录：** 如果src目录中包含了恶意的configure脚本或者Makefile,有可能在编译时植入恶意代码。

**缓解措施：**

*   验证 `libbindshell-samba.so` 的来源，并使用杀毒软件或沙箱环境进行分析。
*   审查 `src` 目录下的源代码，确保其安全性。
*   使用最新版本的 Samba，其中已修复此漏洞。
*   限制对可写共享目录的访问权限。

**项目地址:** [opsxcq/exploit-CVE-2017-7494](https://github.com/opsxcq/exploit-CVE-2017-7494)

**漏洞详情:** [CVE-2017-7494](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)