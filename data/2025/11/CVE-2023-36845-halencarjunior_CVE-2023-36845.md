## CVE-2023-36845 - Juniper Junos OS J-Web PHP 外部变量修改导致远程代码执行

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP 外部变量修改

**影响应用:** Junos OS J-Web (EX 和 SRX 系列)

**危害等级:** 高危，未经身份验证的远程代码执行

**影响版本:** 受影响版本请参考漏洞库信息。

**利用条件:** 目标设备启用了 J-Web 管理界面，并且可以通过 HTTP 或 HTTPS 访问。

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2023-36845 是 Juniper Junos OS EX 和 SRX 系列设备 J-Web 管理界面中的一个 PHP 外部变量修改漏洞。未经身份验证的远程攻击者可以通过构造特制的请求，设置 PHPRC 变量来修改 PHP 执行环境，从而注入并执行恶意代码。

**利用方式：**
攻击者通过发送包含 `PHPRC` 参数的 HTTP 请求，将 PHP 的配置目录指向一个可以控制的文件，通常使用 `/dev/fd/0`，这意味着 PHP 将从请求体中读取配置信息。然后，攻击者在请求体中设置 `auto_prepend_file` 选项，使其包含恶意代码或者读取敏感文件。 提供的POC通过设置auto_prepend_file为/etc/passwd尝试读取用户，如果成功读取则判定为漏洞存在。

**有效性分析：**
根据漏洞描述和提供的 PoC 代码，该 PoC 能够有效验证漏洞的存在性。PoC 通过发送带有 PHPRC 参数的请求，并设置 auto_prepend_file 来尝试读取 `/etc/passwd` 文件，如果成功读取，则表明目标存在漏洞。

**投毒风险分析：**
PoC 代码主要用于检测漏洞是否存在，但依然存在一定投毒风险。

1.  **依赖库风险** PoC依赖shodan,censys, pyOpenSSL, colorama,urlopen等第三方库,如果这些库本身存在安全漏洞，可能被攻击者利用。不过这是常规风险。

2.  **配置信息泄露风险：** PoC 代码包含 Shodan API 密钥占位符。如果用户不小心将包含真实 API 密钥的 PoC 代码公开，可能导致 API 密钥泄露，被恶意使用。

3.  **扫描行为：** 使用该 PoC 进行大规模扫描可能被目标网络检测到，导致 IP 被封禁或其他安全措施。

4.  **Censysmod.py 模块：** 此模块主要用于从 Censys 搜索符合条件的主机，并将结果传递给漏洞验证函数。该模块自身未发现明显的恶意代码，但过度依赖外部API接口，可能成为利用点。

综上，投毒风险评估为20%。 主要风险在于滥用带来的暴露风险和对第三方库依赖风险。

**项目地址:** [halencarjunior/CVE-2023-36845](https://github.com/halencarjunior/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)