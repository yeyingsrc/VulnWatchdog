## CVE-2024-47167-Gradio-SSRF

**漏洞编号:** CVE-2024-47167

**漏洞类型:** SSRF

**影响应用:** Gradio

**危害等级:** 中危，可能导致内部服务信息泄露，任意文件读取。

**影响版本:** < 5.0

**利用条件:** Gradio应用启用了queue，且接受URL作为输入。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-47167是Gradio框架中存在的一个服务器端请求伪造（SSRF）漏洞，位于`/queue/join`端点。该漏洞源于Gradio的`async_save_url_to_cache`函数允许攻击者控制Gradio服务器发送HTTP请求到任意URL。

**有效性：**
提供的Docker Compose配置和Python代码似乎能够有效地演示该漏洞。`docker-compose.yml`文件设置了两个容器：`gradio_vuln`运行易受攻击的Gradio应用，`gradio_container`运行一个简单的HTTP服务器，模拟内部服务。 `gradio_vuln/app.py`定义了一个使用`gr.File`组件的Gradio界面，该组件允许用户上传文件或提供URL。由于使用了`demo.queue()`，启用了`/queue/join`端点，这使得利用SSRF成为可能。

**利用方式：**
1.  攻击者部署存在漏洞的Gradio应用 (版本 < 5.0).
2.  攻击者向Gradio应用的`/queue/join`端点发送包含恶意URL的请求。恶意URL指向攻击者控制的服务器或内部服务。
3.  Gradio服务器尝试获取恶意URL的内容，从而导致SSRF。
4.  如果URL指向内部服务（如`gradio_container`容器提供的HTTP服务），攻击者可以读取内部服务的信息，例如`company_security_creds.txt`文件，该文件包含敏感凭据，包括用户名、密码、AWS访问密钥和令牌。
5.  利用`analyze_image`函数，可以读取文件内容并将其作为字符串返回，这可能会泄露文件中的嵌入式秘密。

**投毒风险：**
虽然提供的代码主要目的是演示SSRF漏洞，但存在轻微的投毒风险，大约10%。风险点在于`gradio_vuln/app.py`中的 `analyze_image` 函数。它读取图像文件并将内容解码为字符串，而没有进行任何安全清理。如果用户上传包含恶意代码的图像，例如嵌入了shell脚本或恶意JavaScript代码的图片，则在读取和解码过程中，可能导致恶意代码在服务器端执行或者存储。

总结：此POC代码有效，展示了利用Gradio的SSRF漏洞来访问内部资源的可能性， 并且存在轻微的潜在投毒风险。

**项目地址:** [alexan011/CVE-2024-47167-Environment-Setup](https://github.com/alexan011/CVE-2024-47167-Environment-Setup)

**漏洞详情:** [CVE-2024-47167](https://nvd.nist.gov/vuln/detail/CVE-2024-47167)