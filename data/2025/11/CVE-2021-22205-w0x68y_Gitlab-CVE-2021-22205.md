## CVE-2021-22205 - GitLab ExifTool 远程命令执行

**漏洞编号:** CVE-2021-22205

**漏洞类型:** 远程命令执行

**影响应用:** GitLab

**危害等级:** 高危，未经身份验证的远程命令执行

**影响版本:** >=11.9, <13.8.8; >=13.9, <13.9.6; >=13.10, <13.10.3

**利用条件:** 目标GitLab实例可网络访问

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2021-22205 漏洞存在于 GitLab CE/EE 版本中，允许未经身份验证的攻击者执行远程命令。该漏洞的根本原因是 GitLab 没有正确验证传递给 ExifTool 文件解析器的图像文件。攻击者可以通过上传特制的恶意图像文件，利用 ExifTool 的命令注入漏洞执行任意命令。

**有效性：** 提供的 Python 脚本 `CVE-2021-22205-check.py` 是一个有效的 PoC 脚本，用于检测和利用该漏洞。它通过上传一个包含恶意 Exif 元数据的特制图像文件来实现远程命令执行。该脚本会尝试获取 CSRF token，然后上传包含恶意命令的图像。

**投毒风险：** 经过分析，提供的代码仓库中未发现明显的投毒代码。脚本的功能明确，且没有发现隐藏的恶意行为。PoC脚本中执行的命令，由使用者`-c`参数指定，属于正常的功能验证，而非投毒。

**利用方式：**

1.  **漏洞触发：** 攻击者需要向存在漏洞的 GitLab 实例上传包含恶意 Exif 元数据的图像文件。
2.  **命令注入：** 恶意元数据被 ExifTool 处理时，会导致命令注入，从而执行攻击者指定的命令。
3.  **未授权访问：** 此漏洞无需身份验证即可利用，大大降低了攻击门槛。
4.  **RCE：** 成功利用此漏洞后，攻击者可以在 GitLab 服务器上执行任意命令，从而控制服务器。

**项目地址:** [w0x68y/Gitlab-CVE-2021-22205](https://github.com/w0x68y/Gitlab-CVE-2021-22205)

**漏洞详情:** [CVE-2021-22205](https://nvd.nist.gov/vuln/detail/CVE-2021-22205)