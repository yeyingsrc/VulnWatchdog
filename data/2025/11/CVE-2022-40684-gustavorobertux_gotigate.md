## CVE-2022-40684 - FortiOS/FortiProxy/FortiSwitchManager 身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，可能导致完全控制受影响的设备

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标设备必须运行受影响的FortiOS、FortiProxy或FortiSwitchManager版本，且管理界面可通过HTTP/HTTPS访问。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2022-40684 是 Fortinet FortiOS、FortiProxy 和 FortiSwitchManager 中的一个身份验证绕过漏洞。该漏洞允许未经身份验证的攻击者通过精心制作的 HTTP 或 HTTPS 请求在管理界面上执行操作。

**漏洞利用方式：**

POC 代码 `gotigate` 是一个 Go 程序，用于利用 CVE-2022-40684 漏洞。它通过发送带有特定 HTTP 头部（例如 `Host`, `forwarded`, `x-forwarded-vdom`）的 GET 请求到 `/api/v2/cmdb/system/admin` 端点来绕过身份验证。这些头部欺骗服务器，使其认为请求来自受信任的来源。

具体来说，该代码设置了以下头部：
*   `Host`: 设置为 `127.0.0.1:9980`，可能旨在绕过某些主机名验证。
*   `forwarded`: 模拟请求经过代理，指示原始请求来自本地地址，协议为 HTTP。
*   `x-forwarded-vdom`: 设置为 `root`，指示请求针对根虚拟域。

通过组合这些头部，攻击者可以绕过身份验证并访问管理界面，从而可能执行任意操作。

**有效性：**

根据漏洞库信息和提供的 POC 代码，该漏洞利用是有效的。漏洞库中的 CVSS 评分表明这是一个严重漏洞，利用代码成熟度为“功能性”，意味着存在可用的、有效的利用代码。CISA 将其添加到已知被利用的漏洞目录中也证实了这一点。

**投毒风险：**

查看`main.go`文件,代码比较简单, 主要就是发送了一个GET请求,没有发现恶意的行为。`README.md`只是说明了该工具的使用方法。综上，该存储库中存在作者隐藏的投毒代码可能性较低，因此判定投毒风险极低，大概为1%。

**项目地址:** [gustavorobertux/gotigate](https://github.com/gustavorobertux/gotigate)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)