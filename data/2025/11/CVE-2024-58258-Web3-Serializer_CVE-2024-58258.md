## CVE-2024-58258 - SugarCRM SSRF/Local File Disclosure

**漏洞编号:** CVE-2024-58258

**漏洞类型:** SSRF/Local File Disclosure

**影响应用:** SugarCRM

**危害等级:** 高危，可能导致敏感信息泄露、内部系统访问

**影响版本:** < 13.0.4, 14.x < 14.0.1

**利用条件:** 需要目标系统存在漏洞版本，且允许未授权网络访问/css/preview接口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2024-58258 漏洞存在于 SugarCRM 的 `/css/preview` API 接口，由于对用户提供的 GET 参数未进行充分过滤，导致攻击者可以通过注入 LESS 代码，实现 SSRF（服务器端请求伪造）或本地文件读取。 

**利用方式：**
1. 攻击者构造包含 `@import` 指令的恶意 LESS 代码，其中 `@import` 指令指向目标 URL（SSRF）或本地文件路径（本地文件读取）。
2. 将构造的 LESS 代码作为 `param` 参数的值，发送到 `/rest/v10/css/preview` 接口。
3. SugarCRM 服务器解析 LESS 代码，并执行 `@import` 指令，从而发起请求或读取文件。
4. 攻击者从响应中提取目标 URL 的内容或本地文件的内容。

**有效性：**
根据漏洞库信息和提供的 POC 代码，该漏洞的利用是有效的。POC 代码提供了一个完整的利用流程，包括漏洞检测、SSRF 攻击和本地文件读取。

**投毒风险：**
对 POC 代码的分析显示，主要风险来自于 `file_or_url`参数。如果使用者没有仔细审核该参数，攻击者可以在利用代码中将`file_or_url`参数设置成恶意的地址，诱导使用者访问恶意网站，执行恶意代码等。此外，POC 代码中存在禁用 SSL 证书验证的设置 (`requests.packages.urllib3.disable_warnings()`, `verify=False`)，这在真实攻击场景中可能被利用，虽然本身不是投毒，但是增加了安全风险。整体而言，投毒风险较低，大概在 10% 左右，主要集中在使用者的不当操作上，而非代码本身的恶意逻辑。

**项目地址:** [Web3-Serializer/CVE-2024-58258](https://github.com/Web3-Serializer/CVE-2024-58258)

**漏洞详情:** [CVE-2024-58258](https://nvd.nist.gov/vuln/detail/CVE-2024-58258)