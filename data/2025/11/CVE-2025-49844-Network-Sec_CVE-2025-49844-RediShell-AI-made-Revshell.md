## CVE-2025-49844 Redis Lua Use-After-Free 远程代码执行

**漏洞编号:** CVE-2025-49844

**漏洞类型:** Use-After-Free

**影响应用:** Redis

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** < 8.2.2

**利用条件:** 需要Redis实例开启Lua脚本功能，并且攻击者需要已认证的用户权限（LOW Privileges Required）。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2025-49844是Redis中Lua脚本引擎的一个Use-After-Free漏洞。该漏洞允许经过身份验证的用户利用特制的Lua脚本操纵垃圾回收器，从而触发释放后使用，并可能导致远程代码执行。漏洞存在于所有支持Lua脚本的Redis版本中，但在8.2.2版本中已修复。

**有效性评估：**
提供的PoC代码（`exploit.py`）尝试利用此漏洞。代码包含以下几个关键部分：

1.  **Shellcode生成：**  `build_shellcode`函数用于生成一个反向TCP shell的shellcode，该shellcode会连接回攻击者的IP地址和端口。  这段shellcode用于执行反向shell。
2.  **Redis连接：**  `connect`函数用于连接到Redis实例，并验证连接。
3.  **版本检测：**  `is_vulnerable`函数用于检测Redis服务器的版本，以确认其是否容易受到攻击。

由于未提供完整的`is_vulnerable` 函数，目前无法确定是否存在完整的版本对比。

**投毒风险评估：**

虽然`exploit.py`中包含shellcode生成功能，以及连接和版本检测功能，但仍存在一定的风险：

*   **来源不明：** 该代码的来源标注为AI生成，未经充分测试，这意味着其中可能存在缺陷或错误。特别是涉及内存操作和shellcode生成，需要进一步验证以确保其可靠性和安全性。
*   **依赖关系：** 该脚本依赖于`redis` Python库。如果攻击者能够控制安装的`redis`库的版本，则可能引入恶意代码。
*   **Shellcode Payload：** Shellcode本身是否会执行恶意操作，需要仔细审查。

总体来说，投毒风险较低，可能为10%，因为只是提供了框架，具体功能取决于如何完善和使用它，以及shellcode的编写。需要对shellcode进行安全审计，以确保其安全性。

**利用方式：**

1.  **连接Redis服务器：** 使用提供的脚本连接到目标Redis服务器。
2.  **身份验证：** 如果Redis服务器需要密码，请提供正确的密码。
3.  **版本检查：** 脚本会尝试检查Redis服务器的版本，以确定其是否容易受到攻击。这段代码是用来确定目标是否在受影响的版本范围内。
4.  **执行Lua脚本：**如果Redis实例存在漏洞，且Lua脚本功能未被禁用，攻击者可以执行包含恶意Lua代码的脚本，该脚本会触发Use-After-Free漏洞。
5.  **远程代码执行：** 成功触发漏洞后，攻击者可以执行任意代码，例如反向shell。

**缓解措施：**

*   升级到Redis 8.2.2或更高版本。
*   使用ACL限制对`EVAL`和`EVALSHA`命令的访问，以防止用户执行Lua脚本。
*   禁用Lua脚本功能（如果不需要）。

**项目地址:** [Network-Sec/CVE-2025-49844-RediShell-AI-made-Revshell](https://github.com/Network-Sec/CVE-2025-49844-RediShell-AI-made-Revshell)

**漏洞详情:** [CVE-2025-49844](https://nvd.nist.gov/vuln/detail/CVE-2025-49844)