## CVE-2021-40438 - Apache mod_proxy SSRF

**漏洞编号:** CVE-2021-40438

**漏洞类型:** SSRF (Server Side Request Forgery)

**影响应用:** Apache HTTP Server

**危害等级:** 高危，可能导致敏感信息泄露、内部网络探测、甚至远程代码执行（取决于内部系统的配置）

**影响版本:** <= 2.4.48

**利用条件:** 目标服务器启用了mod_proxy模块，且存在不当配置允许用户控制请求URI路径。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2021-40438 是 Apache HTTP Server 2.4.48 及之前版本中 mod_proxy 模块的一个 SSRF 漏洞。攻击者可以通过构造恶意的 URI 路径，使 Apache 服务器将请求转发到由攻击者控制的任意服务器。提供的 POC 代码是一个 Dockerized 的环境，用于演示该漏洞。 

**有效性:**
从漏洞库信息和 POC 代码来看，此漏洞是真实存在的，并且已经有公开的利用方式。POC代码提供了一个可复现的环境，有助于验证漏洞。根据CISA的公告，该漏洞已被积极利用。

**投毒风险:**
提供的 POC 代码主要由以下文件组成：
*   `LICENSE`: MIT 许可证，表明作者允许自由使用和修改代码。
*   `README.md`: 简要介绍了 POC 的用途。
*   `docker-compose.yml`: 定义了 PHP 和 Apache 两个服务，通过 Docker 容器来搭建测试环境。
*   `php/Dockerfile`: 定义了 PHP 服务的构建过程，使用 PHP 8.0-cli 镜像，并运行一个简单的 phpinfo() 服务。
*   `php/server.php`: 一个简单的 PHP 文件，用于显示 phpinfo() 信息。
*   `apache/Dockerfile`: 定义了 Apache 服务的构建过程，使用 httpd:2.4.48 镜像，并配置了 httpd.conf 和 vhost.conf 文件。
*   `apache/httpd.conf`: Apache 的主配置文件，用于配置服务器的基本参数。
*   `apache/vhost.conf`: 虚拟主机配置文件，用于配置反向代理规则。

代码中没有明显的恶意代码或后门，但存在一定的风险：
1.  `docker-compose.yml` 文件可能会从 Docker Hub 拉取镜像。如果 Docker Hub 上的官方镜像被篡改，则可能引入恶意代码。
2.  `apache/vhost.conf` 文件的配置决定了反向代理规则。不正确的配置可能会导致其他安全问题，例如开放不必要的端口或暴露敏感信息。 

因此，虽然 POC 代码本身没有明显的投毒，但使用时仍需谨慎，特别是从不受信任的来源获取时。由于代码主要用于演示和复现漏洞，不太可能有隐藏的恶意后门。但是，在实际环境中部署和使用这些代码之前，务必进行代码审计和安全评估。

**利用方式:**
利用方式主要是通过精心构造包含目标服务器地址的URI路径，发送给存在漏洞的Apache服务器。该服务器如果配置了反向代理，会将请求转发到攻击者指定的目标服务器上，从而实现SSRF攻击。具体来说，攻击者可以控制反向代理的目标地址，进而读取内部服务或向内部服务发送恶意请求。


**项目地址:** [ericmann/apache-cve-poc](https://github.com/ericmann/apache-cve-poc)

**漏洞详情:** [CVE-2021-40438](https://nvd.nist.gov/vuln/detail/CVE-2021-40438)