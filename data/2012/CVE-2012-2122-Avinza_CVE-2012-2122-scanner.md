## CVE-2012-2122-MySQL/MariaDB身份验证绕过

**漏洞编号:** CVE-2012-2122

**漏洞类型:** 身份验证绕过

**影响应用:** MySQL/MariaDB

**危害等级:** 高危，可能导致未经授权的数据库访问

**影响版本:** MySQL 5.1.x (< 5.1.63), 5.5.x (< 5.5.24), 5.6.x (< 5.6.6), MariaDB 5.1.x (< 5.1.62), 5.2.x (< 5.2.12), 5.3.x (< 5.3.6), 5.5.x (< 5.5.23)

**利用条件:** 需要目标MySQL/MariaDB服务器存在漏洞，并且攻击者能够建立网络连接到数据库端口 (通常是3306)。漏洞的触发还依赖于特定的memcmp实现。

**POC 可用性:** 是

**投毒风险:** 1%

## 详情

CVE-2012-2122 漏洞存在于 MySQL 和 MariaDB 的 `sql/password.c` 文件中。当服务器运行在某些环境中，使用了存在缺陷的 `memcmp` 函数实现时，远程攻击者可以通过重复使用相同的错误密码进行身份验证来绕过身份验证。由于 `memcmp` 函数的返回值未被正确检查，导致token比较最终会成功。提供的 `scan.php` 脚本尝试利用此漏洞。它首先扫描指定 CIDR 块内的 IP 地址，尝试连接到 3306 端口。对于接受连接的主机，脚本会重复尝试使用错误的 'root' 密码登录，利用漏洞绕过身份验证，如果成功绕过验证，则dump `mysql.user`表中的用户和密码哈希值。代码风险较低，主要为扫描和漏洞利用，但如果扫描行为被滥用，可能导致拒绝服务或触发安全警报。该脚本缺少错误处理和输入验证，存在一定风险。

漏洞利用方式总结：

1.  **网络扫描：**  脚本扫描指定IP地址段，寻找开放3306端口的MySQL/MariaDB服务器。
2.  **身份验证绕过尝试：**  对每个目标服务器，脚本尝试使用错误的密码（'root' + 随机字符串）重复登录，利用`memcmp`缺陷。
3.  **数据提取：**  如果身份验证绕过成功，脚本执行SQL查询 `SELECT user,password from mysql.user`，尝试提取用户凭据。

**项目地址:** [Avinza/CVE-2012-2122-scanner](https://github.com/Avinza/CVE-2012-2122-scanner)

**漏洞详情:** [CVE-2012-2122](https://nvd.nist.gov/vuln/detail/CVE-2012-2122)