## CVE-2023-46604 - Apache ActiveMQ OpenWire 反序列化RCE

**漏洞编号:** CVE-2023-46604

**漏洞类型:** 反序列化RCE

**影响应用:** Apache ActiveMQ

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** < 5.15.16, < 5.16.7, < 5.17.6, < 5.18.3

**利用条件:** 需要网络访问ActiveMQ Broker，且OpenWire协议启用（默认端口61616）。利用过程无需认证。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-46604 是 Apache ActiveMQ 中 Java OpenWire 协议编组器中的一个远程代码执行漏洞。攻击者可以通过操纵 OpenWire 协议中的序列化类类型，使客户端或 Broker 实例化类路径上的任何类，从而在基于 Java 的 OpenWire Broker 或客户端上执行任意 shell 命令。提供的PoC代码主要是一个安全设计项目，包含漏洞解释、检测和缓解的设计方案，而不是直接的漏洞利用代码。虽然它不直接提供exp，但描述了利用方式和检测方法，为漏洞利用提供了理论基础。

**有效性评估：**
由于该项目主要关注检测和缓解，提供的代码本身并非直接可用的exploit，但它验证了漏洞的存在和可利用性，提供思路。

**投毒风险评估：**
该项目虽然主要侧重于防御，但由于包含检测方法，可能被攻击者逆向分析用于绕过检测。漏洞库中包含外部参考packetstormsecurity，如果攻击者能够从packetstormsecurity获取漏洞，再结合项目代码，可以构造更复杂的投毒攻击。因此，投毒风险评定为10%，主要考虑是理论上攻击者可以利用防御方案来优化攻击。

**漏洞利用方式：**
1.  **攻击向量：** 通过网络访问 ActiveMQ Broker 的 OpenWire 端口 (61616)。
2.  **漏洞触发：** 发送特制的 OpenWire 消息，其中包含恶意序列化的 Java 对象。
3.  **利用原理：** ActiveMQ 在反序列化过程中，由于没有充分的类型验证，会实例化攻击者指定的类。
4.  **代码执行：** 攻击者可以利用已知的 Java 反序列化漏洞链（如 Commons Collections），或者直接利用存在于 ActiveMQ 类路径上的危险类，来执行任意代码。
5.  **无需认证：** 此漏洞无需任何身份验证，任何能访问 OpenWire 端口的攻击者都可以利用。

**缓解措施：**
升级到 5.15.16、5.16.7、5.17.6 或 5.18.3 及更高版本是最佳的缓解方法。还可以通过网络策略限制对 OpenWire 端口的访问，并考虑禁用 OpenWire 协议。

**项目地址:** [vaishnavucv/Project-Vuln-Detection-N-Mitigation_101](https://github.com/vaishnavucv/Project-Vuln-Detection-N-Mitigation_101)

**漏洞详情:** [CVE-2023-46604](https://nvd.nist.gov/vuln/detail/CVE-2023-46604)