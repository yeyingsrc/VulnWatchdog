## CVE-2023-36845 Juniper Junos OS J-Web PHP 外部变量修改漏洞

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP 外部变量修改

**影响应用:** Junos OS (EX Series, SRX Series) J-Web

**危害等级:** 高危，允许未经身份验证的远程代码执行

**影响版本:** 受影响版本包括但不限于 20.4R3-S9 之前的所有版本，21.1R1 及其之后版本，以及 23.2R1-S1, 23.2R2 之前的 21.2、21.3、21.4、22.1、22.2、22.3、22.4 版本。

**利用条件:** 需要启用 J-Web 且可通过 HTTP 或 HTTPS 访问。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞存在于 Juniper Junos OS 的 J-Web 组件中，允许未经身份验证的攻击者通过修改 PHP 的 `PHPRC` 环境变量来远程执行代码。攻击者通过构造包含恶意 `PHPRC` 变量的 HTTP 请求，可以控制 PHP 的配置，从而注入并执行恶意代码。

**利用方式：**

1.  攻击者发送带有 `PHPRC` 参数的特制 HTTP 请求到目标设备的 J-Web 接口。
2.  `PHPRC` 参数指向一个包含恶意 PHP 代码的文件（例如，`/etc/passwd`，POC 中尝试读取该文件以验证漏洞是否存在）。
3.  J-Web 在处理请求时，会使用攻击者提供的 `PHPRC` 值来配置 PHP 解释器。
4.  PHP 解释器执行恶意 PHP 代码，导致远程代码执行。

**POC 代码分析：**

提供的 Ansible Playbook 旨在检测目标设备是否存在 CVE-2023-36845 漏洞。

*   它首先尝试通过 HTTP 和 HTTPS 连接到目标设备 (端口 80 和 443)。
*   它发送一个 POST 请求，其中包含 `PHPRC=/dev/fd/0` 和 `auto_prepend_file=/etc/passwd` 作为请求体，`auto_prepend_file` 用于在 PHP 脚本执行前包含指定的文件。
*  `/dev/fd/0` 表示标准输入,结合`auto_prepend_file`则表示将POST请求的内容作为php文件来解析. *   如果响应状态码为 200 且响应内容包含 'root:' 字符串（`/etc/passwd` 文件的内容），则该设备被认为可能存在漏洞。

**有效性评估：**

POC 代码通过修改 `PHPRC` 变量，并结合 `auto_prepend_file` 读取敏感文件来验证漏洞的存在。 这种方式能够有效检测漏洞。根据漏洞信息，利用成功可导致远程代码执行，POC中只是验证漏洞的存在性。

**投毒风险评估：**

该 Ansible Playbook 的目的是检测漏洞，没有发现植入后门或执行恶意操作的代码。因此，投毒风险较低 (0%)。


**项目地址:** [P4x1s/ansible-cve-2023-36845](https://github.com/P4x1s/ansible-cve-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)