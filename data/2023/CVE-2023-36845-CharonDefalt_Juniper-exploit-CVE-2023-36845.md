## CVE-2023-36845-Junos OS J-Web PHP 外部变量修改导致远程代码执行

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP 外部变量修改

**影响应用:** Junos OS J-Web (EX Series and SRX Series)

**危害等级:** 严重，可导致远程代码执行

**影响版本:** 受影响版本包括但不限于 20.4R3-S9 之前的所有版本，21.1R1 及之后版本，以及 23.2R2 及之前版本。

**利用条件:** 目标设备开启了 J-Web 服务，可以通过 HTTP 或 HTTPS 访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞是由于 Juniper Junos OS EX 系列和 SRX 系列的 J-Web 界面中存在 PHP 外部变量修改漏洞。攻击者可以通过构造特殊的请求，设置 PHPRC 变量来修改 PHP 的执行环境，从而注入并执行恶意代码。

**有效性：** 提供的 POC 代码有效。脚本首先检查目标是否存在漏洞，通过发送包含 `PHPRC=/dev/fd/0` 的 POST 请求，并验证响应中是否包含 `/etc/passwd` 的内容来判断。

**投毒风险：** 仓库的投毒风险较低（10%）。主要风险在于利用上传文件方式getshell中，如果恶意使用者上传恶意文件，将会对其他使用者造成安全威胁。

**利用方式：**

1.  **通过 PHPRC 变量修改 PHP 配置：** 利用 `PHPRC` 变量，攻击者可以控制 PHP 的配置文件，例如设置 `auto_prepend_file` 来包含远程或本地文件。
2.  **远程代码执行：** 通过 `auto_prepend_file` 包含恶意 PHP 代码，例如使用 `data://` 协议嵌入 `phpinfo()` 或执行系统命令。
3.  **文件上传：** 通过 J-Web 的文件上传功能上传包含恶意代码的 PHP 文件，然后通过 `auto_prepend_file` 包含该文件执行。

**详细利用步骤如下：**

*   发送带有 `PHPRC` 参数的 HTTP 请求，将 PHP 配置文件指向 `/dev/fd/0`，允许从标准输入读取配置。
*   通过 `--data-binary` 参数传递恶意 PHP 配置，例如设置 `allow_url_include=1` 和 `auto_prepend_file` 指向包含恶意代码的 data URI。
*   如果目标启用了文件上传功能，可以上传包含恶意代码的 PHP 文件，并通过 `auto_prepend_file` 包含该文件。

需要注意的是，要成功利用此漏洞，目标设备必须满足以下条件：

*   启用了 J-Web 服务。
*   允许通过 HTTP 或 HTTPS 访问 J-Web 界面。
*   存在受影响的 Junos OS 版本。

**项目地址:** [CharonDefalt/Juniper-exploit-CVE-2023-36845](https://github.com/CharonDefalt/Juniper-exploit-CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)