## CVE-2023-36845-Junos-J-Web远程代码执行

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP外部变量修改导致远程代码执行

**影响应用:** Junos OS J-Web

**危害等级:** 严重，未经身份验证的远程代码执行

**影响版本:** 受影响版本包括但不限于：20.4R3-S9之前的所有版本，21.1版本21.1R1及更高版本，21.2版本21.2R3-S7之前的所有版本，21.3版本21.3R3-S5之前的所有版本，21.4版本21.4R3-S5之前的所有版本，22.1版本22.1R3-S4之前的所有版本，22.2版本22.2R3-S2之前的所有版本，22.3版本22.3R2-S2, 22.3R3-S1之前的所有版本，22.4版本22.4R2-S1, 22.4R3之前的所有版本，23.2版本23.2R1-S1, 23.2R2之前的所有版本。

**利用条件:** 需要开启J-Web服务，且攻击者可以网络访问到目标设备的J-Web界面。需要配置 [system services web-management http] 或 [system services web-management https]。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-36845 是 Juniper Junos OS 中 J-Web 界面存在的一个 PHP 外部变量修改漏洞。未经身份验证的攻击者可以通过发送特制的请求，设置 `PHPRC` 变量，从而修改 PHP 的执行环境，最终实现远程代码执行。

**利用方式：**

1.  攻击者构造一个 HTTP POST 请求，其中包含 `PHPRC` 和 `auto_prepend_file` 两个参数。
2.  `PHPRC` 参数用于指定一个包含 PHP 配置指令的文件，这里被设置为 `/dev/fd/0`，表示从标准输入读取配置。
3.  `auto_prepend_file` 参数指定一个在 PHP 脚本执行之前自动包含的文件，这里设置为 `/etc/passwd\n`。由于 `PHPRC` 被设置为从标准输入读取配置，`auto_prepend_file` 的内容实际上被当作 PHP 配置指令来处理。`\n` 用于分割指令。
4. 由于/etc/passwd不是php文件会被当作php指令执行

POC代码的功能是读取/etc/passwd的内容，可以修改为其他php指令以执行其他操作。

**有效性：**

根据漏洞描述和提供的 POC 代码，该漏洞利用是有效的。POC通过设置 PHPRC 环境变量来修改 PHP 运行时配置，从而允许包含任意文件，最终导致远程代码执行。

**投毒风险：**

查看POC代码，只包含漏洞利用代码，未发现隐藏的恶意功能或后门，因此投毒风险较低。

**总而言之，该漏洞危害性高，利用简单，需要尽快修复。**

**项目地址:** [cyberh3als/CVE-2023-36845-POC](https://github.com/cyberh3als/CVE-2023-36845-POC)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)