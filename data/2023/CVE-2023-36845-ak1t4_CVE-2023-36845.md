## CVE-2023-36845-Juniper-J-Web-RCE

**漏洞编号:** CVE-2023-36845

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Juniper Junos OS J-Web

**危害等级:** 严重，未经身份验证的攻击者可以远程执行代码

**影响版本:** 受影响版本包括：20.4R3-S9之前的版本，21.1R1及之后的21.1版本，21.2R3-S7之前的21.2版本，21.3R3-S5之前的21.3版本，21.4R3-S5之前的21.4版本，22.1R3-S4之前的22.1版本，22.2R3-S2之前的22.2版本，22.3R2-S2和22.3R3-S1之前的22.3版本，22.4R2-S1和22.4R3之前的22.4版本，23.2R1-S1和23.2R2之前的23.2版本。

**利用条件:** 目标系统需要启用J-Web服务 (http 或 https)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36845 漏洞是 Juniper Junos OS EX 系列和 SRX 系列的 J-Web 界面中的 PHP 外部变量修改漏洞。攻击者可以通过构造特制的请求，设置 PHPRC 变量来修改 PHP 执行环境，从而注入并执行任意代码。

**有效性分析：**

提供的 POC 代码 `cve-2023-36845.sh` 脚本通过发送带有 `PHPRC` 参数的 HTTP 请求到目标设备的 `/about.php` 页面来利用此漏洞。`PHPRC` 参数被设置为 `/dev/fd/0`，这意味着 PHP 将从文件描述符 0（标准输入）读取配置。然后，脚本通过 POST 请求发送 `auto_prepend_file=/etc/passwd` 作为数据，这会导致 PHP 在执行任何其他代码之前，先包含 `/etc/passwd` 文件。如果服务器存在漏洞，响应将包含 `/etc/passwd` 文件的内容，表明漏洞成功利用。

**投毒风险分析：**

该脚本本身旨在检测漏洞，并尝试读取 `/etc/passwd` 文件。虽然脚本会对目标系统造成一定的敏感信息泄露（/etc/passwd），但没有明显的恶意代码或后门植入行为，初步判断投毒概率较低，但是不能排除存在攻击者上传恶意文件的可能，因为具备了远程代码执行能力。
脚本中存在通过 curl 下载目标证书的 issuer 和 subject 信息，攻击者可以在日志中找到这些信息，存在一定的隐私泄露风险。

**利用方式：**

1.  **确定目标：** 找到运行受影响的 Junos OS 版本的 EX 系列或 SRX 系列设备，且启用了 J-Web 服务。
2.  **发送特制请求：** 使用 POC 脚本或类似工具，向目标设备的 `/about.php` 页面发送包含 `PHPRC` 参数的 HTTP 请求。例如：`curl -ksS --data-binary 'auto_prepend_file="/etc/passwd"' --max-time 15 "http://<target_ip>/about.php?PHPRC=/dev/fd/0"`
3.  **验证漏洞：** 检查响应是否包含 `/etc/passwd` 文件的内容。如果包含，则表示设备存在漏洞。
4.  **进一步利用：** 成功利用漏洞后，攻击者可以执行任意代码，例如上传 webshell、修改系统配置等，从而完全控制设备。

**项目地址:** [ak1t4/CVE-2023-36845](https://github.com/ak1t4/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)