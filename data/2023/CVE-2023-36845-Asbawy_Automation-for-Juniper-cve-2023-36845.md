## CVE-2023-36845-Juniper-J-Web-PHP外部变量修改导致RCE

**漏洞编号:** CVE-2023-36845

**漏洞类型:** PHP外部变量修改导致RCE

**影响应用:** Juniper Junos OS J-Web (EX系列和SRX系列)

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 受影响版本包括20.4R3-S9之前的所有版本，21.1版本从21.1R1开始，以及21.2R3-S7、21.3R3-S5、21.4R3-S5、22.1R3-S4、22.2R3-S2、22.3R2-S2, 22.3R3-S1、22.4R2-S1, 22.4R3、23.2R1-S1, 23.2R2之前的版本。

**利用条件:** 需要启用J-Web（通过HTTP或HTTPS）并且能够网络访问。

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-36845 漏洞是 Juniper Junos OS 的 J-Web 组件中存在的 PHP 外部变量修改漏洞。攻击者可以通过发送特制的HTTP请求，设置 `PHPRC` 环境变量来修改PHP的执行环境，从而注入并执行任意代码。该漏洞允许未经身份验证的远程攻击者执行任意代码。

**利用方式：**

1.  攻击者发送一个包含 `PHPRC` 参数的HTTP请求到目标设备的 J-Web 接口。
2.  `PHPRC` 参数的值被设置为指向一个包含恶意PHP代码的文件或数据流（例如，`/dev/fd/0`，结合`auto_prepend_file` 读取HTTP body的内容）。
3.  当J-Web处理请求时，PHP会使用攻击者提供的 `PHPRC` 配置，从而执行恶意代码。

提供的PoC代码 (`cve-2023-36845.sh`) 尝试通过以下步骤验证漏洞：

1.  循环遍历IP地址列表。
2.  对于每个IP地址，构造一个包含 `PHPRC` 参数的 HTTPS 请求，并将 `auto_prepend_file` 设置为 `/etc/passwd`。目的是通过读取 `/etc/passwd` 文件来判断目标系统是否易受攻击。
3.  如果响应包含 `root:` 字符串，则认为目标易受攻击。

**有效性：**

该PoC代码**有效**，因为它准确地利用了 `PHPRC` 环境变量修改漏洞的原理。通过设置`auto_prepend_file`读取敏感文件来判断是否存在漏洞。

**投毒风险：**

投毒风险评估为10%。虽然PoC本身旨在验证漏洞，但存在以下潜在的投毒风险：

1.  **输出重定向：** `save_output` 函数将 vulnerable 的结果附加到 `output.txt` 文件中。攻击者可能会修改该函数以包含恶意命令，例如将受害者的IP地址发送到恶意服务器，或者上传其他恶意文件到受害者。
2.  **依赖关系：** 该脚本依赖于 `curl` 命令。如果目标系统上安装了被篡改的 `curl` 版本，可能会导致恶意代码执行。
3.  **后门植入：** 攻击者可能会修改 PoC 代码，在检测到漏洞后植入后门，例如创建一个新的用户帐户或修改 SSH 配置。
4.  **社工风险：** 即使代码本身没有恶意行为，也可能被用于社工攻击。攻击者可以伪装成安全研究人员，诱骗用户运行该脚本，从而获取敏感信息。

总的来说，该PoC代码主要用于检测，但仍需仔细审查，防范潜在的投毒风险。

**项目地址:** [Asbawy/Automation-for-Juniper-cve-2023-36845](https://github.com/Asbawy/Automation-for-Juniper-cve-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)