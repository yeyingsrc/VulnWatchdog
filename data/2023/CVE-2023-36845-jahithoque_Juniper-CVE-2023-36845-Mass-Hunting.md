## CVE-2023-36845-Junos OS-PHP外部变量修改导致RCE

**漏洞编号:** CVE-2023-36845

**漏洞类型:** 远程代码执行

**影响应用:** Junos OS (EX Series, SRX Series)

**危害等级:** 严重，允许未经身份验证的远程攻击者执行代码

**影响版本:** 受影响版本包括但不限于：20.4R3-S9之前的所有版本，21.1，21.2R3-S7之前的所有版本，21.3R3-S5之前的所有版本，21.4R3-S5之前的所有版本，22.1R3-S4之前的所有版本，22.2R3-S2之前的所有版本，22.3R2-S2, 22.3R3-S1之前的所有版本，22.4R2-S1, 22.4R3之前的所有版本，23.2R1-S1, 23.2R2之前的所有版本。

**利用条件:** 需要开启J-Web，且可以通过网络访问J-Web服务 (http 或 https)

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2023-36845 是 Juniper Networks Junos OS 的 J-Web 组件中的一个 PHP 外部变量修改漏洞。攻击者可以通过构造恶意请求，设置 `PHPRC` 环境变量来修改 PHP 的执行环境，从而注入并执行任意代码。

**漏洞利用方式：**

1.  **攻击向量：** 网络
2.  **攻击条件：** 目标设备必须运行受影响版本的 Junos OS，并且启用了 J-Web 管理界面 (http 或 https)。
3.  **漏洞原理：** 通过 `PHPRC` 环境变量，指定一个包含恶意 PHP 代码的文件。由于 J-Web 对该变量的过滤不严，导致 PHP 在执行时会加载并执行该文件，从而实现远程代码执行。
4.  **POC 分析：** 提供的 `Juniper-RCE-Check.sh` 脚本通过发送包含恶意 `PHPRC` 参数的 HTTP 请求到 `/about.php` 页面，其中PHPRC的值被设置为 `/dev/fd/0`，并使用`auto_prepend_file` 尝试将 `/etc/passwd` 的内容包含到响应中。如果响应中包含 `root:` 字符串，则表示目标存在漏洞，攻击者可以利用此漏洞执行任意代码。

**投毒风险分析：**

提供的 `Juniper-RCE-Check.sh` 脚本的功能是检测目标是否存在 CVE-2023-36845 漏洞，而不是进行漏洞利用或植入后门。该脚本只是通过 `curl` 命令发送一个 HTTP 请求，并检查响应的内容。其中使用的`/etc/passwd`只是用于验证，并不会对目标系统造成永久性影响。LICENSE文件也是标准的Creative Commons协议。

**有效性：**
根据漏洞库信息和提供的POC脚本，可以确定该漏洞利用是有效的。POC脚本验证了通过修改`PHPRC`环境变量，攻击者能够控制PHP的执行，从而读取敏感文件 (例如 `/etc/passwd`)。结合漏洞描述，可以推断出利用该漏洞执行任意代码是可行的。

**结论：**
该漏洞为高危漏洞，利用简单，影响范围广。强烈建议受影响的用户及时升级到安全版本。

**项目地址:** [jahithoque/Juniper-CVE-2023-36845-Mass-Hunting](https://github.com/jahithoque/Juniper-CVE-2023-36845-Mass-Hunting)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)