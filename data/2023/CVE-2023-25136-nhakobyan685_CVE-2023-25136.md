## CVE-2023-25136-OpenSSH-Double-Free

**漏洞编号:** CVE-2023-25136

**漏洞类型:** Double-Free

**影响应用:** OpenSSH

**危害等级:** 高危，理论上可能导致远程代码执行

**影响版本:** 9.1

**利用条件:** 需要目标服务器运行OpenSSH 9.1，且允许未授权连接（默认配置）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2023-25136是OpenSSH 9.1版本中的一个双重释放漏洞，发生在`options.kex_algorithms`处理过程中。未经身份验证的远程攻击者可以利用此漏洞在sshd地址空间中跳转到任意位置。虽然漏洞描述中提到“远程代码执行在理论上是可能的”，但实际利用难度较大。

**漏洞利用有效性评估：**

从提供的代码来看，`scan.py` 尝试检测目标是否存在漏洞版本。它通过建立SSH连接，如果连接成功，则初步判断为易受攻击。`exploit.py` 尝试与目标建立SSH连接，并设置`local_version`为特定的字符串"SSH-2.0-PuTTY_Release_0.64"。这个POC代码的目的是验证连通性，并非真正的漏洞利用，因为它没有触发双重释放漏洞，只是检测了OpenSSH服务是否存在。

更高级的利用方式可能需要精心构造SSH握手信息，触发`kex_algorithms`处理中的双重释放，然后通过内存布局控制实现任意代码执行。但提供的代码并未实现这些步骤。

**投毒风险分析：**

代码存在潜在的投毒风险，风险约为10%。

1.  **依赖安装：** 代码中包含自动安装 `paramiko` 和 `colorama` 库的部分。虽然这些库本身是常用的Python库，但自动安装行为存在一定的风险，攻击者可能通过修改安装源或篡改库文件来植入恶意代码。
2.  **异常处理：**  代码中的异常处理部分可能被滥用。例如，攻击者可以修改异常处理逻辑，使得在特定情况下执行恶意代码。
3. **弱密码风险:** 代码中存在尝试使用空密码连接的操作，虽然这是为了漏洞检测，但在实际环境中可能被滥用。

**利用方式：**

1.  **漏洞触发：**  双重释放漏洞需要在`kex_algorithms`协商阶段触发。攻击者需要构造恶意的SSH客户端请求，迫使服务器进入存在漏洞的代码路径。
2.  **内存控制：**  双重释放本身不会直接导致代码执行，而是会破坏内存结构。攻击者需要进一步控制内存布局，例如通过堆喷射等技术，将释放后的内存区域填充为可执行代码的地址。
3.  **代码执行：**  通过控制内存中的函数指针或其他关键数据，攻击者最终可以劫持程序流程，执行任意代码。

总的来说，提供的POC代码仅仅验证了连通性，并未实现完整的漏洞利用。实际利用需要更深入的漏洞分析和利用技巧。此外，自动安装依赖和异常处理也存在一定的投毒风险。

**项目地址:** [nhakobyan685/CVE-2023-25136](https://github.com/nhakobyan685/CVE-2023-25136)

**漏洞详情:** [CVE-2023-25136](https://nvd.nist.gov/vuln/detail/CVE-2023-25136)