## CVE-2023-36845 - Juniper Junos OS J-Web PHP External Variable Modification

**漏洞编号:** CVE-2023-36845

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** Junos OS J-Web (EX Series 和 SRX Series)

**危害等级:** 严重，允许未经身份验证的远程攻击者执行任意代码

**影响版本:** 受影响版本详见漏洞库信息

**利用条件:** 目标设备需要启用 J-Web 的 HTTP 或 HTTPS 服务（[system services web-management http] 或 [system services web-management https]）。需要网络可达。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

该漏洞是由于 J-Web 的 PHP 代码中存在外部变量修改漏洞。未经身份验证的攻击者可以通过构造恶意请求，设置 `PHPRC` 变量来修改 PHP 的执行环境，从而注入并执行任意代码。

**利用方式：**
1.  攻击者发送包含恶意 `PHPRC` 参数的 HTTP 请求到目标设备的 J-Web 接口的`/about.php`页面。
2.  `PHPRC` 参数指向一个包含恶意 PHP 代码的文件，或者使用 `data://` 流直接嵌入恶意代码。
3.  由于PHP配置被篡改，服务器会执行恶意代码，从而实现远程代码执行。

**POC 代码分析：**
提供的 `CVE-2023-36845.sh` 脚本通过 `curl` 命令发送包含 `PHPRC` 参数的请求，尝试读取 `/etc/passwd` 文件。如果成功读取，则表明目标易受攻击。脚本首先尝试从 `CVE-2023-36845-targets.txt` 文件读取目标 URL 列表进行批量测试。然后，它调用 `fetch_etc_passwd` 函数，构造包含恶意 `PHPRC` 的请求。如果无法读取 `/etc/passwd`，它会尝试从`CVE-2023-36845-urls.txt`读取 URL 列表并打印。

**有效性：**
该 POC 代码有效，因为它重现了利用 `PHPRC` 变量修改 PHP 环境并读取文件的过程。如果成功读取 `/etc/passwd`，则可以证明目标设备存在漏洞，可以通过修改利用代码来执行其他操作（例如，执行系统命令）。

**投毒风险：**
代码本身看起来没有明显的投毒行为。它主要执行 HTTP 请求和文件读取操作。`README.md` 中也包含了免责声明，虽然不能完全排除作者恶意行为的可能性，但从代码逻辑来看，没有发现明显的恶意代码，**投毒风险为0%**。需要注意的是，实际利用中需要谨慎验证下载的脚本，并理解其行为。

**漏洞修复：**
升级到 Juniper 官方发布的修复版本，或禁用 J-Web 接口，或限制 J-Web 的访问权限。

**项目地址:** [ifconfig-me/CVE-2023-36845](https://github.com/ifconfig-me/CVE-2023-36845)

**漏洞详情:** [CVE-2023-36845](https://nvd.nist.gov/vuln/detail/CVE-2023-36845)