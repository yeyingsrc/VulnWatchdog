## CVE-2023-25136 OpenSSH Pre-Auth Double Free

**漏洞编号:** CVE-2023-25136

**漏洞类型:** Double Free 内存破坏

**影响应用:** OpenSSH

**危害等级:** 高危，拒绝服务 (DoS)，理论上可能远程代码执行

**影响版本:** 9.1

**利用条件:** 目标服务器运行 OpenSSH 9.1，默认配置，无需身份验证

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-25136 是 OpenSSH 9.1 版本中的一个预认证阶段的 double-free 漏洞。攻击者无需身份验证，通过构造特制的 SSH 客户端握手信息（特别是 kex_algorithms 协商过程）即可触发该漏洞。漏洞位于 options.kex_algorithms 的处理过程中，导致 double free。根据漏洞信息和提供的PoC代码，利用方式如下：

1.  **漏洞触发：** PoC 脚本 `poc.py` 使用 `paramiko` 库建立与目标 SSH 服务器的连接。在预认证阶段，它伪造客户端标识 `SSH-2.0-PuTTY_Release_0.64`，并发送经过构造的 SSH 握手数据包。这个数据包中的某些字段，尤其是 kex_algorithms 的处理，会导致 `sshd` 进程在内存管理上出现 double free 错误。

2.  **拒绝服务：** double free 导致 `sshd` 子进程崩溃，从而拒绝当前连接。虽然主 `sshd` 进程会继续监听新的连接，但每个恶意连接都会导致一个新的 `sshd` 子进程崩溃，造成拒绝服务。

3.  **代码执行 (理论上):** 漏洞描述中提到“remote code execution is theoretically possible”。利用 double free 漏洞实现远程代码执行通常需要精细的内存布局控制，这极其复杂，需要深入理解 `sshd` 的内存分配机制。然而，提供的 PoC 主要关注触发崩溃。

4.  **PoC 有效性：** 提供的 `Dockerfile` 构建了一个易受攻击的 OpenSSH 9.1p1 环境，并且关闭了 seccomp 沙箱，以便更容易观察到崩溃信息。`poc.py` 脚本已经验证可以触发 double free 导致 sshd 进程崩溃。

5.  **投毒风险分析：**
    *   `Dockerfile`： 该文件用于构建包含漏洞版本的 OpenSSH 的 Docker 镜像。检查发现其主要目的是为了搭建漏洞环境，下载 OpenSSH 9.1p1 源码，配置编译参数，安装和运行 OpenSSH 服务。没有发现明显的恶意操作或后门植入。
    *   `poc.py`： PoC 脚本用于触发漏洞。它使用 `paramiko` 库来构造 SSH 连接并发送特定的数据包来触发 double free。脚本的主要功能是利用漏洞，本身不包含后门或恶意代码。
    *   `README.md`： 提供了漏洞复现的步骤和环境说明，没有发现任何恶意内容。
    *   综合分析，该仓库主要用于演示 CVE-2023-25136 漏洞，没有明显的投毒行为。但是，任何从网络上获取的代码都应谨慎使用，最好进行代码审查，以确保安全。 假设投毒的概率很小,因为该仓库主要是演示漏洞，添加恶意代码会影响演示效果. PoC 的目的是触发漏洞，而不是执行任意代码。


**项目地址:** [Lane0218/CVE-2023-25136-PoC](https://github.com/Lane0218/CVE-2023-25136-PoC)

**漏洞详情:** [CVE-2023-25136](https://nvd.nist.gov/vuln/detail/CVE-2023-25136)