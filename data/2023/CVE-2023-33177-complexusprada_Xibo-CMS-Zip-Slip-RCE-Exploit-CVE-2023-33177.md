## CVE-2023-33177-Xibo CMS-Zip Slip RCE

**漏洞编号:** CVE-2023-33177

**漏洞类型:** 远程代码执行

**影响应用:** Xibo CMS

**危害等级:** 高危，允许未经授权的用户在服务器上执行任意代码

**影响版本:** 1.8.0 - 2.3.16, 3.0.0 - 3.3.4

**利用条件:** 需要已认证的Xibo CMS用户权限，能够上传Layout文件

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2023-33177是Xibo CMS中的一个Zip Slip路径遍历漏洞，存在于Layout导入功能中。攻击者可以通过上传包含恶意构造的zip文件，利用`mapping.json`文件中的路径遍历字符（`../../`），将恶意文件（如webshell）写入到web根目录之外的任意位置，从而实现远程代码执行。 

**利用方式：**

1.  攻击者首先需要拥有一个Xibo CMS账户并登录。
2.  攻击者构造一个恶意的zip文件，该zip文件包含一个`mapping.json`文件，该文件指定了使用路径遍历来写入webshell的目标路径 (例如: `../../web/shell.php`)。该zip包还需要包含要写入的webshell文件，放在zip包内部的library目录下，目录结构对应`library/../../web/shell.php`。
3.  攻击者通过Layout导入功能上传该恶意zip文件。
4.  Xibo CMS在解压zip文件时，没有正确验证文件路径，从而允许webshell被写入到预期的web根目录，如`/var/www/cms/web/shell.php`。
5.  攻击者现在可以通过访问`http://<target>/shell.php?cmd=<command>`来执行任意命令。

**投毒风险分析：**

提供的POC代码主要包含`create_exploit.py`，用于生成恶意的zip文件，以及一个`README.md`，描述了漏洞的细节和利用方法。 `create_exploit.py`代码本身比较简单，主要是构造zip文件，核心在于`mapping.json`中包含路径穿越字符串。 潜在的投毒风险在于: 
* 在webshell中植入恶意代码，例如反向shell或者其他持久化后门。虽然当前webshell的功能很简单（执行GET参数`cmd`指定的命令），但可以很容易地修改`create_exploit.py`来生成包含更复杂webshell的zip文件。
* `create_exploit.py`也可能被修改，在zip文件中包含额外的文件，这些文件可能在解压过程中造成其他问题，或者用于进一步的攻击。 但是当前提供的代码的功能比较直接，主要目的是演示漏洞，没有明显的投毒迹象。因此，投毒风险较低，估计为5%。

**项目地址:** [complexusprada/Xibo-CMS-Zip-Slip-RCE-Exploit-CVE-2023-33177](https://github.com/complexusprada/Xibo-CMS-Zip-Slip-RCE-Exploit-CVE-2023-33177)

**漏洞详情:** [CVE-2023-33177](https://nvd.nist.gov/vuln/detail/CVE-2023-33177)