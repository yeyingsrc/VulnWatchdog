## CVE-2020-5902-F5 BIG-IP-远程代码执行

**漏洞编号:** CVE-2020-5902

**漏洞类型:** 远程代码执行 (RCE)

**影响应用:** F5 BIG-IP TMUI (Traffic Management User Interface)

**危害等级:** 高危，未经授权的远程代码执行，可能导致系统完全控制

**影响版本:** 15.0.0-15.1.0.3, 14.1.0-14.1.2.5, 13.1.0-13.1.3.3, 12.1.0-12.1.5.1, 11.6.1-11.6.5.1

**利用条件:** 需要网络访问到 F5 BIG-IP 设备的 TMUI 管理界面 (通常在 443 端口)

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2020-5902 漏洞存在于 F5 BIG-IP 设备的 TMUI 管理界面中，允许未经身份验证的攻击者通过发送特制的 HTTP 请求执行任意代码。漏洞利用的关键在于利用目录遍历漏洞访问受限的 JSP 页面 `tmshCmd.jsp`，并执行 TMSH 命令。提供的 f5_scanner.py 脚本通过以下步骤检测漏洞：

1.  **指纹识别：** 脚本首先尝试连接到目标 IP 地址的 443 端口，并检查响应内容是否包含 F5 BIG-IP 相关的关键字（例如 "big-ip", "F5 Networks" 等）。
2.  **漏洞验证：** 如果检测到 F5 BIG-IP 设备，脚本会尝试访问 `tmshCmd.jsp` 页面，并发送一个包含 TMSH 命令的 GET 请求，该命令用于创建一个 CLI alias。脚本随后检查响应状态码和响应头，以确定目标是否易受攻击。

**有效性：** 根据漏洞信息和提供的脚本，该 POC 代码的漏洞检测部分是有效的。该脚本能够通过发送特定请求来识别并验证目标是否存在 CVE-2020-5902 漏洞。但是，该脚本只进行漏洞检测，并没有提供直接执行任意代码的利用方式。其他参考链接（例如 packetstormsecurity）中提供了更完整的漏洞利用方法。

**投毒风险：** 检查脚本是否存在恶意代码需要仔细分析。脚本主要功能是扫描目标 IP，发送 HTTP 请求，并根据响应进行判断。潜在的风险点在于：

*   **依赖项：** `requirements.txt` 中列出的依赖项可能存在已知漏洞，或者被恶意篡改过。需要验证这些依赖项的安全性。
*   **日志记录：** `logger.py` 模块用于配置日志记录。如果日志配置不当，可能会泄露敏感信息。
*   **异常处理：** 虽然脚本包含一些异常处理，但可能存在未处理的异常情况，导致程序崩溃或执行意外行为。

总体来说，该脚本本身并不包含明显的恶意代码，但潜在的投毒风险主要来自于依赖项和不安全的日志记录配置。考虑到脚本相对简单，并且主要功能是进行漏洞检测，投毒风险相对较低，评估为10%。

**利用方式：** CVE-2020-5902 漏洞的完整利用方式包括以下步骤：

1.  **目录遍历：** 通过构造包含 `..;` 的 URL，绕过 TMUI 的路径限制，访问到 `tmshCmd.jsp` 页面。
2.  **TMSH 命令执行：** 通过 `tmshCmd.jsp` 页面，执行任意 TMSH 命令。TMSH 是一种命令行管理工具，可以用于配置和管理 F5 BIG-IP 设备。
3.  **远程代码执行：** 利用 TMSH 命令，可以执行操作系统命令，从而实现远程代码执行。

例如，可以通过 TMSH 命令创建一个 CLI alias，将 bash 命令与一个自定义的 TMSH 命令关联起来。然后，可以通过访问该自定义的 TMSH 命令来执行任意 bash 命令。

**项目地址:** [cristiano-corrado/f5_scanner](https://github.com/cristiano-corrado/f5_scanner)

**漏洞详情:** [CVE-2020-5902](https://nvd.nist.gov/vuln/detail/CVE-2020-5902)