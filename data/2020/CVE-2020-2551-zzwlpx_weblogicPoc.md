## CVE-2020-2551 - Oracle WebLogic Server IIOP反序列化漏洞

**漏洞编号:** CVE-2020-2551

**漏洞类型:** 反序列化漏洞

**影响应用:** Oracle WebLogic Server

**危害等级:** 高危，可能导致远程代码执行

**影响版本:** 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0

**利用条件:** 需要网络访问，IIOP协议开放

**POC 可用性:** 是

**投毒风险:** 20%

## 详情

CVE-2020-2551是Oracle WebLogic Server中的一个IIOP反序列化漏洞。未经身份验证的攻击者可以通过IIOP协议发送恶意序列化数据，从而在WebLogic Server上执行任意代码。漏洞利用代码显示了如何通过构造特定的RMI请求来触发反序列化漏洞。该代码首先使用marshalsec创建一个恶意的RMI服务，然后编译一个包含恶意代码的Java类（exp.java）。接下来，它使用提供的jar包（weblogic_CVE_2020_2551.jar）向目标WebLogic服务器发送特制的IIOP请求，指向恶意的RMI服务，从而触发反序列化，最终导致远程代码执行。

**有效性评估：** 提供的POC代码从多个来源表明其有效性。漏洞库信息确认了漏洞的存在，搜索引擎结果表明该漏洞已被广泛研究和利用。POC代码本身提供了详细的利用步骤和参考链接，进一步证实了其有效性。

**投毒风险分析：**

*   在/tmp/a2c431b8130bd879f469c0f6fb5f3a1f/CVE-2020-2551/src/exp.java文件中，原始的exp.java示例中使用curl命令 `curl http://172.16.1.1/success`。现在的EXP使用了ping命令 `ping -n 2 win.wb2551.starsosectest.starso.cn || ping -n 2 lin.wb2551.starsosectest.starso.cn` 进行命令执行，这可能是作者用来验证漏洞是否成功的手段。
*  build.xml 文件中指定了编译的jdk版本为1.6,这可能导致在高版本jdk上编译失败
*   Makefile文件尝试启动一个HTTP服务器，这本身没有恶意，但如果服务器被用于分发恶意payload，则存在潜在的投毒风险。
*   虽然没有明显的恶意代码植入，但是exp.java中执行的命令可以被修改为更具危害性的操作。因此，该POC存在一定的投毒风险，约20%。用户在使用该POC时应仔细检查exp.java文件，确保执行的命令是安全的。

**利用方式：**

1.  **搭建恶意RMI服务：** 使用marshalsec等工具搭建一个恶意的RMI服务，用于提供恶意对象。
2.  **编译恶意Java类：** 编写一个包含恶意代码的Java类（例如exp.java），并将其编译成class文件。该类将在目标WebLogic服务器上执行任意命令。
3.  **部署恶意class文件：** 将编译后的class文件部署到可以通过HTTP访问的Web服务器上。
4.  **构造IIOP请求：** 使用提供的jar包（weblogic_CVE_2020_2551.jar）或类似工具，构造一个包含指向恶意RMI服务的IIOP请求，并将其发送到目标WebLogic服务器的IIOP端口（默认为7001）。
5.  **触发反序列化：** WebLogic服务器接收到IIOP请求后，会尝试从RMI服务下载恶意对象，从而触发反序列化漏洞，最终执行恶意代码。

**项目地址:** [zzwlpx/weblogicPoc](https://github.com/zzwlpx/weblogicPoc)

**漏洞详情:** [CVE-2020-2551](https://nvd.nist.gov/vuln/detail/CVE-2020-2551)