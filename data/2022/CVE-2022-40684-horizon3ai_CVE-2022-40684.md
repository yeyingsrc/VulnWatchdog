## CVE-2022-40684-Fortinet身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** Fortinet FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，未经身份验证的攻击者可以执行管理操作

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 需要网络访问目标设备的HTTPS端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-40684 是一个Fortinet FortiOS, FortiProxy, 和 FortiSwitchManager中的身份验证绕过漏洞。未经身份验证的攻击者可以通过构造特殊的HTTP或HTTPS请求，在管理界面上执行操作。

**有效性：**

提供的POC代码通过添加SSH密钥到目标设备的管理员账户，验证了漏洞的有效性。POC代码使用`requests`库发送带有特定header（`Forwarded`）的PUT请求到`/api/v2/cmdb/system/admin/{username}` URL，绕过身份验证，将指定的SSH公钥添加到指定用户，从而允许攻击者使用私钥登录设备。

**投毒风险：**

虽然POC代码本身是为了验证漏洞，理论上可以作为漏洞利用的起点，但仔细检查了提供的Python脚本和README文件，没有发现明显的投毒代码。代码功能相对简单，主要是发送HTTP请求。但是，任何下载和使用的第三方脚本都有潜在风险，始终建议在隔离环境中进行测试和代码审查。
投毒风险评估：较低，约为10%。主要考虑点是，用户是否信任代码作者，以及代码托管平台是否被攻陷。

**利用方式：**

1.  攻击者利用身份验证绕过漏洞，构造特殊的HTTP或HTTPS请求。
2.  POC代码中通过设置`Forwarded`头来绕过身份验证。
3.  攻击者发送PUT请求到`/api/v2/cmdb/system/admin/{username}` API端点，更新指定用户的SSH公钥。
4.  如果目标设备存在漏洞，攻击者就可以通过新添加的SSH密钥登录设备，从而控制系统。
5. 该漏洞通过允许未经身份验证的攻击者执行管理操作来实现利用。

**项目地址:** [horizon3ai/CVE-2022-40684](https://github.com/horizon3ai/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)