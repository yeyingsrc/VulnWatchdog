## CVE-2022-40684 - FortiOS/FortiProxy/FortiSwitchManager 身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，未授权访问管理界面，可能导致完全系统控制

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标系统存在漏洞版本，且攻击者可以发起 HTTP/HTTPS 请求

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684是一个严重的身份验证绕过漏洞，影响Fortinet的FortiOS, FortiProxy, 和 FortiSwitchManager。未经验证的攻击者可以通过构造特殊的HTTP或HTTPS请求，在管理界面执行操作。

**有效性：** 提供的POC代码通过发送特定的请求来添加SSH公钥，从而允许未经授权的访问，证明了漏洞的有效性。

**投毒风险：** 查看提供的Python脚本，主要功能是利用漏洞添加SSH密钥，代码逻辑清晰，主要利用requests库发送HTTP请求。脚本没有发现任何明显的后门或恶意代码，例如下载并执行恶意二进制文件，或者未经授权的数据泄露。README中也描述了漏洞的利用方式和缓解措施，提高了透明度。因此，投毒风险评估为0%。

**利用方式：** 该漏洞允许攻击者绕过身份验证，然后使用该权限执行操作。提供的POC代码演示了如何利用此漏洞来添加SSH公钥到目标系统上的指定用户。攻击者通过构造包含`Forwarded`头的HTTP(S)请求绕过身份验证，然后调用API来更新用户的SSH密钥。成功添加SSH密钥后，攻击者就可以使用私钥通过SSH登录系统。

**项目地址:** [puckiestyle/CVE-2022-40684](https://github.com/puckiestyle/CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)