## CVE-2022-40684 - Fortinet Authentication Bypass

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** Fortinet FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，未经身份验证的攻击者可以执行管理操作

**影响版本:** FortiOS 7.2.0 through 7.2.1 and 7.0.0 through 7.0.6, FortiProxy version 7.2.0 and version 7.0.0 through 7.0.6 and FortiSwitchManager version 7.2.0 and 7.0.0

**利用条件:** 需要网络访问Fortinet设备的管理界面（HTTP或HTTPS）

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-40684 漏洞允许未经身份验证的攻击者通过构造特殊的HTTP或HTTPS请求绕过身份验证，从而在 FortiOS、FortiProxy 和 FortiSwitchManager 的管理界面上执行操作。

**有效性评估：**
根据漏洞库信息，该漏洞已被CISA添加到已知被利用的漏洞目录(KEV)，且存在功能性(Functional)的exp，表明该漏洞利用的有效性很高。提供的Go语言POC代码尝试通过上传SSH公钥到目标系统来获得未授权访问。

**投毒风险评估：**
该Go语言POC代码本身用于利用CVE-2022-40684漏洞，目的在于上传SSH密钥以获得访问权限。代码中使用的依赖项看起来都是常见的Go库，如req (HTTP客户端)，banner，color等。没有明显的恶意代码的迹象，但仍需要仔细审查代码逻辑以排除任何隐藏的后门。

投毒风险评估为10%。原因如下：
*   POC代码相对简单，功能明确，主要是进行HTTP请求和文件操作。
*   代码使用了流行的Go库，这些库被广泛使用，被投毒的可能性较低。
*   作者声明了免责声明，表明其目的是进行合法的安全测试。

即便如此，用户在使用前应仔细审查代码，确保没有隐藏的恶意行为。 建议编译前检查代码，确保上传的公钥为自己所拥有，以防被他人利用。

**利用方式分析：**
利用方式如下：
1.  攻击者构造恶意的HTTP/HTTPS请求，利用身份验证绕过漏洞。
2.  POC代码使用`req`库发送精心设计的HTTP请求到目标Fortinet设备的管理界面。
3.  攻击者可以使用该漏洞在目标系统上添加新的管理用户或上传SSH密钥。
4.  利用上传的SSH公钥，攻击者可以使用私钥通过SSH登录到设备。
5.  成功登录后，攻击者可以执行任意管理操作，包括配置更改、固件升级、数据窃取等。

**项目地址:** [jsongmax/Fortinet-CVE-2022-40684](https://github.com/jsongmax/Fortinet-CVE-2022-40684)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)