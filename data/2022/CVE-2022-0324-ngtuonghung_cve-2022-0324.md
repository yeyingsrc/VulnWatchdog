## CVE-2022-0324 - SONiC dhcp6relay 缓冲区溢出

**漏洞编号:** CVE-2022-0324

**漏洞类型:** 缓冲区溢出

**影响应用:** Software for Open Networking in the Cloud (SONiC)

**危害等级:** 高危，可能导致dhcp6relay崩溃，影响网络服务

**影响版本:** 202111

**利用条件:** 攻击者需要在相邻网络，能够发送特制的DHCPv6包

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-0324 存在于SONiC中的dhcp6relay组件中。漏洞原因是 DHCPv6 数据包解析代码存在缺陷，远程攻击者可以构造一个恶意的 DHCPv6 数据包，触发 memcpy 函数中的缓冲区溢出。这会导致越界内存写入，导致 dhcp6relay 进程崩溃，进而影响DHCP中继docker的关闭。

**有效性评估：**
提供的 Dockerfile 包含了构建易受攻击环境的指令，以及利用代码 `exploit.py`。利用代码通过发送一个包含超长 OPTION_RELAY_MSG 选项的 DHCPv6 Relay-Reply 消息来触发缓冲区溢出。该消息发送到 UDP 端口 547，这是 DHCPv6 的标准端口。`exploit.py` 中的 `pl += b"B" * 2**15` 这行代码，填充了大量'B'字符来覆盖缓冲区。利用代码很可能有效，能导致dhcp6relay崩溃，导致拒绝服务。

**投毒风险评估：**
分析提供的文件，未发现明显的投毒代码。Dockerfile 主要是用于构建和配置环境，`add_ipv6_addresses.sh` 脚本用于设置 IPv6 地址，而 `exploit.py` 包含漏洞利用代码。并没有发现隐藏的恶意逻辑或后门。但是需要注意，利用漏洞本身就是一种潜在的风险，攻击者可能会利用该漏洞进行进一步的恶意活动。因此，投毒风险评估为0%。

**利用方式：**
1.  **环境搭建:** 使用 Dockerfile 构建包含漏洞的 SONiC 环境。
2.  **网络配置:** 使用 `add_ipv6_addresses.sh` 脚本配置 IPv6 地址。
3.  **漏洞触发:** 运行 `exploit.py` 脚本，向目标主机的 547 端口发送构造的恶意 DHCPv6 Relay-Reply 消息。
4.  **结果验证:** 观察目标主机的 dhcp6relay 进程是否崩溃。如果崩溃，则表明漏洞利用成功。

**项目地址:** [ngtuonghung/cve-2022-0324](https://github.com/ngtuonghung/cve-2022-0324)

**漏洞详情:** [CVE-2022-0324](https://nvd.nist.gov/vuln/detail/CVE-2022-0324)