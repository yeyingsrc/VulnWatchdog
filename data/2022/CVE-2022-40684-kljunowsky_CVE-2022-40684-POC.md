## CVE-2022-40684-FortiOS/FortiProxy/FortiSwitchManager身份验证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 身份验证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 严重，未经身份验证的攻击者可以对管理界面执行操作，可能导致完全控制系统

**影响版本:** FortiOS 7.2.0 - 7.2.1, 7.0.0 - 7.0.6; FortiProxy 7.2.0, 7.0.0 - 7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标系统运行受影响的FortiOS, FortiProxy 或 FortiSwitchManager版本，并且可以通过HTTP/HTTPS访问管理界面。

**POC 可用性:** 是

**投毒风险:** 0%

## 详情

CVE-2022-40684是一个Fortinet FortiOS、FortiProxy和FortiSwitchManager中的身份验证绕过漏洞。未经身份验证的攻击者可以通过构造特制的HTTP或HTTPS请求，在管理界面上执行操作。提供的PoC代码通过PUT请求向`/api/v2/cmdb/system/admin/<username>`端点发送包含SSH公钥的JSON数据，试图将攻击者的SSH公钥添加到指定用户名对应的管理员账户中，从而实现SSH密钥认证登录。

**有效性评估：**
PoC代码看起来有效，因为它利用了漏洞描述中提到的特定API端点和请求方法，并且数据结构符合要求。如果目标系统存在漏洞，并且用户提供的用户名存在，则攻击者可以成功将SSH公钥添加到目标系统，从而获得未经授权的访问权限。从CVE信息来看，该漏洞的`ExploitCodeMaturity`是`FUNCTIONAL`，说明存在可用的漏洞利用代码，进一步佐证了PoC的有效性。

**投毒风险评估：**
分析PoC代码后，未发现明显的投毒代码。该脚本的主要功能是读取目标、用户名和SSH公钥文件，然后向目标系统发送PUT请求。脚本本身没有尝试执行任何恶意操作，例如下载或执行其他代码。但是，需要注意以下几点：
1.  **依赖性：** 该脚本依赖于`requests`库，如果安装的`requests`库被替换为恶意版本，则可能存在风险。
2.  **用户输入：** 该脚本接受用户提供的目标、用户名和SSH公钥文件作为输入。如果用户提供的文件包含恶意内容（例如，SSH公钥文件实际上包含后门），则可能导致远程代码执行。
3.  **目标系统安全性：** 即使该脚本本身没有投毒代码，成功利用该漏洞后，攻击者仍然可以对目标系统执行恶意操作。

综合考虑，此仓库中直接包含恶意投毒代码的风险较低，估计为0%。但是，仍然需要注意依赖性和用户输入的安全。

**利用方式：**
1.  **目标确定：** 确定运行受影响的FortiOS、FortiProxy或FortiSwitchManager版本的目标系统。
2.  **用户名收集：** 收集目标系统上可能存在的用户名。常见用户名包括`admin`、`administrator`等。
3.  **SSH密钥生成：** 生成SSH密钥对。将公钥保存在文件中，供PoC脚本使用。
4.  **PoC执行：** 运行PoC脚本，指定目标、用户名和SSH公钥文件。如果成功，则攻击者的SSH公钥将被添加到目标系统的管理员账户中。
5.  **SSH登录：** 使用私钥通过SSH登录目标系统。

**项目地址:** [kljunowsky/CVE-2022-40684-POC](https://github.com/kljunowsky/CVE-2022-40684-POC)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)