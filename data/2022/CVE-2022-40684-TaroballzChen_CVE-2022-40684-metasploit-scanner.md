## CVE-2022-40684-Fortinet产品认证绕过

**漏洞编号:** CVE-2022-40684

**漏洞类型:** 认证绕过

**影响应用:** FortiOS, FortiProxy, FortiSwitchManager

**危害等级:** 高危，允许未授权访问管理界面并执行操作

**影响版本:** FortiOS 7.2.0-7.2.1, 7.0.0-7.0.6; FortiProxy 7.2.0, 7.0.0-7.0.6; FortiSwitchManager 7.2.0, 7.0.0

**利用条件:** 目标系统存在漏洞版本且开放HTTP/HTTPS端口

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

CVE-2022-40684是一个Fortinet产品中的认证绕过漏洞，攻击者可以通过构造特殊的HTTP/HTTPS请求绕过身份验证，从而在管理界面执行未授权的操作。根据提供的漏洞利用代码，攻击者可以利用Metasploit框架，通过发送带有特定header的请求到目标系统的`/api/v2/cmdb/system/admin/{username}`或`/api/v2/cmdb/system/admin`路径，绕过身份验证。漏洞利用代码尝试获取LDAP配置信息，可能泄露敏感信息。漏洞利用的有效性取决于目标系统是否部署了受影响的Fortinet产品版本。投毒风险较低，主要集中在Metasploit模块的安装路径和对依赖库的潜在篡改。代码中`Host`头被设置为`127.0.0.1:9980`，`Forwarded`头包含内部IP地址，这可能被恶意修改，用于内部网络渗透或欺骗，因此存在一定风险。

**项目地址:** [TaroballzChen/CVE-2022-40684-metasploit-scanner](https://github.com/TaroballzChen/CVE-2022-40684-metasploit-scanner)

**漏洞详情:** [CVE-2022-40684](https://nvd.nist.gov/vuln/detail/CVE-2022-40684)