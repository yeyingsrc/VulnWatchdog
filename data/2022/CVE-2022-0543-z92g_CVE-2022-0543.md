## CVE-2022-0543 Redis Lua 沙箱逃逸

**漏洞编号:** CVE-2022-0543

**漏洞类型:** Lua 沙箱逃逸

**影响应用:** Redis (Debian specific)

**危害等级:** 高危，远程代码执行

**影响版本:** n/a (Debian packaging issue)

**利用条件:** 目标 Redis 服务器运行在 Debian 环境，存在 Debian 特定的 Lua 库路径问题

**POC 可用性:** 是

**投毒风险:** 5%

## 详情

CVE-2022-0543 是一个 Debian 特定的 Redis Lua 沙箱逃逸漏洞。由于 Debian 的 Redis 打包方式问题，Lua 运行库的路径与 Redis 期望的路径不一致，导致可以通过 Lua 脚本逃逸沙箱，执行任意系统命令。

**有效性：**

提供的 Go 语言 POC 代码看起来有效。它连接到 Redis 服务器，然后利用 Lua 脚本中的 `package.loadlib` 和 `io.popen` 函数来执行系统命令。代码通过命令行参数指定目标 Redis 服务器的地址、用户名、密码和数据库，并提供了一个交互式控制台来执行命令。

**投毒风险：**

代码本身直接利用漏洞，风险较低。 主要风险点在于代码在每次循环中都重新创建一个新的Redis客户端连接, 如果在高并发下可能导致资源耗尽。以及代码中使用的liblua路径`/usr/lib/x86_64-linux-gnu/liblua5.1.so.0`写死了, 可能在其他debian环境上不适用,导致利用失败。README.md文件风险可忽略。

因此，我评估该漏洞利用代码的投毒风险为 5%。

**利用方式：**

1.  **连接 Redis 服务器：** 使用提供的 POC 代码，指定目标 Redis 服务器的 IP 地址、端口、用户名、密码和数据库。代码会尝试连接到 Redis 服务器。
2.  **利用 Lua 脚本执行命令：** 连接成功后，POC 代码会使用 `EVAL` 命令执行 Lua 脚本。该 Lua 脚本使用 `package.loadlib` 加载 Lua 的 I/O 库，然后使用 `io.popen` 执行系统命令。执行的结果会被读取并返回。
3.  **交互式执行命令：** POC 代码提供了一个交互式控制台，允许攻击者输入任意系统命令，这些命令将在目标服务器上执行。输入 "q" 退出程序。
4.  **免责声明：** README.md 中声明此工具仅用于学习、研究和自查，不应用于非法目的。

**项目地址:** [z92g/CVE-2022-0543](https://github.com/z92g/CVE-2022-0543)

**漏洞详情:** [CVE-2022-0543](https://nvd.nist.gov/vuln/detail/CVE-2022-0543)