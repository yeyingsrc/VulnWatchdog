## CVE-2022-21587-Oracle Web Applications Desktop Integrator-未授权任意文件上传

**漏洞编号:** CVE-2022-21587

**漏洞类型:** 未授权任意文件上传

**影响应用:** Oracle Web Applications Desktop Integrator

**危害等级:** 高危，可能导致远程代码执行，完全控制服务器

**影响版本:** 12.2.3-12.2.11

**利用条件:** 目标系统运行受影响版本的Oracle E-Business Suite, 且允许通过HTTP进行网络访问

**POC 可用性:** 是

**投毒风险:** 10%

## 详情

该漏洞存在于Oracle Web Applications Desktop Integrator的上传组件中，未经身份验证的攻击者可以通过构造恶意的请求，上传任意文件到服务器的指定目录，覆盖或新增可执行文件，从而实现远程代码执行，最终完全控制服务器。

**利用方式：**

1.  **上传准备：** 攻击者首先构造一个包含恶意代码的Perl脚本（txkFNDWRR.pl）。该脚本接受名为`HTTP_CMD`的HTTP Header作为命令参数，并通过`system()`函数执行该命令。
2.  **打包与编码：** 使用`slipit`工具将Perl脚本打包成ZIP文件（txkFNDWRR.zip），然后使用`uuencode`将ZIP文件编码成文本文件（t.uue）。`slipit`工具的目的是为了控制解压后的文件路径，将Perl脚本放置在目标服务器的指定位置 `/FMW_Home/Oracle_EBS-app1/common/scripts/`。
3.  **上传利用：** 攻击者发送一个POST请求到`OA_HTML/BneUploaderService?bne:uueupload=true`，并将编码后的ZIP文件（t.uue）作为`text`参数上传。 Oracle EBS会解码并解压该文件到目标服务器上。
4.  **命令执行：** 攻击者通过访问`/OA_CGI/FNDWRR.exe`，并在HTTP Header中添加`cmd`参数来执行任意命令。例如，`curl -k https://target/OA_CGI/FNDWRR.exe -H 'cmd: whoami'`。

**有效性评估：**

提供的PoC代码利用了CVE-2022-21587漏洞，允许未经身份验证的攻击者上传任意文件并执行命令。代码包含了生成恶意Perl脚本、打包、编码和上传的步骤。通过修改`cmd` Header，可以在目标服务器上执行任意命令，因此该PoC代码有效。

**投毒风险评估：**

PoC 代码主要功能是实现RCE, 但是仍然存在一定投毒风险. 由于代码的实现依赖于特定的文件路径（如`/FMW_Home/Oracle_EBS-app1/common/scripts/`）和外部工具（`slipit`、`uuencode`），如果这些路径或工具不存在或配置不正确，则PoC可能无法成功利用。作者可能利用这个前提, 增加一些判断, 导致在特定环境下执行恶意代码, 但是总体上分析，投毒代码的可能性较低，约为10%。主要风险在于`txkFNDWRR.pl` 脚本中的 `system($cmd)`函数，如果攻击者替换该脚本，或者在原本的脚本里增加一些不安全的代码，将会存在投毒风险，但此仓库仅仅用于PoC验证，所以投毒风险较小。

**项目地址:** [merlyn-1/CVE-2022-21587-Oracle-EBS](https://github.com/merlyn-1/CVE-2022-21587-Oracle-EBS)

**漏洞详情:** [CVE-2022-21587](https://nvd.nist.gov/vuln/detail/CVE-2022-21587)